import{d as le,P as te,a as se,z as oe,r,a1 as re,n as ie,al as ue,o as u,c as h,f as o,u as a,y as me,q as _,w as l,k as D,F as k,p as C,g as q,x as F,t as H,d1 as ne,j as pe,E as de,i as fe,l as ce,m as ve,H as ye,I as _e,A as be,B as ge,C as he,J as ke,M as xe}from"./index-DPENBzsb.js";import{_ as we}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{E as Ce}from"./el-image-DqGFoayu.js";import{_ as Ve}from"./index-CbaPuDB3.js";import{b as Ue,a as Se}from"./index-B9xqy6_R.js";import{f as Ie,e as Pe}from"./index-DetSWMsK.js";import{d as qe,b as Fe}from"./formCreate-BQ5MeUYD.js";import ze from"./ProcessInstanceBpmnViewer-DhragUyT.js";import{C as Ae}from"./index-C_gZe85y.js";import{u as Ee}from"./tagsView-uxrzGHKp.js";import{g as Re}from"./index-Co9HWb9O.js";import"./bpmn-embedded-BBruoZr8.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./XTextButton-CaCskr4h.js";import"./XButton-lfojvuGT.js";import"./consts-Dqfik1EE.js";import"./utils-CjFsbWby.js";import"./index-D2cLVQ1T.js";import"./index-BCN8BzfC.js";import"./index-BOzeB1Pk.js";import"./el-tree-select-DxCa0FGQ.js";import"./tree-Cts6wVCK.js";import"./index-tb7T-AVj.js";import"./index-BUzABQZW.js";import"./index-Btz8nVwe.js";import"./index-BAEJzc7Z.js";import"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import"./index-C2tU_CDa.js";import"./constants-C8tGWvl2.js";import"./index-O66V04DS.js";import"./el-drawer-DSddsvoD.js";import"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import"./color-DXkOL5Tu.js";import"./index-IbQXwv2T.js";import"./formatTime-C7TQtsxQ.js";const je={class:"flex"},Be={class:"clearfix"},De={class:"el-icon-document"},He=le({name:"BpmProcessInstanceCreate",__name:"index_old",setup(Je){const J=te(),{push:z,currentRoute:M}=se(),V=oe(),{delView:Q}=Ee(),x=J.query.processInstanceId,U=r(!0),w=r([]),b=r(""),S=r([]),T=re(()=>S.value.filter(t=>t.category==b.value)),n=r(),p=r({rule:[],option:{},value:{}}),d=r(),A=r(null),f=r([]),c=r({}),E=r(),I=r({}),R=r([]),j=async(t,e)=>{var v;if(d.value=t,f.value=[],c.value={},I.value={},t.formType==10){const y=qe(t.formFields).map(i=>i.field);for(const i in e)y.includes(i)||delete e[i];Fe(p,t.formConf,t.formFields,e);const g=await Se(t.id);if(g&&(A.value=g.bpmnXml,f.value=g.startUserSelectTasks,((v=f.value)==null?void 0:v.length)>0)){p.value.rule.push({type:"startUserSelect",props:{title:"\u6307\u5B9A\u5BA1\u6279\u4EBA"}});for(const i of f.value)c.value[i.id]=[],I.value[i.id]=[{required:!0,message:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA",trigger:"blur"}];R.value=await Re()}}else t.formCustomCreatePath&&await z({path:t.formCustomCreatePath})},$=async t=>{var e;if(n.value&&d.value){((e=f.value)==null?void 0:e.length)>0&&await E.value.validate(),n.value.btn.loading(!0);try{await Pe({processDefinitionId:d.value.id,variables:t,startUserSelectAssignees:c.value}),V.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),Q(a(M)),await z({name:"BpmProcessInstanceMy"})}finally{n.value.btn.loading(!1)}}};return ie(()=>{(async()=>{U.value=!0;try{if(w.value=await Ae.getCategorySimpleList(),w.value.length>0&&(b.value=w.value[0].code),S.value=await Ue({suspensionState:1}),(x==null?void 0:x.length)>0){const t=await Ie(x);if(!t)return void V.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9E\u4F8B\u4E0D\u5B58\u5728");const e=S.value.find(v=>{var y;return v.key==((y=t.processDefinition)==null?void 0:y.key)});if(!e)return void V.error("\u91CD\u65B0\u53D1\u8D77\u6D41\u7A0B\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A\u6D41\u7A0B\u5B9A\u4E49\u4E0D\u5B58\u5728");await j(e,t.formVariables)}}finally{U.value=!1}})()}),(t,e)=>{const v=Ve,y=Ce,g=ne,i=pe,P=de,L=fe,N=ce,O=ve,B=we,W=ye,X=_e,Z=be,G=ge,K=he,Y=ke,ee=ue("form-create"),ae=xe;return u(),h(k,null,[o(v,{title:"\u6D41\u7A0B\u53D1\u8D77\u3001\u53D6\u6D88\u3001\u91CD\u65B0\u53D1\u8D77",url:"https://doc.iocoder.cn/bpm/process-instance/"}),a(d)?(u(),_(B,{key:1},{default:l(()=>[o(i,{class:"box-card"},{default:l(()=>[q("div",Be,[q("span",De,"\u7533\u8BF7\u4FE1\u606F\u3010"+H(a(d).name)+"\u3011",1),o(X,{style:{float:"right"},type:"primary",onClick:e[1]||(e[1]=s=>d.value=void 0)},{default:l(()=>[o(W,{icon:"ep:delete"}),e[4]||(e[4]=F(" \u9009\u62E9\u5176\u5B83\u6D41\u7A0B "))]),_:1})]),o(P,{span:16,offset:6,style:{"margin-top":"20px"}},{default:l(()=>[o(ee,{rule:a(p).rule,api:a(n),"onUpdate:api":e[2]||(e[2]=s=>D(n)?n.value=s:null),modelValue:a(p).value,"onUpdate:modelValue":e[3]||(e[3]=s=>a(p).value=s),option:a(p).option,onSubmit:$},{"type-startUserSelect":l(()=>[o(P,{span:24},{default:l(()=>[o(i,{class:"mb-10px"},{header:l(()=>e[5]||(e[5]=[F("\u6307\u5B9A\u5BA1\u6279\u4EBA")])),default:l(()=>[o(Y,{model:a(c),rules:a(I),ref_key:"startUserSelectAssigneesFormRef",ref:E},{default:l(()=>[(u(!0),h(k,null,C(a(f),s=>(u(),_(K,{key:s.id,label:`\u4EFB\u52A1\u3010${s.name}\u3011`,prop:s.id},{default:l(()=>[o(G,{modelValue:a(c)[s.id],"onUpdate:modelValue":m=>a(c)[s.id]=m,multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA"},{default:l(()=>[(u(!0),h(k,null,C(a(R),m=>(u(),_(Z,{key:m.id,label:m.nickname,value:m.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1},8,["rule","api","modelValue","option"])]),_:1})]),_:1}),o(ze,{"bpmn-xml":a(A)},null,8,["bpmn-xml"])]),_:1})):me((u(),_(B,{key:0},{default:l(()=>[o(O,{"tab-position":"left",modelValue:a(b),"onUpdate:modelValue":e[0]||(e[0]=s=>D(b)?b.value=s:null)},{default:l(()=>[(u(!0),h(k,null,C(a(w),s=>(u(),_(N,{label:s.name,name:s.code,key:s.code},{default:l(()=>[o(L,{gutter:20},{default:l(()=>[(u(!0),h(k,null,C(a(T),m=>(u(),_(P,{lg:6,sm:12,xs:24,key:m.id},{default:l(()=>[o(i,{shadow:"hover",class:"mb-20px cursor-pointer",onClick:Me=>j(m)},{default:l(()=>[q("div",je,[o(y,{src:m.icon,class:"w-32px h-32px"},null,8,["src"]),o(g,{class:"!ml-10px",size:"large"},{default:l(()=>[F(H(m.name),1)]),_:2},1024)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[ae,a(U)]])],64)}}});export{He as default};
