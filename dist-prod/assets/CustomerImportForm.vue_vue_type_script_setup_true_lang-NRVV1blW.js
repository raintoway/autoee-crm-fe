import{_ as H}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{d as L,z as O,r,o as y,q as b,w as o,f as n,u as i,x,g as d,k as _,c as R,F as Z,p as E,b as G,am as J,A as K,B as M,H as X,ac as P,ad as Q,aZ as T,I as W}from"./index-DPENBzsb.js";import{k as Y,m as $}from"./index-OU-fIsLR.js";import{d as ee}from"./download-oWiM5xVU.js";import{g as ae}from"./index-Co9HWb9O.js";const se={class:"flex items-center my-10px"},le={class:"el-upload__tip text-center"},te={class:"el-upload__tip"},oe=L({name:"SystemUserImportForm",__name:"CustomerImportForm",emits:["success"],setup(ue,{expose:V,emit:k}){const f=O(),m=r(!1),u=r(!1),g=r(),p=r([]),v=r(!1),c=r(),w=r([]);V({open:async()=>{m.value=!0,await S(),w.value=await ae(),c.value=G().getUser.id}});const N=async()=>{if(p.value.length!=0){u.value=!0;try{const a=new FormData;a.append("updateSupport",String(v.value)),a.append("file",p.value[0].raw),a.append("ownerUserId",String(c.value));const e=await Y(a);h(e)}catch{F()}finally{u.value=!1}}else f.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")},U=k,h=a=>{if(a.code!==0)return f.error(a.msg),void(u.value=!1);const e=a.data;let l="\u4E0A\u4F20\u6210\u529F\u6570\u91CF\uFF1A"+e.createCustomerNames.length+";";for(let t of e.createCustomerNames)l+="< "+t+" >";l+="\u66F4\u65B0\u6210\u529F\u6570\u91CF\uFF1A"+e.updateCustomerNames.length+";";for(const t of e.updateCustomerNames)l+="< "+t+" >";l+="\u66F4\u65B0\u5931\u8D25\u6570\u91CF\uFF1A"+Object.keys(e.failureCustomerNames).length+";";for(const t in e.failureCustomerNames)l+="< "+t+": "+e.failureCustomerNames[t]+" >";f.alert(l),u.value=!1,m.value=!1,U("success")},F=()=>{f.error("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u60A8\u91CD\u65B0\u4E0A\u4F20\uFF01"),u.value=!1},S=async()=>{var a;p.value=[],v.value=!1,c.value=void 0,await J(),(a=g.value)==null||a.clearFiles()},I=()=>{f.error("\u6700\u591A\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF01")},j=async()=>{const a=await $();ee.excel(a,"\u5BA2\u6237\u5BFC\u5165\u6A21\u7248.xls")};return(a,e)=>{const l=K,t=M,q=X,z=P,A=Q,B=T,C=W,D=H;return y(),b(D,{modelValue:i(m),"onUpdate:modelValue":e[4]||(e[4]=s=>_(m)?m.value=s:null),title:"\u5BA2\u6237\u5BFC\u5165",width:"400"},{footer:o(()=>[n(C,{disabled:i(u),type:"primary",onClick:N},{default:o(()=>e[10]||(e[10]=[x("\u786E \u5B9A")])),_:1},8,["disabled"]),n(C,{onClick:e[3]||(e[3]=s=>m.value=!1)},{default:o(()=>e[11]||(e[11]=[x("\u53D6 \u6D88")])),_:1})]),default:o(()=>[d("div",se,[e[5]||(e[5]=d("span",{class:"mr-10px"},"\u8D1F\u8D23\u4EBA",-1)),n(t,{modelValue:i(c),"onUpdate:modelValue":e[0]||(e[0]=s=>_(c)?c.value=s:null),class:"!w-240px",clearable:""},{default:o(()=>[(y(!0),R(Z,null,E(i(w),s=>(y(),b(l,{key:s.id,label:s.nickname,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),n(B,{ref_key:"uploadRef",ref:g,"file-list":i(p),"onUpdate:fileList":e[2]||(e[2]=s=>_(p)?p.value=s:null),"auto-upload":!1,disabled:i(u),limit:1,"on-exceed":I,accept:".xlsx, .xls",action:"none",drag:""},{tip:o(()=>[d("div",le,[d("div",te,[n(z,{modelValue:i(v),"onUpdate:modelValue":e[1]||(e[1]=s=>_(v)?v.value=s:null)},null,8,["modelValue"]),e[6]||(e[6]=x(" \u662F\u5426\u66F4\u65B0\u5DF2\u7ECF\u5B58\u5728\u7684\u5BA2\u6237\u6570\u636E\uFF08\u201C\u5BA2\u6237\u540D\u79F0\u201D\u91CD\u590D\uFF09 "))]),e[8]||(e[8]=d("span",null,"\u4EC5\u5141\u8BB8\u5BFC\u5165 xls\u3001xlsx \u683C\u5F0F\u6587\u4EF6\u3002",-1)),n(A,{underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},type:"primary",onClick:j},{default:o(()=>e[7]||(e[7]=[x(" \u4E0B\u8F7D\u6A21\u677F ")])),_:1})])]),default:o(()=>[n(q,{icon:"ep:upload"}),e[9]||(e[9]=d("div",{class:"el-upload__text"},[x("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),d("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1))]),_:1},8,["file-list","disabled"])]),_:1},8,["modelValue"])}}});export{oe as _};
