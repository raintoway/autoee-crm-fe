import{d as L,r as b,e as g,n as T,o as C,c as W,f as e,w as o,u as s,y as q,q as z,D as p,F as j,dz as _,de as A,dV as w,dT as v,E as D,i as I,j as F,K,L as V,M as k}from"./index-DPENBzsb.js";import{_ as B}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{E as G}from"./el-skeleton-item-ByHOrDfP.js";import{_ as H}from"./Echart.vue_vue_type_script_setup_true_lang-BK9hPyJ9.js";import{S as J}from"./portrait-qzGIpyJ8.js";const N=L({name:"PortraitCustomerSource",__name:"PortraitCustomerSource",props:{queryParams:{}},setup(S,{expose:y}){const R=S,i=b(!1),c=b([]),n=g({title:{text:"\u5168\u90E8\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u5168\u90E8\u5BA2\u6237"}}},series:[{name:"\u5168\u90E8\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),d=g({title:{text:"\u6210\u4EA4\u5BA2\u6237",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},toolbox:{feature:{saveAsImage:{show:!0,name:"\u6210\u4EA4\u5BA2\u6237"}}},series:[{name:"\u6210\u4EA4\u5BA2\u6237",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]}),f=async()=>{i.value=!0;const r=await J.getCustomerSource(R.queryParams);n.series&&n.series[0]&&n.series[0].data&&(n.series[0].data=r.map(t=>({name:_(p.CRM_CUSTOMER_SOURCE,t.source),value:t.customerCount}))),d.series&&d.series[0]&&d.series[0].data&&(d.series[0].data=r.map(t=>({name:_(p.CRM_CUSTOMER_SOURCE,t.source),value:t.dealCount}))),x(r),c.value=r,i.value=!1};y({loadData:f});const x=r=>{if(A(r))return;const t=r,u=w(t.map(a=>a.customerCount)),m=w(t.map(a=>a.dealCount));t.forEach(a=>{a.sourcePortion=a.customerCount===0?0:v(a.customerCount,u),a.dealPortion=a.dealCount===0?0:v(a.dealCount,m)})};return T(()=>{f()}),(r,t)=>{const u=H,m=G,a=D,E=I,h=F,l=K,O=B,P=V,M=k;return C(),W(j,null,[e(h,{shadow:"never"},{default:o(()=>[e(E,{gutter:20},{default:o(()=>[e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(u,{height:500,options:s(n)},null,8,["options"])]),_:1},8,["loading"])]),_:1}),e(a,{span:12},{default:o(()=>[e(m,{loading:s(i),animated:""},{default:o(()=>[e(u,{height:500,options:s(d)},null,8,["options"])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(h,{class:"mt-16px",shadow:"never"},{default:o(()=>[q((C(),z(P,{data:s(c)},{default:o(()=>[e(l,{align:"center",label:"\u5E8F\u53F7",type:"index",width:"80"}),e(l,{align:"center",label:"\u5BA2\u6237\u6765\u6E90",prop:"source",width:"100"},{default:o(U=>[e(O,{type:s(p).CRM_CUSTOMER_SOURCE,value:U.row.source},null,8,["type","value"])]),_:1}),e(l,{align:"center",label:"\u5BA2\u6237\u4E2A\u6570","min-width":"200",prop:"customerCount"}),e(l,{align:"center",label:"\u6210\u4EA4\u4E2A\u6570","min-width":"200",prop:"dealCount"}),e(l,{align:"center",label:"\u6765\u6E90\u5360\u6BD4(%)","min-width":"200",prop:"sourcePortion"}),e(l,{align:"center",label:"\u6210\u4EA4\u5360\u6BD4(%)","min-width":"200",prop:"dealPortion"})]),_:1},8,["data"])),[[M,s(i)]])]),_:1})],64)}}});export{N as _};
