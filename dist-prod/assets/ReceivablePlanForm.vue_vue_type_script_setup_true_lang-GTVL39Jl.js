import{d as O,r as i,e as Q,o as n,q as v,w as u,f as l,x as D,u as a,y as S,c as w,p as I,F as g,O as Y,D as j,k as H,h as K,z as W,cT as X,b as Z,T as $,C as ee,E as le,A as ae,B as ue,i as re,bQ as de,G as te,J as se,I as oe,M as ne}from"./index-DPENBzsb.js";import{_ as ie}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{g as ce,c as me,u as pe}from"./index-NfHILKK3.js";import{g as fe}from"./index-Co9HWb9O.js";import{a as ve}from"./index-OU-fIsLR.js";import{d as be}from"./index-BRgO_Nxc.js";const _e=O({__name:"ReceivablePlanForm",emits:["success"],setup(Ve,{expose:F,emit:A}){const{t:U}=K(),T=W(),E=i([]),c=i(!1),R=i(""),m=i(!1),p=i(""),d=i({}),B=Q({price:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=i(),q=i([]),h=i([]);F({open:async(s,r,f,o)=>{if(c.value=!0,R.value=U("action."+s),p.value=s,z(),r){m.value=!0;try{const t=await ce(r);d.value=X(t),await k(t.customerId),d.value.contractId=t==null?void 0:t.contractId}finally{m.value=!1}}E.value=await fe(),q.value=await ve(),p.value==="create"&&(d.value.ownerUserId=Z().getUser.id),f&&(d.value.customerId=f,await k(f)),o&&(d.value.contractId=o)}});const M=A,P=async()=>{if(b&&await b.value.validate()){m.value=!0;try{const s=d.value;p.value==="create"?(await me(s),T.success(U("common.createSuccess"))):(await pe(s),T.success(U("common.updateSuccess"))),c.value=!1,M("success")}finally{m.value=!1}}},z=()=>{var s;d.value={},(s=b.value)==null||s.resetFields()},k=async s=>{d.value.contractId=void 0,s&&(h.value=[],h.value=await be(s))};return(s,r)=>{const f=$,o=ee,t=le,_=ae,V=ue,y=re,x=de,G=te,J=se,C=oe,L=ie,N=ne;return n(),v(L,{modelValue:a(c),"onUpdate:modelValue":r[10]||(r[10]=e=>H(c)?c.value=e:null),title:a(R)},{footer:u(()=>[l(C,{disabled:a(m),type:"primary",onClick:P},{default:u(()=>r[11]||(r[11]=[D("\u786E \u5B9A")])),_:1},8,["disabled"]),l(C,{onClick:r[9]||(r[9]=e=>c.value=!1)},{default:u(()=>r[12]||(r[12]=[D("\u53D6 \u6D88")])),_:1})]),default:u(()=>[S((n(),v(J,{ref_key:"formRef",ref:b,model:a(d),rules:a(B),"label-width":"110px"},{default:u(()=>[l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u8FD8\u6B3E\u671F\u6570",prop:"period"},{default:u(()=>[l(f,{modelValue:a(d).period,"onUpdate:modelValue":r[0]||(r[0]=e=>a(d).period=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:u(()=>[l(V,{modelValue:a(d).ownerUserId,"onUpdate:modelValue":r[1]||(r[1]=e=>a(d).ownerUserId=e),disabled:a(p)!=="create",class:"w-1/1"},{default:u(()=>[(n(!0),w(g,null,I(a(E),e=>(n(),v(_,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:u(()=>[l(V,{modelValue:a(d).customerId,"onUpdate:modelValue":r[2]||(r[2]=e=>a(d).customerId=e),disabled:a(p)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:k},{default:u(()=>[(n(!0),w(g,null,I(a(q),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:u(()=>[l(V,{modelValue:a(d).contractId,"onUpdate:modelValue":r[3]||(r[3]=e=>a(d).contractId=e),disabled:a(p)!=="create"||!a(d).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C"},{default:u(()=>[(n(!0),w(g,null,I(a(h),e=>(n(),v(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:u(()=>[l(x,{modelValue:a(d).price,"onUpdate:modelValue":r[4]||(r[4]=e=>a(d).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u8BA1\u5212\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:u(()=>[l(G,{modelValue:a(d).returnTime,"onUpdate:modelValue":r[5]||(r[5]=e=>a(d).returnTime=e),placeholder:"\u9009\u62E9\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:u(()=>[l(t,{span:12},{default:u(()=>[l(o,{label:"\u63D0\u524D\u51E0\u5929\u63D0\u9192",prop:"remindDays"},{default:u(()=>[l(x,{modelValue:a(d).remindDays,"onUpdate:modelValue":r[6]||(r[6]=e=>a(d).remindDays=e),class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u63D0\u524D\u51E0\u5929\u63D0\u9192"},null,8,["modelValue"])]),_:1})]),_:1}),l(t,{span:12},{default:u(()=>[l(o,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:u(()=>[l(V,{modelValue:a(d).returnType,"onUpdate:modelValue":r[7]||(r[7]=e=>a(d).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:u(()=>[(n(!0),w(g,null,I(a(Y)(a(j).CRM_RECEIVABLE_RETURN_TYPE),e=>(n(),v(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(t,{span:24},{default:u(()=>[l(o,{label:"\u5907\u6CE8",prop:"remark"},{default:u(()=>[l(f,{modelValue:a(d).remark,"onUpdate:modelValue":r[8]||(r[8]=e=>a(d).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[N,a(m)]])]),_:1},8,["modelValue","title"])}}});export{_e as _};
