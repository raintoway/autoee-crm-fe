import{d as N,r as m,n as X,o as u,c as Y,f as i,w as t,u as e,y as Z,q as d,x as f,a3 as y,F as ee,z as ae,a as ie,P as re,I as te,l as le,m as oe,E as se,U as me}from"./index-DPENBzsb.js";import{g as ue,_ as ne}from"./index-D9VBT2CA.js";import{u as pe}from"./tagsView-uxrzGHKp.js";import{g as ce,u as de,l as h,r as fe,p as ye}from"./index-OU-fIsLR.js";import{_ as _e}from"./CustomerForm.vue_vue_type_script_setup_true_lang-BDk16G-4.js";import{_ as ve}from"./CustomerDetailsInfo.vue_vue_type_script_setup_true_lang-aFreq8ka.js";import{_ as be}from"./CustomerDetailsHeader.vue_vue_type_script_setup_true_lang-DTKxwQtm.js";import{_ as ze}from"./ContactList.vue_vue_type_script_setup_true_lang-C4AvW2JP.js";import{_ as we}from"./ContractList.vue_vue_type_script_setup_true_lang-CYqttL5k.js";import{_ as Ce}from"./BusinessList.vue_vue_type_script_setup_true_lang-zEz5rimS.js";import{_ as ke}from"./ReceivableList.vue_vue_type_script_setup_true_lang-boZy12vZ.js";import{_ as Re}from"./ReceivablePlanList.vue_vue_type_script_setup_true_lang-IZFfLr7D.js";import{_ as Ue}from"./PermissionList.vue_vue_type_script_setup_true_lang-Ch3d1W7H.js";import{_ as Me}from"./TransferForm.vue_vue_type_script_setup_true_lang-BQHZ7ctl.js";import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang-BVFvTCKz.js";import{B as v}from"./index-Cb-L5Bqt.js";import{_ as Oe}from"./CustomerDistributeForm.vue_vue_type_script_setup_true_lang-CLzHYQr8.js";import"./el-timeline-item-DOhCPhED.js";import"./formatTime-C7TQtsxQ.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./index-gTb5e5TR.js";import"./tree-Cts6wVCK.js";import"./index-Co9HWb9O.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import"./el-descriptions-item-BD45d2S6.js";import"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import"./color-DXkOL5Tu.js";import"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import"./index-C2tU_CDa.js";import"./index-zBhacYdK.js";import"./ContactForm.vue_vue_type_script_setup_true_lang-CDIYsxb8.js";import"./ContactListModal.vue_vue_type_script_setup_true_lang-BDJxp_NS.js";import"./index-BRgO_Nxc.js";import"./ContractForm.vue_vue_type_script_setup_true_lang-CnyZ7o7h.js";import"./index-D0zCJsCp.js";import"./ContractProductForm.vue_vue_type_script_setup_true_lang-BE66Fj5y.js";import"./index-B6l7NQIx.js";import"./BusinessForm.vue_vue_type_script_setup_true_lang-aTUZuI7c.js";import"./index-Cj_ALIC1.js";import"./BusinessProductForm.vue_vue_type_script_setup_true_lang-z3hq65Lx.js";import"./BusinessListModal.vue_vue_type_script_setup_true_lang-B4bxVlIN.js";import"./index-DBsmcN-E.js";import"./ReceivableForm.vue_vue_type_script_setup_true_lang-Byp1QREC.js";import"./index-NfHILKK3.js";import"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-GTVL39Jl.js";import"./PermissionForm.vue_vue_type_script_setup_true_lang-DymHMb9s.js";import"./index-DvyG3vlo.js";import"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-DooL9HAc.js";import"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-B4zmNLSs.js";import"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-Cw7cyvrf.js";const Te=N({name:"CrmCustomerDetail",__name:"index",setup($e){const o=m(0),w=m(!0),s=ae(),{delView:I}=pe(),{push:x,currentRoute:F}=ie(),n=m(),a=m({}),_=async()=>{w.value=!0;try{a.value=await ce(o.value),await j()}finally{w.value=!1}},C=m(),P=()=>{var l;(l=C.value)==null||l.open("update",o.value)},q=async()=>{const l=!a.value.dealStatus;try{await s.confirm(`\u786E\u5B9A\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u4E3A\u3010${l?"\u5DF2\u6210\u4EA4":"\u672A\u6210\u4EA4"}\u3011\u5417\uFF1F`),await de(o.value,l),s.success("\u66F4\u65B0\u6210\u4EA4\u72B6\u6001\u6210\u529F"),await _()}catch{}},k=m(),L=()=>{var l;(l=k.value)==null||l.open(o.value)},W=async()=>{await s.confirm(`\u786E\u5B9A\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!0),s.success(`\u9501\u5B9A\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},B=async()=>{await s.confirm(`\u786E\u5B9A\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await h(e(o.value),!1),s.success(`\u89E3\u9501\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},D=async()=>{await s.confirm(`\u786E\u5B9A\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011 \u5417\uFF1F`),await fe([e(o.value)]),s.success(`\u9886\u53D6\u5BA2\u6237\u3010${a.value.name}\u3011\u6210\u529F`),await _()},R=m(),Q=async()=>{var l;(l=R.value)==null||l.open(o.value)},V=async()=>{await s.confirm(`\u786E\u5B9A\u5C06\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u5417\uFF1F`),await ye(e(o.value)),s.success(`\u5BA2\u6237\u3010${a.value.name}\u3011\u653E\u5165\u516C\u6D77\u6210\u529F`),z()},U=m([]),j=async()=>{if(!o.value)return;const l=await ue({bizType:v.CRM_CUSTOMER,bizId:o.value});U.value=l.list},M=m(),A=l=>{var r;(r=M.value)==null||r.createReceivable(l)},z=()=>{I(e(F)),x({name:"CrmCustomer"})},{params:S}=re();return X(()=>{if(!S.id)return s.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void z();o.value=S.id,_()}),(l,r)=>{const p=te,c=le,G=ne,H=oe,J=se,K=me("hasPermi");return u(),Y(ee,null,[i(be,{customer:e(a),loading:e(w)},{default:t(()=>{var b,O,T,$,E,g;return[(b=e(n))!=null&&b.validateWrite?Z((u(),d(p,{key:0,type:"primary",onClick:P},{default:t(()=>r[0]||(r[0]=[f(" \u7F16\u8F91 ")])),_:1})),[[K,["crm:customer:update"]]]):y("",!0),(O=e(n))!=null&&O.validateOwnerUser?(u(),d(p,{key:1,type:"primary",onClick:L},{default:t(()=>r[1]||(r[1]=[f(" \u8F6C\u79FB ")])),_:1})):y("",!0),(T=e(n))!=null&&T.validateWrite?(u(),d(p,{key:2,onClick:q},{default:t(()=>r[2]||(r[2]=[f(" \u66F4\u6539\u6210\u4EA4\u72B6\u6001 ")])),_:1})):y("",!0),e(a).lockStatus&&(($=e(n))!=null&&$.validateOwnerUser)?(u(),d(p,{key:3,onClick:B},{default:t(()=>r[3]||(r[3]=[f(" \u89E3\u9501 ")])),_:1})):y("",!0),!e(a).lockStatus&&((E=e(n))!=null&&E.validateOwnerUser)?(u(),d(p,{key:4,onClick:W},{default:t(()=>r[4]||(r[4]=[f(" \u9501\u5B9A ")])),_:1})):y("",!0),e(a).ownerUserId?y("",!0):(u(),d(p,{key:5,type:"primary",onClick:D},{default:t(()=>r[5]||(r[5]=[f(" \u9886\u53D6")])),_:1})),e(a).ownerUserId?y("",!0):(u(),d(p,{key:6,type:"primary",onClick:Q},{default:t(()=>r[6]||(r[6]=[f(" \u5206\u914D ")])),_:1})),e(a).ownerUserId&&((g=e(n))!=null&&g.validateOwnerUser)?(u(),d(p,{key:7,onClick:V},{default:t(()=>r[7]||(r[7]=[f(" \u653E\u5165\u516C\u6D77 ")])),_:1})):y("",!0)]}),_:1},8,["customer","loading"]),i(J,null,{default:t(()=>[i(H,null,{default:t(()=>[i(c,{label:"\u8DDF\u8FDB\u8BB0\u5F55"},{default:t(()=>[i(Se,{"biz-id":e(o),"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u57FA\u672C\u4FE1\u606F"},{default:t(()=>[i(ve,{customer:e(a)},null,8,["customer"])]),_:1}),i(c,{label:"\u8054\u7CFB\u4EBA",lazy:""},{default:t(()=>[i(ze,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u56E2\u961F\u6210\u5458"},{default:t(()=>{var b;return[i(Ue,{ref_key:"permissionListRef",ref:n,"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER,"show-action":!((b=e(n))!=null&&b.isPool)||!1,onQuitTeam:z},null,8,["biz-id","biz-type","show-action"])]}),_:1}),i(c,{label:"\u5546\u673A",lazy:""},{default:t(()=>[i(Ce,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u5408\u540C",lazy:""},{default:t(()=>[i(we,{"biz-id":e(a).id,"biz-type":e(v).CRM_CUSTOMER},null,8,["biz-id","biz-type"])]),_:1}),i(c,{label:"\u56DE\u6B3E",lazy:""},{default:t(()=>[i(Re,{"customer-id":e(a).id,onCreateReceivable:A},null,8,["customer-id"]),i(ke,{ref_key:"receivableListRef",ref:M,"customer-id":e(a).id},null,8,["customer-id"])]),_:1}),i(c,{label:"\u64CD\u4F5C\u65E5\u5FD7"},{default:t(()=>[i(G,{"log-list":e(U)},null,8,["log-list"])]),_:1})]),_:1})]),_:1}),i(_e,{ref_key:"formRef",ref:C,onSuccess:_},null,512),i(Oe,{ref_key:"distributeForm",ref:R,onSuccess:_},null,512),i(Me,{ref_key:"transferFormRef",ref:k,"biz-type":e(v).CRM_CUSTOMER,onSuccess:z},null,8,["biz-type"])],64)}}});export{Te as default};
