import{d as C,e as B,aw as R,n as F,o as T,c as O,g as E,u as g,aR as A,bb as z,r as W,q as N,w as _,f as y,x as M,k as $,z as j,ds as V,H as I,I as q,cg as H}from"./index-DPENBzsb.js";import{d as G}from"./download-oWiM5xVU.js";var X=Object.defineProperty,Y=Object.prototype.hasOwnProperty,L=Object.getOwnPropertySymbols,J=Object.prototype.propertyIsEnumerable,U=(m,e,t)=>e in m?X(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t,k=(m,e)=>{for(var t in e||(e={}))Y.call(e,t)&&U(m,t,e[t]);if(L)for(var t of L(e))J.call(e,t)&&U(m,t,e[t]);return m};/*!
 * Signature Pad v3.0.0-beta.4 | https://github.com/szimek/signature_pad
 * (c) 2020 Szymon Nowak | Released under the MIT license
 */class f{constructor(e,t,s){this.x=e,this.y=t,this.time=s||Date.now()}distanceTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}equals(e){return this.x===e.x&&this.y===e.y&&this.time===e.time}velocityFrom(e){return this.time!==e.time?this.distanceTo(e)/(this.time-e.time):0}}class D{constructor(e,t,s,o,i,l){this.startPoint=e,this.control2=t,this.control1=s,this.endPoint=o,this.startWidth=i,this.endWidth=l}static fromPoints(e,t){const s=this.calculateControlPoints(e[0],e[1],e[2]).c2,o=this.calculateControlPoints(e[1],e[2],e[3]).c1;return new D(e[1],s,o,e[2],t.start,t.end)}static calculateControlPoints(e,t,s){const o=e.x-t.x,i=e.y-t.y,l=t.x-s.x,r=t.y-s.y,c=(e.x+t.x)/2,n=(e.y+t.y)/2,h=(t.x+s.x)/2,a=(t.y+s.y)/2,p=Math.sqrt(o*o+i*i),d=Math.sqrt(l*l+r*r),u=d/(p+d),v=h+(c-h)*u,x=a+(n-a)*u,P=t.x-v,S=t.y-x;return{c1:new f(c+P,n+S),c2:new f(h+P,a+S)}}length(){let e,t,s=0;for(let o=0;o<=10;o+=1){const i=o/10,l=this.point(i,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this.point(i,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(o>0){const c=l-e,n=r-t;s+=Math.sqrt(c*c+n*n)}e=l,t=r}return s}point(e,t,s,o,i){return t*(1-e)*(1-e)*(1-e)+3*s*(1-e)*(1-e)*e+3*o*(1-e)*e*e+i*e*e*e}}class b{constructor(e,t={}){this.canvas=e,this.options=t,this._handleMouseDown=s=>{s.which===1&&(this._mouseButtonDown=!0,this._strokeBegin(s))},this._handleMouseMove=s=>{this._mouseButtonDown&&this._strokeMoveUpdate(s)},this._handleMouseUp=s=>{s.which===1&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(s))},this._handleTouchStart=s=>{if(s.preventDefault(),s.targetTouches.length===1){const o=s.changedTouches[0];this._strokeBegin(o)}},this._handleTouchMove=s=>{s.preventDefault();const o=s.targetTouches[0];this._strokeMoveUpdate(o)},this._handleTouchEnd=s=>{if(s.target===this.canvas){s.preventDefault();const o=s.changedTouches[0];this._strokeEnd(o)}},this.velocityFilterWeight=t.velocityFilterWeight||.7,this.minWidth=t.minWidth||.5,this.maxWidth=t.maxWidth||2.5,this.throttle="throttle"in t?t.throttle:16,this.minDistance="minDistance"in t?t.minDistance:5,this.dotSize=t.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=t.penColor||"black",this.backgroundColor=t.backgroundColor||"rgba(0,0,0,0)",this.onBegin=t.onBegin,this.onEnd=t.onEnd,this._strokeMoveUpdate=this.throttle?function(s,o=250){let i,l,r,c=0,n=null;const h=()=>{c=Date.now(),n=null,i=s.apply(l,r),n||(l=null,r=[])};return function(...a){const p=Date.now(),d=o-(p-c);return l=this,r=a,d<=0||d>o?(n&&(clearTimeout(n),n=null),c=p,i=s.apply(l,r),n||(l=null,r=[])):n||(n=window.setTimeout(h,d)),i}}(b.prototype._strokeUpdate,this.throttle):b.prototype._strokeUpdate,this._ctx=e.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:e,canvas:t}=this;e.fillStyle=this.backgroundColor,e.clearRect(0,0,t.width,t.height),e.fillRect(0,0,t.width,t.height),this._data=[],this._reset(),this._isEmpty=!0}fromDataURL(e,t={},s){const o=new Image,i=t.ratio||window.devicePixelRatio||1,l=t.width||this.canvas.width/i,r=t.height||this.canvas.height/i;this._reset(),o.onload=()=>{this._ctx.drawImage(o,0,0,l,r),s&&s()},o.onerror=c=>{s&&s(c)},o.src=e,this._isEmpty=!1}toDataURL(e="image/png",t){return e==="image/svg+xml"?this._toSVG():this.canvas.toDataURL(e,t)}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handleMouseDown),this.canvas.removeEventListener("pointermove",this._handleMouseMove),document.removeEventListener("pointerup",this._handleMouseUp),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(e){this.clear(),this._fromData(e,({color:t,curve:s})=>this._drawCurve({color:t,curve:s}),({color:t,point:s})=>this._drawDot({color:t,point:s})),this._data=e}toData(){return this._data}_strokeBegin(e){const t={color:this.penColor,points:[]};typeof this.onBegin=="function"&&this.onBegin(e),this._data.push(t),this._reset(),this._strokeUpdate(e)}_strokeUpdate(e){if(this._data.length===0)return void this._strokeBegin(e);const t=e.clientX,s=e.clientY,o=this._createPoint(t,s),i=this._data[this._data.length-1],l=i.points,r=l.length>0&&l[l.length-1],c=!!r&&o.distanceTo(r)<=this.minDistance,n=i.color;if(!r||!r||!c){const h=this._addPoint(o);r?h&&this._drawCurve({color:n,curve:h}):this._drawDot({color:n,point:o}),l.push({time:o.time,x:o.x,y:o.y})}}_strokeEnd(e){this._strokeUpdate(e),typeof this.onEnd=="function"&&this.onEnd(e)}_handlePointerEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("pointerdown",this._handleMouseDown),this.canvas.addEventListener("pointermove",this._handleMouseMove),document.addEventListener("pointerup",this._handleMouseUp)}_handleMouseEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor}_createPoint(e,t){const s=this.canvas.getBoundingClientRect();return new f(e-s.left,t-s.top,new Date().getTime())}_addPoint(e){const{_lastPoints:t}=this;if(t.push(e),t.length>2){t.length===3&&t.unshift(t[0]);const s=this._calculateCurveWidths(t[1],t[2]),o=D.fromPoints(t,s);return t.shift(),o}return null}_calculateCurveWidths(e,t){const s=this.velocityFilterWeight*t.velocityFrom(e)+(1-this.velocityFilterWeight)*this._lastVelocity,o=this._strokeWidth(s),i={end:o,start:this._lastWidth};return this._lastVelocity=s,this._lastWidth=o,i}_strokeWidth(e){return Math.max(this.maxWidth/(e+1),this.minWidth)}_drawCurveSegment(e,t,s){const o=this._ctx;o.moveTo(e,t),o.arc(e,t,s,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve({color:e,curve:t}){const s=this._ctx,o=t.endWidth-t.startWidth,i=2*Math.floor(t.length());s.beginPath(),s.fillStyle=e;for(let l=0;l<i;l+=1){const r=l/i,c=r*r,n=c*r,h=1-r,a=h*h,p=a*h;let d=p*t.startPoint.x;d+=3*a*r*t.control1.x,d+=3*h*c*t.control2.x,d+=n*t.endPoint.x;let u=p*t.startPoint.y;u+=3*a*r*t.control1.y,u+=3*h*c*t.control2.y,u+=n*t.endPoint.y;const v=Math.min(t.startWidth+n*o,this.maxWidth);this._drawCurveSegment(d,u,v)}s.closePath(),s.fill()}_drawDot({color:e,point:t}){const s=this._ctx,o=typeof this.dotSize=="function"?this.dotSize():this.dotSize;s.beginPath(),this._drawCurveSegment(t.x,t.y,o),s.closePath(),s.fillStyle=e,s.fill()}_fromData(e,t,s){for(const o of e){const{color:i,points:l}=o;if(l.length>1)for(let r=0;r<l.length;r+=1){const c=l[r],n=new f(c.x,c.y,c.time);this.penColor=i,r===0&&this._reset();const h=this._addPoint(n);h&&t({color:i,curve:h})}else this._reset(),s({color:i,point:l[0]})}}_toSVG(){const e=this._data,t=Math.max(window.devicePixelRatio||1,1),s=this.canvas.width/t,o=this.canvas.height/t,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",this.canvas.width.toString()),i.setAttribute("height",this.canvas.height.toString()),this._fromData(e,({color:c,curve:n})=>{const h=document.createElement("path");if(!(isNaN(n.control1.x)||isNaN(n.control1.y)||isNaN(n.control2.x)||isNaN(n.control2.y))){const a=`M ${n.startPoint.x.toFixed(3)},${n.startPoint.y.toFixed(3)} C ${n.control1.x.toFixed(3)},${n.control1.y.toFixed(3)} ${n.control2.x.toFixed(3)},${n.control2.y.toFixed(3)} ${n.endPoint.x.toFixed(3)},${n.endPoint.y.toFixed(3)}`;h.setAttribute("d",a),h.setAttribute("stroke-width",(2.25*n.endWidth).toFixed(3)),h.setAttribute("stroke",c),h.setAttribute("fill","none"),h.setAttribute("stroke-linecap","round"),i.appendChild(h)}},({color:c,point:n})=>{const h=document.createElement("circle"),a=typeof this.dotSize=="function"?this.dotSize():this.dotSize;h.setAttribute("r",a.toString()),h.setAttribute("cx",n.x.toString()),h.setAttribute("cy",n.y.toString()),h.setAttribute("fill",c),i.appendChild(h)});const l=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 ${s} ${o}" width="${s}" height="${o}">`;let r=i.innerHTML;if(r===void 0){const c=document.createElement("dummy"),n=i.childNodes;c.innerHTML="";for(let h=0;h<n.length;h+=1)c.appendChild(n[h].cloneNode(!0));r=c.innerHTML}return"data:image/svg+xml;base64,"+btoa(l+r+"</svg>")}}const K=["id","data-uid","disabled"];var w,Q=C(k(k({},{name:"Vue3Signature"}),{props:{sigOption:{type:Object,default:()=>({backgroundColor:"rgb(255,255,255)",penColor:"rgb(0, 0, 0)"})},w:{type:String,default:"100%"},h:{type:String,default:"100%"},clearOnResize:{type:Boolean,default:!1},waterMark:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},defaultUrl:{type:String,default:""}},emits:["begin","end"],setup(m,{expose:e,emit:t}){const s=m,o={width:"100%",height:"100%"};let i=B({sig:void 0,option:k({backgroundColor:"rgb(255,255,255)",penColor:"rgb(0, 0, 0)"},s.sigOption),uid:"canvas"+Math.random()});R(()=>s.disabled,a=>{a?i.sig.off():i.sig.on()});const l=()=>{i.sig.clear()},r=a=>a?i.sig.toDataURL(a):i.sig.toDataURL(),c=a=>{i.sig.fromDataURL(a)},n=()=>i.sig.isEmpty(),h=a=>{if(Object.prototype.toString.call(a)!="[object Object]")throw new Error("Expected Object, got "+typeof a+".");{let p=document.getElementById(i.uid),d={text:a.text||"",x:a.x||20,y:a.y||20,sx:a.sx||40,sy:a.sy||40},u=p.getContext("2d");u.font=a.font||"20px sans-serif",u.fillStyle=a.fillStyle||"#333",u.strokeStyle=a.strokeStyle||"#333",a.style=="all"?(u.fillText(d.text,d.x,d.y),u.strokeText(d.text,d.sx,d.sy)):a.style=="stroke"?u.strokeText(d.text,d.sx,d.sy):u.fillText(d.text,d.x,d.y),i.sig._isEmpty=!1}};return F(()=>{(()=>{let a=document.getElementById(i.uid);function p(d){let u;n()||(u=r());let v=Math.max(window.devicePixelRatio||1,1);const x=RegExp(/px/);d.width=x.test(s.w)?Number(s.w.replace(/px/g,""))*v:d.offsetWidth*v,d.height=x.test(s.h)?Number(s.h.replace(/px/g,""))*v:d.offsetHeight*v,d.getContext("2d").scale(v,v),l(),!s.clearOnResize&&u!==void 0&&c(u),Object.keys(s.waterMark).length&&h(s.waterMark)}i.sig=new b(a,i.option),i.sig.onBegin=d=>t("begin"),i.sig.onEnd=d=>t("end"),window.addEventListener("resize",()=>p(a)),p(a),s.defaultUrl!==""&&c(s.defaultUrl),s.disabled?i.sig.off():i.sig.on()})()}),e({save:r,clear:l,isEmpty:n,undo:()=>{let a=i.sig.toData();a&&(a.pop(),i.sig.fromData(a))},addWaterMark:h,fromDataURL:c}),(a,p)=>(T(),O("div",{style:A({width:m.w,height:m.h}),onTouchmove:p[0]||(p[0]=z(()=>{},["prevent"]))},[E("canvas",{id:g(i).uid,"data-uid":g(i).uid,disabled:g(i).disabled,style:o},null,8,K)],36))}})),Z=((w=Q).install=m=>{m.component(w.name,w)},w);const tt={class:"position-relative"},et={class:"dialog-footer"},st=C({__name:"SignDialog",emits:["success"],setup(m,{expose:e,emit:t}){const s=j(),o=W(!1),i=W();e({open:async()=>{o.value=!0}});const l=t,r=async()=>{s.success("\u7B7E\u540D\u4E0A\u4F20\u4E2D\u8BF7\u7A0D\u7B49\u3002\u3002\u3002");const c=await V({file:G.base64ToFile(i.value.save("image/png"),"\u7B7E\u540D")});l("success",c.data),o.value=!1};return(c,n)=>{const h=I,a=q,p=H;return T(),N(p,{modelValue:g(o),"onUpdate:modelValue":n[2]||(n[2]=d=>$(o)?o.value=d:null),title:"\u7B7E\u540D",width:"935"},{footer:_(()=>[E("div",et,[y(a,{onClick:n[1]||(n[1]=d=>o.value=!1)},{default:_(()=>n[4]||(n[4]=[M("\u53D6\u6D88")])),_:1}),y(a,{type:"primary",onClick:r},{default:_(()=>n[5]||(n[5]=[M(" \u63D0\u4EA4 ")])),_:1})])]),default:_(()=>[E("div",tt,[y(g(Z),{class:"b b-solid b-gray",ref_key:"signature",ref:i,w:"900px",h:"400px"},null,512),y(a,{class:"pos-absolute bottom-20px right-10px",type:"primary",text:"",size:"small",onClick:n[0]||(n[0]=d=>g(i).clear())},{default:_(()=>[y(h,{icon:"ep:delete",class:"mr-5px"}),n[3]||(n[3]=M(" \u6E05\u9664 "))]),_:1})])]),_:1},8,["modelValue"])}}});export{st as _};
