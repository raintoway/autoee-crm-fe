import{d as D,r as l,e as F,aw as H,o as d,c as K,f as a,w as r,x as p,u as s,y as v,q as m,a3 as w,t as G,dB as J,F as Q,z as V,a as W,H as $,I as X,i as Y,K as Z,ad as ee,L as ae,U as te,M as se}from"./index-DPENBzsb.js";import{_ as oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{b as re,a as ne}from"./index-D0zCJsCp.js";import{h as ce,i as le}from"./index-zBhacYdK.js";import{_ as ue}from"./BusinessForm.vue_vue_type_script_setup_true_lang-aTUZuI7c.js";import{B as S}from"./index-Cb-L5Bqt.js";import{_ as de}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-B4bxVlIN.js";const pe=D({name:"CrmBusinessList",__name:"BusinessList",props:{bizType:{},bizId:{},customerId:{},contactId:{}},setup(x){const f=V(),o=x,I=l(!0),k=l(0),z=l([]),t=F({pageNo:1,pageSize:10,customerId:void 0,contactId:void 0}),b=async()=>{I.value=!0;try{t.customerId=void 0,t.contactId=void 0;let i={list:[],total:0};switch(o.bizType){case S.CRM_CUSTOMER:t.customerId=o.bizId,i=await ne(t);break;case S.CRM_CONTACT:t.contactId=o.bizId,i=await re(t);break;default:return}z.value=i.list,k.value=i.total}finally{I.value=!1}},y=()=>{t.pageNo=1,b()},C=l(),T=()=>{C.value.open("create",null,o.customerId,o.contactId)},{push:B}=W(),h=l(),M=()=>{h.value.open()},U=async i=>{const e={contactId:o.bizId,businessIds:i};_.value.getSelectionRows().forEach(u=>{e.businessIds.push(u.id)}),await ce(e),f.success("\u5173\u8054\u5546\u673A\u6210\u529F"),y()},_=l(),L=async()=>{const i={contactId:o.bizId,businessIds:_.value.getSelectionRows().map(e=>e.id)};if(i.businessIds.length===0)return f.error("\u672A\u9009\u62E9\u5546\u673A");await le(i),f.success("\u53D6\u5173\u5546\u673A\u6210\u529F"),y()};return H(()=>[o.bizId,o.bizType],()=>{y()},{immediate:!0,deep:!0}),(i,e)=>{const u=$,g=X,E=Y,n=Z,O=ee,P=ae,j=ie,q=oe,N=te("hasPermi"),A=se;return d(),K(Q,null,[a(E,{justify:"end"},{default:r(()=>[a(g,{onClick:T},{default:r(()=>[a(u,{class:"mr-5px",icon:"ep:opportunity"}),e[2]||(e[2]=p(" \u521B\u5EFA\u5546\u673A "))]),_:1}),s(t).contactId?v((d(),m(g,{key:0,onClick:M},{default:r(()=>[a(u,{class:"mr-5px",icon:"ep:circle-plus"}),e[3]||(e[3]=p("\u5173\u8054 "))]),_:1})),[[N,["crm:contact:create-business"]]]):w("",!0),s(t).contactId?v((d(),m(g,{key:1,onClick:L},{default:r(()=>[a(u,{class:"mr-5px",icon:"ep:remove"}),e[4]||(e[4]=p("\u89E3\u9664\u5173\u8054 "))]),_:1})),[[N,["crm:contact:delete-business"]]]):w("",!0)]),_:1}),a(q,{class:"mt-10px"},{default:r(()=>[v((d(),m(P,{ref_key:"businessRef",ref:_,data:s(z),stripe:!0,"show-overflow-tooltip":!0},{default:r(()=>[s(t).contactId?(d(),m(n,{key:0,type:"selection",width:"55"})):w("",!0),a(n,{label:"\u5546\u673A\u540D\u79F0",fixed:"left",align:"center",prop:"name"},{default:r(c=>[a(O,{type:"primary",underline:!1,onClick:me=>{return R=c.row.id,void B({name:"CrmBusinessDetail",params:{id:R}});var R}},{default:r(()=>[p(G(c.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(n,{label:"\u5546\u673A\u91D1\u989D",align:"center",prop:"price",formatter:s(J)},null,8,["formatter"]),a(n,{label:"\u5BA2\u6237\u540D\u79F0",align:"center",prop:"customerName"}),a(n,{label:"\u5546\u673A\u7EC4",align:"center",prop:"statusTypeName"}),a(n,{label:"\u5546\u673A\u9636\u6BB5",align:"center",prop:"statusName"})]),_:1},8,["data"])),[[A,s(I)]]),a(j,{total:s(k),page:s(t).pageNo,"onUpdate:page":e[0]||(e[0]=c=>s(t).pageNo=c),limit:s(t).pageSize,"onUpdate:limit":e[1]||(e[1]=c=>s(t).pageSize=c),onPagination:b},null,8,["total","page","limit"])]),_:1}),a(ue,{ref_key:"formRef",ref:C,onSuccess:b},null,512),a(de,{ref_key:"businessModalRef",ref:h,"customer-id":o.customerId,onSuccess:U},null,8,["customer-id"])],64)}}});export{pe as _};
