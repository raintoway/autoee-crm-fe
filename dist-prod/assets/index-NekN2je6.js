import{d as j,h as A,z as B,r as u,a1 as D,o as x,q as V,w as d,f as n,u as o,x as b,y as G,k as g,ca as W,E as H,bX as J,i as K,I as L,M as O,_ as P}from"./index-DPENBzsb.js";import{_ as Q}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{_ as T}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{d as Y,h as Z}from"./tree-Cts6wVCK.js";import{g as $}from"./index-BUzABQZW.js";import{g as ee}from"./index-Co9HWb9O.js";const ae=P(j({name:"UserSelectForm",__name:"index",emits:["confirm"],setup(le,{expose:w,emit:C}){const I=C,{t:U}=A(),E=B(),f=u([]),m=u([]),i=u([]),v=u([]),l=u([]),r=u(!1),p=u(!1),_=u(),S=D(()=>[...i.value.filter(a=>l.value.includes(a.id)),...v.value.filter(a=>!l.value.includes(a.id))]),y=(a,e)=>{const s=[a];return e.filter(t=>t.parentId===a).forEach(t=>{s.push(...y(t.id,e))}),s},q=async()=>{try{E.success(U("common.updateSuccess")),r.value=!1;const a=i.value.filter(e=>l.value.includes(e.id));I("confirm",_.value,a)}finally{}},z=()=>{f.value=[],m.value=[],i.value=[],v.value=[],l.value=[]},F=a=>{(async e=>{p.value=!0;try{if(!e)return void(v.value=[...i.value]);const s=y(e,m.value);v.value=i.value.filter(t=>s.includes(t.deptId))}finally{p.value=!1}})(a.id)};return w({open:async(a,e)=>{_.value=a,z();const s=await $();m.value=s,f.value=Z(s),i.value=await ee(),v.value=[...i.value],l.value=(e==null?void 0:e.map(t=>t.id))||[],r.value=!0}}),(a,e)=>{const s=W,t=T,h=H,M=J,N=K,k=L,R=Q,X=O;return x(),V(R,{modelValue:o(r),"onUpdate:modelValue":e[2]||(e[2]=c=>g(r)?r.value=c:null),title:"\u4EBA\u5458\u9009\u62E9",width:"800"},{footer:d(()=>{var c;return[n(k,{disabled:o(p)||!((c=o(l))!=null&&c.length),type:"primary",onClick:q},{default:d(()=>e[3]||(e[3]=[b(" \u786E \u5B9A ")])),_:1},8,["disabled"]),n(k,{onClick:e[1]||(e[1]=se=>r.value=!1)},{default:d(()=>e[4]||(e[4]=[b("\u53D6 \u6D88")])),_:1})]}),default:d(()=>[G((x(),V(N,{class:"gap2"},{default:d(()=>[n(h,{span:6},{default:d(()=>[n(t,{class:"h-1/1"},{default:d(()=>[n(s,{ref:"treeRef",data:o(f),"expand-on-click-node":!1,props:o(Y),"default-expand-all":"","highlight-current":"","node-key":"id",onNodeClick:F},null,8,["data","props"])]),_:1})]),_:1}),n(h,{span:17},{default:d(()=>[n(M,{modelValue:o(l),"onUpdate:modelValue":e[0]||(e[0]=c=>g(l)?l.value=c:null),titles:["\u672A\u9009","\u5DF2\u9009"],filterable:"","filter-placeholder":"\u641C\u7D22\u6210\u5458",data:o(S),props:{label:"nickname",key:"id"}},null,8,["modelValue","data"])]),_:1})]),_:1})),[[X,o(p)]])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-07642267"]]);export{ae as _};
