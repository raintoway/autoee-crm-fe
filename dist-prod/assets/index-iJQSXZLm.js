import{_ as J}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{d as K,av as Q,r as s,aw as Y,n as Z,ax as $,o as p,q as U,w as C,g as i,f as c,u as t,t as I,c as R,p as ee,W as S,F as ae,x as T,a3 as f,k as v,y as te,a2 as re,a as ie,P as le,z as se,ay as z,am as oe,H as me,I as ue,_ as pe}from"./index-DPENBzsb.js";import{g as ne,u as A,c as O,d as ce}from"./index-CmUERCts.js";import{a as de}from"./index-BOzeB1Pk.js";import{C as fe}from"./index-C_gZe85y.js";import{g as ve}from"./index-Co9HWb9O.js";import{a as L,B as ye,b as we}from"./constants-C8tGWvl2.js";import xe from"./BasicInfo-D9psmix0.js";import{_ as he}from"./FormDesign.vue_vue_type_script_setup_true_lang-5EUOZc0s.js";import{_ as ge}from"./ProcessDesign.vue_vue_type_script_setup_true_lang-Cy3QasGT.js";import{u as be}from"./tagsView-uxrzGHKp.js";import{_ as ke}from"./ExtraSettings.vue_vue_type_script_setup_true_lang-DP524vq2.js";import"./index-NekN2je6.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./tree-Cts6wVCK.js";import"./index-BUzABQZW.js";import"./el-avatar-BjIHlmF4.js";import"./formCreate-BQ5MeUYD.js";import"./index.vue_vue_type_style_index_0_lang-BKOp3ujK.js";import"./bpmn-embedded-BBruoZr8.js";import"./XTextButton-CaCskr4h.js";import"./XButton-lfojvuGT.js";import"./consts-Dqfik1EE.js";import"./utils-CjFsbWby.js";import"./index-D2cLVQ1T.js";import"./index-BCN8BzfC.js";import"./el-tree-select-DxCa0FGQ.js";import"./index-tb7T-AVj.js";import"./index-Btz8nVwe.js";import"./index-BAEJzc7Z.js";import"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import"./index-C2tU_CDa.js";import"./index-O66V04DS.js";import"./el-drawer-DSddsvoD.js";import"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import"./color-DXkOL5Tu.js";import"./index-IbQXwv2T.js";import"./formatTime-C7TQtsxQ.js";import"./SimpleModelDesign.vue_vue_type_script_setup_true_lang-DPGrodRB.js";import"./simple-process-designer-RJplQ98g.js";import"./el-space-B67e9bQY.js";import"./download-oWiM5xVU.js";const _e={class:"mx-auto"},Ve={class:"absolute top-0 left-0 right-0 h-50px bg-white border-bottom z-10 flex items-center px-20px"},Ue={class:"w-200px flex items-center overflow-hidden"},Ce=["title"],Ie={class:"flex-1 flex items-center justify-center h-full"},Re={class:"w-400px flex items-center justify-between h-full"},Le=["onClick"],Me={class:"text-16px font-bold whitespace-nowrap"},Be={class:"w-200px flex items-center justify-end gap-2"},Pe={class:"mt-50px"},De={key:0,class:"mx-auto w-560px"},je={key:1,class:"mx-auto w-560px"},Ee={class:"mx-auto w-700px"},Ne=K({__name:"index",setup(Te){const m=ie(),{delView:y}=be(),w=le(),u=se(),q=Q(),x=s(),h=s(),g=s(),M=s(),b=async()=>{var a;await((a=x.value)==null?void 0:a.validate())},k=async()=>{var a;await((a=h.value)==null?void 0:a.validate())},_=async()=>{var a;await((a=g.value)==null?void 0:a.validate())},l=s(-1),F=[{title:"\u57FA\u672C\u4FE1\u606F",validator:b},{title:"\u8868\u5355\u8BBE\u8BA1",validator:k},{title:"\u6D41\u7A0B\u8BBE\u8BA1",validator:_},{title:"\u66F4\u591A\u8BBE\u7F6E",validator:null}],e=s({id:void 0,name:"",key:"",category:void 0,icon:void 0,description:"",type:L.BPMN,formType:ye.NORMAL,formId:"",formCustomCreatePath:"",formCustomViewPath:"",visible:!0,startUserType:void 0,startUserIds:[],managerUserIds:[],allowCancelRunningProcess:!0,processIdRule:{enable:!1,prefix:"",infix:"",postfix:"",length:5},autoApprovalType:we.NONE,titleSetting:{enable:!1,title:""},summarySetting:{enable:!1,summary:[]}}),V=s();z("processData",V),z("modelData",e);const B=s([]),P=s([]),D=s([]);Y(async()=>e.value.type,()=>{e.value.type===L.BPMN?V.value=e.value.bpmnXml:e.value.type===L.SIMPLE&&(V.value=e.value.simpleModel)},{immediate:!0});const j=async()=>{try{try{await b()}catch{throw l.value=0,new Error("\u8BF7\u5B8C\u5584\u57FA\u672C\u4FE1\u606F")}try{await k()}catch{throw l.value=1,new Error("\u8BF7\u5B8C\u5584\u81EA\u5B9A\u4E49\u8868\u5355\u4FE1\u606F")}try{await _()}catch{throw l.value=2,new Error("\u8BF7\u8BBE\u8BA1\u6D41\u7A0B")}return!0}catch(a){throw a}},H=async()=>{try{await j();const a={...e.value};if(e.value.id){await A(a);try{await u.confirm("\u4FEE\u6539\u6D41\u7A0B\u6210\u529F\uFF0C\u662F\u5426\u53D1\u5E03\u6D41\u7A0B\uFF1F"),await E()}catch{}}else{e.value.id=await O(a);try{await u.confirm("\u6D41\u7A0B\u521B\u5EFA\u6210\u529F\uFF0C\u662F\u5426\u7EE7\u7EED\u7F16\u8F91\uFF1F"),await oe(),y(t(m.currentRoute)),await m.push({name:"BpmModelUpdate",params:{id:e.value.id}})}catch{y(t(m.currentRoute)),await m.push({name:"BpmModel"})}}}catch(a){u.warning(a.message||"\u8BF7\u5B8C\u5584\u6240\u6709\u6B65\u9AA4\u7684\u5FC5\u586B\u4FE1\u606F")}},E=async()=>{try{e.value.id||await u.confirm("\u662F\u5426\u786E\u8BA4\u53D1\u5E03\u8BE5\u6D41\u7A0B\uFF1F"),await j();const a={...e.value};if(e.value.id)await A(a);else{const r=await O(a);e.value.id=r.id}await ce(e.value.id),u.success("\u53D1\u5E03\u6210\u529F"),await m.push({name:"BpmModel"})}catch(a){u.warning(a.message||"\u53D1\u5E03\u5931\u8D25")}},W=()=>{y(t(m.currentRoute)),m.push({name:"BpmModel"})};return Z(async()=>{await(async()=>{var r;const a=w.params.id;a?(e.value=await ne(a),e.value.startUserType=((r=e.value.startUserIds)==null?void 0:r.length)>0?1:0,w.params.type==="copy"&&(delete e.value.id,e.value.name+="\u526F\u672C",e.value.key+="_copy")):(e.value.startUserType=0,e.value.managerUserIds.push(q.getUser.id)),B.value=await de(),P.value=await fe.getCategorySimpleList(),D.value=await ve(),l.value=0,M.value.initData()})()}),$(()=>{x.value=null,h.value=null,g.value=null}),(a,r)=>{const X=me,N=ue,G=J;return p(),U(G,null,{default:C(()=>[i("div",_e,[i("div",Ve,[i("div",Ue,[c(X,{icon:"ep:arrow-left",class:"cursor-pointer flex-shrink-0",onClick:W}),i("span",{class:"ml-10px text-16px truncate",title:t(e).name||"\u521B\u5EFA\u6D41\u7A0B"},I(t(e).name||"\u521B\u5EFA\u6D41\u7A0B"),9,Ce)]),i("div",Ie,[i("div",Re,[(p(),R(ae,null,ee(F,(o,n)=>i("div",{key:n,class:S(["flex items-center cursor-pointer mx-15px relative h-full",[t(l)===n?"text-[#3473ff] border-[#3473ff] border-b-2 border-b-solid":"text-gray-500"]]),onClick:ze=>(async d=>{try{d!==0&&await b(),d!==1&&await k(),d!==2&&await _(),l.value=d}catch{u.warning("\u8BF7\u5148\u5B8C\u5584\u5F53\u524D\u6B65\u9AA4\u5FC5\u586B\u4FE1\u606F")}})(n)},[i("div",{class:S(["w-28px h-28px rounded-full flex items-center justify-center mr-8px border-2 border-solid text-15px",[t(l)===n?"bg-[#3473ff] text-white border-[#3473ff]":"border-gray-300 bg-white text-gray-500"]])},I(n+1),3),i("span",Me,I(o.title),1)],10,Le)),64))])]),i("div",Be,[t(w).params.id?(p(),U(N,{key:0,type:"success",onClick:E},{default:C(()=>r[4]||(r[4]=[T("\u53D1 \u5E03")])),_:1})):f("",!0),c(N,{type:"primary",onClick:H},{default:C(()=>r[5]||(r[5]=[T("\u4FDD \u5B58")])),_:1})])]),i("div",Pe,[t(l)===0?(p(),R("div",De,[c(xe,{modelValue:t(e),"onUpdate:modelValue":r[0]||(r[0]=o=>v(e)?e.value=o:null),categoryList:t(P),userList:t(D),ref_key:"basicInfoRef",ref:x},null,8,["modelValue","categoryList","userList"])])):f("",!0),t(l)===1?(p(),R("div",je,[c(he,{modelValue:t(e),"onUpdate:modelValue":r[1]||(r[1]=o=>v(e)?e.value=o:null),formList:t(B),ref_key:"formDesignRef",ref:h},null,8,["modelValue","formList"])])):f("",!0),t(l)===2?(p(),U(ge,{key:2,modelValue:t(e),"onUpdate:modelValue":r[2]||(r[2]=o=>v(e)?e.value=o:null),ref_key:"processDesignRef",ref:g},null,8,["modelValue"])):f("",!0),te(i("div",Ee,[c(ke,{modelValue:t(e),"onUpdate:modelValue":r[3]||(r[3]=o=>v(e)?e.value=o:null),ref_key:"extraSettingsRef",ref:M},null,8,["modelValue"])],512),[[re,t(l)===3]])])])]),_:1})}}}),Se=pe(Ne,[["__scopeId","data-v-0bcac68f"]]);export{Se as default};
