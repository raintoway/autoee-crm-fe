import{d as X,r as u,e as Z,n as ee,o,c as f,f as a,w as s,u as l,F as b,p as g,q as m,N as A,O as ae,D as E,x as _,y as x,t as le,a3 as te,a as re,P as se,z as oe,h as ie,aq as ne,A as de,B as pe,C as me,T as ue,G as ce,H as fe,I as be,J as _e,K as we,L as ye,U as he,M as ge}from"./index-DPENBzsb.js";import{_ as ve}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{_ as Ve}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{_ as Te}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as xe}from"./index-CbaPuDB3.js";import{d as K}from"./formatTime-C7TQtsxQ.js";import{b as Se,c as ke}from"./index-DetSWMsK.js";import{g as Ue}from"./index-Co9HWb9O.js";import{a as Pe}from"./index-B9xqy6_R.js";import{p as De}from"./index-BCN8BzfC.js";import"./index-C2tU_CDa.js";import"./color-DXkOL5Tu.js";const Ce=X({name:"BpmProcessInstanceReport",__name:"index",setup(Ne){const z=re(),{query:S}=se(),H=oe(),{t:k}=ie(),v=u(!0),U=u(0),P=u([]),V=u(),O=S.processDefinitionId,r=Z({pageNo:1,pageSize:10,startUserId:void 0,name:"",processDefinitionKey:S.processDefinitionKey,status:void 0,createTime:[],endTime:[],formFieldsParams:{}}),D=u(),C=u([]),w=async()=>{v.value=!0;try{const i=await Se({...r,formFieldsParams:JSON.stringify(r.formFieldsParams)});P.value=i.list,U.value=i.total}finally{v.value=!1}},R=i=>{const t=[];return i&&i.forEach(T=>{De(JSON.parse(T),t)}),t},y=()=>{r.pageNo=1,w()},J=()=>{D.value.resetFields(),r.formFieldsParams={},y()};return ee(async()=>{await(async()=>{const i=await Pe(O);V.value=R(i.formFields)})(),await w(),C.value=await Ue()}),(i,t)=>{const T=xe,N=de,F=pe,d=me,I=ue,M=ce,Y=fe,h=be,$=_e,B=Te,p=we,G=Ve,L=ye,j=ve,q=he("hasPermi"),Q=ge;return o(),f(b,null,[a(T,{title:"\u5DE5\u4F5C\u6D41\u624B\u518C",url:"https://doc.iocoder.cn/bpm/"}),a(B,null,{default:s(()=>[a($,{class:"-mb-15px",model:l(r),ref_key:"queryFormRef",ref:D,inline:!0,"label-width":"68px"},{default:s(()=>[a(d,{label:"\u53D1\u8D77\u4EBA",prop:"startUserId"},{default:s(()=>[a(F,{modelValue:l(r).startUserId,"onUpdate:modelValue":t[0]||(t[0]=e=>l(r).startUserId=e),placeholder:"\u8BF7\u9009\u62E9\u53D1\u8D77\u4EBA",class:"!w-240px"},{default:s(()=>[(o(!0),f(b,null,g(l(C),e=>(o(),m(N,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u6D41\u7A0B\u540D\u79F0",prop:"name"},{default:s(()=>[a(I,{modelValue:l(r).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(r).name=e),placeholder:"\u8BF7\u8F93\u5165\u6D41\u7A0B\u540D\u79F0",clearable:"",onKeyup:A(y,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status"},{default:s(()=>[a(F,{modelValue:l(r).status,"onUpdate:modelValue":t[2]||(t[2]=e=>l(r).status=e),placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u72B6\u6001",clearable:"",class:"!w-240px"},{default:s(()=>[(o(!0),f(b,null,g(l(ae)(l(E).BPM_PROCESS_INSTANCE_STATUS),e=>(o(),m(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u53D1\u8D77\u65F6\u95F4",prop:"createTime"},{default:s(()=>[a(M,{modelValue:l(r).createTime,"onUpdate:modelValue":t[3]||(t[3]=e=>l(r).createTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),a(d,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:s(()=>[a(M,{modelValue:l(r).endTime,"onUpdate:modelValue":t[4]||(t[4]=e=>l(r).endTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","default-time":[new Date("1 00:00:00"),new Date("1 23:59:59")],class:"!w-240px"},null,8,["modelValue","default-time"])]),_:1}),(o(!0),f(b,null,g(l(V),(e,c)=>(o(),m(d,{key:c,label:e.title,prop:e.field},{default:s(()=>[a(I,{disabled:e.type!=="input",modelValue:l(r).formFieldsParams[e.field],"onUpdate:modelValue":n=>l(r).formFieldsParams[e.field]=n,placeholder:`\u8BF7\u8F93\u5165${e.title}`,clearable:"",onKeyup:A(y,["enter"]),class:"!w-240px"},null,8,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]))),128)),a(d,null,{default:s(()=>[a(h,{onClick:y},{default:s(()=>[a(Y,{icon:"ep:search",class:"mr-5px"}),t[7]||(t[7]=_(" \u641C\u7D22"))]),_:1}),a(h,{onClick:J},{default:s(()=>[a(Y,{icon:"ep:refresh",class:"mr-5px"}),t[8]||(t[8]=_(" \u91CD\u7F6E"))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(B,null,{default:s(()=>[x((o(),m(L,{border:"",data:l(P)},{default:s(()=>[a(p,{label:"\u6D41\u7A0B\u540D\u79F0",align:"center",prop:"name",fixed:"left",width:"200"}),a(p,{label:"\u6D41\u7A0B\u53D1\u8D77\u4EBA",align:"center",prop:"startUser.nickname",width:"120"}),a(p,{label:"\u6D41\u7A0B\u72B6\u6001",prop:"status",width:"120"},{default:s(e=>[a(G,{type:l(E).BPM_PROCESS_INSTANCE_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),a(p,{label:"\u53D1\u8D77\u65F6\u95F4",align:"center",prop:"startTime",width:"180",formatter:l(K)},null,8,["formatter"]),a(p,{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"endTime",width:"180",formatter:l(K)},null,8,["formatter"]),(o(!0),f(b,null,g(l(V),(e,c)=>(o(),m(p,{key:c,label:e.title,prop:e.field,width:"120"},{default:s(n=>[_(le(n.row.formVariables[e.field]??""),1)]),_:2},1032,["label","prop"]))),128)),a(p,{label:"\u64CD\u4F5C",align:"center",fixed:"right",width:"180"},{default:s(e=>[x((o(),m(h,{link:"",type:"primary",onClick:c=>{return n=e.row,void z.push({name:"BpmProcessInstanceDetail",query:{id:n.id}});var n}},{default:s(()=>t[9]||(t[9]=[_(" \u8BE6\u60C5 ")])),_:2},1032,["onClick"])),[[q,["bpm:process-instance:cancel"]]]),e.row.status===1?x((o(),m(h,{key:0,link:"",type:"primary",onClick:c=>(async n=>{const{value:W}=await ne.prompt("\u8BF7\u8F93\u5165\u53D6\u6D88\u539F\u56E0","\u53D6\u6D88\u6D41\u7A0B",{confirmButtonText:k("common.ok"),cancelButtonText:k("common.cancel"),inputPattern:/^[\s\S]*.*\S[\s\S]*$/,inputErrorMessage:"\u53D6\u6D88\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A"});await ke(n.id,W),H.success("\u53D6\u6D88\u6210\u529F"),await w()})(e.row)},{default:s(()=>t[10]||(t[10]=[_(" \u53D6\u6D88 ")])),_:2},1032,["onClick"])),[[q,["bpm:process-instance:query"]]]):te("",!0)]),_:1})]),_:1},8,["data"])),[[Q,l(v)]]),a(j,{total:l(U),page:l(r).pageNo,"onUpdate:page":t[5]||(t[5]=e=>l(r).pageNo=e),limit:l(r).pageSize,"onUpdate:limit":t[6]||(t[6]=e=>l(r).pageSize=e),onPagination:w},null,8,["total","page","limit"])]),_:1})],64)}}});export{Ce as default};
