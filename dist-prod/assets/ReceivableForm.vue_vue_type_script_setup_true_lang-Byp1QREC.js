import{d as Y,r as c,e as j,o as i,q as m,w as t,f as d,x as P,u,y as H,c as V,p as y,F as w,O as K,D as W,k as X,h as Z,z as $,b as ee,T as le,C as ae,E as ue,A as de,B as te,i as re,bQ as se,G as oe,J as ne,I as ie,M as ce}from"./index-DPENBzsb.js";import{_ as pe}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{b as me}from"./index-NfHILKK3.js";import{g as fe,c as ve,u as be}from"./index-DBsmcN-E.js";import{g as _e}from"./index-Co9HWb9O.js";import{a as Ie}from"./index-OU-fIsLR.js";import{d as Ve}from"./index-BRgO_Nxc.js";const ye=Y({__name:"ReceivableForm",emits:["success"],setup(we,{expose:S,emit:A}){const{t:T}=Z(),C=$(),E=c([]),f=c(!1),R=c(""),v=c(!1),p=c(""),l=c({}),B=j({customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],contractId:[{required:!0,message:"\u5408\u540C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnTime:[{required:!0,message:"\u56DE\u6B3E\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],price:[{required:!0,message:"\u56DE\u6B3E\u91D1\u989D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),g=c(),q=c([]),U=c([]),h=c([]);S({open:async(r,a,s)=>{var n;if(f.value=!0,R.value=T("action."+r),p.value=r,G(),a){v.value=!0;try{const o=await fe(a);l.value=o,await k(o.customerId),l.value.contractId=(n=o==null?void 0:o.contract)==null?void 0:n.id}finally{v.value=!1}}E.value=await _e(),q.value=await Ie(),p.value==="create"&&(l.value.ownerUserId=ee().getUser.id),s&&(l.value.customerId=s.customerId,await k(s.customerId),l.value.contractId=s.contractId,await x(s.contractId),s.id&&(l.value.planId=s.id,l.value.price=s.price,l.value.returnType=s.returnType))}});const D=A,z=async()=>{if(g&&await g.value.validate()){v.value=!0;try{const r=l.value;p.value==="create"?(await ve(r),C.success(T("common.createSuccess"))):(await be(r),C.success(T("common.updateSuccess"))),f.value=!1,D("success")}finally{v.value=!1}}},G=()=>{var r;l.value={},(r=g.value)==null||r.resetFields()},k=async r=>{l.value.contractId=void 0,r&&(U.value=[],U.value=await Ve(r))},x=async r=>{if(l.value.planId=void 0,r){h.value=[],h.value=await me(l.value.customerId,r);const a=U.value.find(s=>s.id===r);a&&(l.value.price=a.totalPrice-a.totalReceivablePrice)}},J=r=>{if(!r)return;const a=h.value.find(s=>s.id===r);a&&(l.value.price=a.price,l.value.returnType=a.returnType)};return(r,a)=>{const s=le,n=ae,o=ue,b=de,_=te,I=re,L=se,M=oe,N=ne,F=ie,O=pe,Q=ce;return i(),m(O,{modelValue:u(f),"onUpdate:modelValue":a[10]||(a[10]=e=>X(f)?f.value=e:null),title:u(R)},{footer:t(()=>[d(F,{disabled:u(v),type:"primary",onClick:z},{default:t(()=>a[11]||(a[11]=[P("\u786E \u5B9A")])),_:1},8,["disabled"]),d(F,{onClick:a[9]||(a[9]=e=>f.value=!1)},{default:t(()=>a[12]||(a[12]=[P("\u53D6 \u6D88")])),_:1})]),default:t(()=>[H((i(),m(N,{ref_key:"formRef",ref:g,model:u(l),rules:u(B),"label-width":"100px"},{default:t(()=>[d(I,null,{default:t(()=>[d(o,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"},{default:t(()=>[d(s,{modelValue:u(l).no,"onUpdate:modelValue":a[0]||(a[0]=e=>u(l).no=e),disabled:"",placeholder:"\u4FDD\u5B58\u65F6\u81EA\u52A8\u751F\u6210"},null,8,["modelValue"])]),_:1})]),_:1}),d(o,{span:12},{default:t(()=>[d(n,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:t(()=>[d(_,{modelValue:u(l).ownerUserId,"onUpdate:modelValue":a[1]||(a[1]=e=>u(l).ownerUserId=e),disabled:u(p)!=="create",class:"w-1/1"},{default:t(()=>[(i(!0),V(w,null,y(u(E),e=>(i(),m(b,{key:e.id,label:e.nickname,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(o,{span:12},{default:t(()=>[d(n,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:t(()=>[d(_,{modelValue:u(l).customerId,"onUpdate:modelValue":a[2]||(a[2]=e=>u(l).customerId=e),disabled:u(p)!=="create",class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",onChange:k},{default:t(()=>[(i(!0),V(w,null,y(u(q),e=>(i(),m(b,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),d(o,{span:12},{default:t(()=>[d(n,{label:"\u5408\u540C\u540D\u79F0",prop:"contractId"},{default:t(()=>[d(_,{modelValue:u(l).contractId,"onUpdate:modelValue":a[3]||(a[3]=e=>u(l).contractId=e),disabled:u(p)!=="create"||!u(l).customerId,class:"w-1/1",filterable:"",placeholder:"\u8BF7\u9009\u62E9\u5408\u540C",onChange:x},{default:t(()=>[(i(!0),V(w,null,y(u(U),e=>(i(),m(b,{key:e.id,disabled:e.auditStatus!==20,label:e.name,value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(o,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u671F\u6570",prop:"planId"},{default:t(()=>[d(_,{modelValue:u(l).planId,"onUpdate:modelValue":a[4]||(a[4]=e=>u(l).planId=e),disabled:u(p)!=="create"||!u(l).contractId,class:"!w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u671F\u6570",onChange:J},{default:t(()=>[(i(!0),V(w,null,y(u(h),e=>(i(),m(b,{key:e.id,disabled:e.receivableId,label:"\u7B2C "+e.period+" \u671F",value:e.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),d(o,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType"},{default:t(()=>[d(_,{modelValue:u(l).returnType,"onUpdate:modelValue":a[5]||(a[5]=e=>u(l).returnType=e),class:"w-1/1",placeholder:"\u8BF7\u9009\u62E9\u56DE\u6B3E\u65B9\u5F0F"},{default:t(()=>[(i(!0),V(w,null,y(u(K)(u(W).CRM_RECEIVABLE_RETURN_TYPE),e=>(i(),m(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(o,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u91D1\u989D",prop:"price"},{default:t(()=>[d(L,{modelValue:u(l).price,"onUpdate:modelValue":a[6]||(a[6]=e=>u(l).price=e),min:.01,precision:2,class:"!w-100%","controls-position":"right",placeholder:"\u8BF7\u8F93\u5165\u56DE\u6B3E\u91D1\u989D"},null,8,["modelValue"])]),_:1})]),_:1}),d(o,{span:12},{default:t(()=>[d(n,{label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime"},{default:t(()=>[d(M,{modelValue:u(l).returnTime,"onUpdate:modelValue":a[7]||(a[7]=e=>u(l).returnTime=e),placeholder:"\u9009\u62E9\u56DE\u6B3E\u65E5\u671F",type:"date","value-format":"x",class:"!w-100%"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),d(I,null,{default:t(()=>[d(o,{span:24},{default:t(()=>[d(n,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[d(s,{modelValue:u(l).remark,"onUpdate:modelValue":a[8]||(a[8]=e=>u(l).remark=e),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[Q,u(v)]])]),_:1},8,["modelValue","title"])}}});export{ye as _};
