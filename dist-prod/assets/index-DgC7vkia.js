import{d as ne,r as n,n as pe,o as f,q as g,w as t,g as m,f as a,u as e,t as T,D as de,a3 as k,x as W,k as Z,y as R,c as H,a2 as $,z as ue,am as ce,an as fe,ao as ve,al as ye,E as xe,i as _e,ap as be,l as ge,m as Te,M as ke,_ as Ie}from"./index-DPENBzsb.js";import{_ as he}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{E as we}from"./el-avatar-BjIHlmF4.js";import{_ as Ce}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{f as Ne}from"./formatTime-C7TQtsxQ.js";import{B as V,a as M}from"./constants-C8tGWvl2.js";import{b as Ee}from"./formCreate-BQ5MeUYD.js";import{g as Pe,a as Ue}from"./index-DetSWMsK.js";import{g as Oe}from"./index-Co9HWb9O.js";import Re from"./ProcessInstanceBpmnViewer-DhragUyT.js";import{_ as Ve}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-7iwin6s7.js";import{_ as Me}from"./ProcessInstanceTaskList.vue_vue_type_script_setup_true_lang-UsVVgl5v.js";import Se from"./ProcessInstanceOperationButton-lo55ilu3.js";import{_ as Be}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-DqnNG6nc.js";import{F as S}from"./consts-Dqfik1EE.js";import{T as N}from"./index-D2cLVQ1T.js";import"./color-DXkOL5Tu.js";import"./bpmn-embedded-BBruoZr8.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./XTextButton-CaCskr4h.js";import"./XButton-lfojvuGT.js";import"./utils-CjFsbWby.js";import"./index-BCN8BzfC.js";import"./index-BOzeB1Pk.js";import"./el-tree-select-DxCa0FGQ.js";import"./tree-Cts6wVCK.js";import"./index-tb7T-AVj.js";import"./index-BUzABQZW.js";import"./index-Btz8nVwe.js";import"./index-BAEJzc7Z.js";import"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import"./index-C2tU_CDa.js";import"./index-O66V04DS.js";import"./el-drawer-DSddsvoD.js";import"./index-IbQXwv2T.js";import"./simple-process-designer-RJplQ98g.js";import"./el-space-B67e9bQY.js";import"./download-oWiM5xVU.js";import"./el-image-DqGFoayu.js";import"./SignDialog.vue_vue_type_script_setup_true_lang-C2loz8wX.js";import"./index-NekN2je6.js";import"./el-timeline-item-DOhCPhED.js";const De={class:"processInstance-wrap-main"},Ae=["src"],je={class:"text-#878c93 h-15px"},Fe={class:"flex items-center gap-5 mb-10px h-40px"},Le={class:"text-26px font-bold mb-5px"},ze={class:"flex items-center gap-5 mb-10px text-13px h-35px"},Je={class:"bg-gray-100 h-35px rounded-3xl flex items-center p-8px gap-2 dark:color-gray-600"},Ke={class:"text-#878c93"},Xe={class:"form-scroll-area"},Ye={class:"form-box flex flex-col mb-30px flex-1"},qe={key:1},Ge={class:"form-scroll-area"},Qe={class:"form-scroll-area"},We={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},Ze=Ie(ne({name:"BpmProcessInstanceDetail",__name:"index",props:{id:{},taskId:{},activityId:{}},setup(ee){const I=ee,B=ue(),v=n(!1),o=n({}),i=n({}),h=n({}),D=n(),ae={[N.RUNNING]:"/assets/running-Cm4KjmYZ.svg",[N.APPROVE]:"/assets/approve-BQD8ihNj.svg",[N.REJECT]:"/assets/reject-C_en7x-2.svg",[N.CANCEL]:"/assets/cancel-Cn_ivYkt.svg"},p=n(),d=n({rule:[],option:{},value:{}}),E=[],A=()=>{se(),oe()},j=n(null),se=async()=>{var r,s;v.value=!0;try{const y={processInstanceId:I.id,activityId:I.activityId,taskId:I.taskId},l=await Pe(y);if(!l)return void B.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(!l.processDefinition||!l.processInstance)return void B.error("\u67E5\u8BE2\u4E0D\u5230\u6D41\u7A0B\u4FE1\u606F\uFF01");if(o.value=l.processInstance,i.value=l.processDefinition,i.value.formType===V.NORMAL){const u=l.formFieldsPermission;E.splice(0),((r=d.value.rule)==null?void 0:r.length)>0?d.value.value=o.value.formVariables:Ee(d,i.value.formConf,i.value.formFields,o.value.formVariables),ce().then(()=>{var w,x,C;(w=p.value)==null||w.btn.show(!1),(x=p.value)==null||x.resetBtn.show(!1),(C=p.value)==null||C.disabled(!0),u&&Object.keys(l.formFieldsPermission).forEach(_=>{le(_,u[_])})})}else j.value=fe(l.processDefinition.formCustomViewPath);F.value=l.activityNodes,(s=D.value)==null||s.loadTodoTask(l.todoTask)}finally{v.value=!1}},oe=async()=>{var s;M.BPMN===((s=i.value)==null?void 0:s.modelType)&&(h.value={bpmnXml:""});const r=await Ue(I.id);r&&(h.value=r)},F=n([]),le=(r,s)=>{var y,l,u;s===S.READ&&((y=p.value)==null||y.disabled(!0,r)),s===S.WRITE&&((l=p.value)==null||l.disabled(!1,r),E.push(r)),s===S.NONE&&((u=p.value)==null||u.hidden(!0,r))},re=()=>{A()},P=n("form"),L=n([]);return pe(async()=>{A(),L.value=await Oe()}),(r,s)=>{const y=ve,l=Ce,u=we,w=ye("form-create"),x=xe,C=_e,_=be,U=ge,te=Te,ie=he,me=ke;return f(),g(ie,{bodyStyle:{padding:"10px 20px 0"},class:"position-relative"},{default:t(()=>[m("div",De,[a(_,null,{default:t(()=>{var z,J,K,X,Y,q,G,Q;return[m("img",{class:"position-absolute right-20px",width:"150",src:ae[e(o).status],alt:""},null,8,Ae),m("div",je,"\u7F16\u53F7\uFF1A"+T(r.id),1),a(y,{class:"!my-8px"}),m("div",Fe,[m("div",Le,T(e(o).name),1),e(o).status?(f(),g(l,{key:0,type:e(de).BPM_PROCESS_INSTANCE_STATUS,value:e(o).status},null,8,["type","value"])):k("",!0)]),m("div",ze,[m("div",Je,[(J=(z=e(o))==null?void 0:z.startUser)!=null&&J.avatar?(f(),g(u,{key:0,size:28,src:(X=(K=e(o))==null?void 0:K.startUser)==null?void 0:X.avatar},null,8,["src"])):(q=(Y=e(o))==null?void 0:Y.startUser)!=null&&q.nickname?(f(),g(u,{key:1,size:28},{default:t(()=>{var c,b;return[W(T((b=(c=e(o))==null?void 0:c.startUser)==null?void 0:b.nickname.substring(0,1)),1)]}),_:1})):k("",!0),W(" "+T((Q=(G=e(o))==null?void 0:G.startUser)==null?void 0:Q.nickname),1)]),m("div",Ke,T(e(Ne)(e(o).startTime))+" \u63D0\u4EA4 ",1)]),a(te,{modelValue:e(P),"onUpdate:modelValue":s[2]||(s[2]=c=>Z(P)?P.value=c:null)},{default:t(()=>[a(U,{label:"\u5BA1\u6279\u8BE6\u60C5",name:"form"},{default:t(()=>[m("div",Xe,[a(_,null,{default:t(()=>[a(C,null,{default:t(()=>[a(x,{span:17,class:"!flex !flex-col formCol"},{default:t(()=>{var c,b;return[R((f(),H("div",Ye,[((c=e(i))==null?void 0:c.formType)===e(V).NORMAL?(f(),g(x,{key:0},{default:t(()=>[a(w,{modelValue:e(d).value,"onUpdate:modelValue":s[0]||(s[0]=O=>e(d).value=O),api:e(p),"onUpdate:api":s[1]||(s[1]=O=>Z(p)?p.value=O:null),option:e(d).option,rule:e(d).rule},null,8,["modelValue","api","option","rule"])]),_:1})):k("",!0),((b=e(i))==null?void 0:b.formType)===e(V).CUSTOM?(f(),H("div",qe,[a(e(j),{id:e(o).businessKey},null,8,["id"])])):k("",!0)])),[[me,e(v)]])]}),_:1}),a(x,{span:7},{default:t(()=>[a(Be,{"activity-nodes":e(F)},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])]),_:1}),a(U,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:t(()=>[m("div",Ge,[R(a(Ve,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[$,e(i).modelType&&e(i).modelType===e(M).SIMPLE]]),R(a(Re,{loading:e(v),"model-view":e(h)},null,8,["loading","model-view"]),[[$,e(i).modelType&&e(i).modelType===e(M).BPMN]])])]),_:1}),a(U,{label:"\u6D41\u8F6C\u8BB0\u5F55",name:"record"},{default:t(()=>[m("div",Qe,[a(_,null,{default:t(()=>[a(Me,{loading:e(v),id:r.id},null,8,["loading","id"])]),_:1})])]),_:1}),k("",!0)]),_:1},8,["modelValue"]),m("div",We,[a(Se,{ref_key:"operationButtonRef",ref:D,"process-instance":e(o),"process-definition":e(i),userOptions:e(L),"normal-form":e(d),"normal-form-api":e(p),"writable-fields":E,onSuccess:re},null,8,["process-instance","process-definition","userOptions","normal-form","normal-form-api"])])]}),_:1})])]),_:1})}}}),[["__scopeId","data-v-ef141a7f"]]);export{Ze as default};
