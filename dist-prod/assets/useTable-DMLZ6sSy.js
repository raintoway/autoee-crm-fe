import{d as ae,ag as p,r as v,n as re,u as t,a1 as j,aw as I,y as ce,M as de,f as h,L as pe,aJ as J,s as ue,K as W,_ as me,am as te,h as ne,cT as ge,c3 as he,o as k,c as X,bI as fe,p as we,w as O,aI as Y,q as M,x as q,t as B,a3 as T,aR as ye,F as xe,H as be,I as ve,e as Se,c_ as oe,aq as se}from"./index-DPENBzsb.js";import{g as D,_ as Pe}from"./Form-p7PKuXSG.js";import{E as Ae}from"./index-C2tU_CDa.js";import{d as ke}from"./download-oWiM5xVU.js";const Le=me(ae({name:"Table",props:{pageSize:p.number.def(10),currentPage:p.number.def(1),selection:p.bool.def(!1),showOverflowTooltip:p.bool.def(!0),columns:{type:Array,default:()=>[]},expand:p.bool.def(!1),pagination:{type:Object,default:()=>{}},reserveSelection:p.bool.def(!1),loading:p.bool.def(!1),reserveIndex:p.bool.def(!1),align:p.string.validate(a=>["left","center","right"].includes(a)).def("center"),headerAlign:p.string.validate(a=>["left","center","right"].includes(a)).def("center"),data:{type:Array,default:()=>[]}},emits:["update:pageSize","update:currentPage","register"],setup(a,{attrs:o,slots:m,emit:f,expose:_}){const g=v();re(()=>{const e=t(g);f("register",e==null?void 0:e.$parent,g)});const P=v(a.pageSize),w=v(a.currentPage),n=v({}),i=v({}),r=j(()=>{const e={...a};return Object.assign(e,t(i)),e}),A=(e,s)=>{var L;const{columns:b}=t(r);for(const F of s||b)for(const R of e)F.field===R.field?ue(F,R.path,R.value):(L=F.children)!=null&&L.length&&A(e,F.children)},V=v([]),U=e=>{V.value=e};_({setProps:(e={})=>{i.value=Object.assign(t(i),e),n.value=e},setColumn:A,selections:V});const l=j(()=>Object.assign({small:!1,background:!0,pagerCount:document.body.clientWidth<992?5:7,layout:"total, sizes, prev, pager, next, jumper",pageSizes:[10,20,30,50,100],disabled:!1,hideOnSinglePage:!1,total:10},t(r).pagination));I(()=>t(r).pageSize,e=>{P.value=e}),I(()=>t(r).currentPage,e=>{w.value=e}),I(()=>P.value,e=>{f("update:pageSize",e)}),I(()=>w.value,e=>{f("update:currentPage",e)});const x=j(()=>{const e={...o,...a};return delete e.columns,delete e.data,e}),d=()=>{const{selection:e,reserveSelection:s,align:b,headerAlign:L}=t(r);return e?h(W,{type:"selection",reserveSelection:s,align:b,headerAlign:L,width:"50"},null):void 0},u=()=>{const{align:e,headerAlign:s,expand:b}=t(r);return b?h(W,{type:"expand",align:e,headerAlign:s},{default:L=>D(m,"expand",L)}):void 0},C=e=>{const{columns:s,reserveIndex:b,pageSize:L,currentPage:F,align:R,headerAlign:Z,showOverflowTooltip:ie}=t(r);return[u(),d()].concat((e||s).map(c=>{if(c.type==="index")return h(W,{type:"index",index:c.index?c.index:N=>((z,E,K,G)=>{const H=E+1;return z?K*(G-1)+H:H})(b,N,L,F),align:c.align||R,headerAlign:c.headerAlign||Z,label:c.label,width:"65px"},null);{const N={...c};return N.children&&delete N.children,h(W,J({showOverflowTooltip:ie,align:R,headerAlign:Z},N,{prop:c.field}),{default:z=>{var E;return c.children&&c.children.length?(K=>{const{align:G,headerAlign:H,showOverflowTooltip:le}=t(r);return K.map(y=>{const Q={...y};return Q.children&&delete Q.children,h(W,J({showOverflowTooltip:le,align:G,headerAlign:H},Q,{prop:y.field}),{default:$=>{var ee;return y.children&&y.children.length?C(y.children):D(m,y.field,$)||((ee=y==null?void 0:y.formatter)==null?void 0:ee.call(y,$.row,$.column,$.row[y.field],$.$index))||$.row[y.field]},header:D(m,`${y.field}-header`)})})})(c.children):D(m,c.field,z)||((E=c==null?void 0:c.formatter)==null?void 0:E.call(c,z.row,z.column,z.row[c.field],z.$index))||z.row[c.field]},header:()=>D(m,`${c.field}-header`)||c.label})}}))};return()=>ce(h("div",null,[h(pe,J({ref:g,data:t(r).data,"onSelection-change":U},t(x)),{default:()=>C(),append:()=>D(m,"append")}),t(r).pagination?h(Ae,J({pageSize:P.value,"onUpdate:pageSize":e=>P.value=e,currentPage:w.value,"onUpdate:currentPage":e=>w.value=e,class:"float-right mb-15px mt-15px"},t(l)),null):void 0]),[[de,t(r).loading]])}}),[["__scopeId","data-v-c6b7a424"]]),ze={key:0},Oe=ae({name:"Search",__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:p.bool.def(!1),labelWidth:p.oneOfType([String,Number]).def("auto"),layout:p.string.validate(a=>["inline","bottom"].includes(a)).def("inline"),buttomPosition:p.string.validate(a=>["left","center","right"].includes(a)).def("center"),showSearch:p.bool.def(!0),showReset:p.bool.def(!0),expand:p.bool.def(!1),expandField:p.string.def(""),inline:p.bool.def(!0),model:{type:Object,default:()=>({})}},emits:["search","reset"],setup(a,{emit:o}){const{t:m}=ne(),f=a,_=o,g=v(!0),P=j(()=>{let l=ge(f.schema);if(f.expand&&f.expandField&&!t(g)){const x=he(l,d=>d.field===f.expandField);if(x>-1){const d=l.length;l.splice(x+1,d)}}return f.layout==="inline"&&(l=l.concat([{field:"action",formItemProps:{labelWidth:"0px"}}])),l}),{register:w,elFormRef:n,methods:i}=(l=>{const x=v(),d=v(),u=async()=>(await te(),t(x)),C={setProps:async(e={})=>{const s=await u();s==null||s.setProps(e),e.model&&(s==null||s.setValues(e.model))},setValues:async e=>{const s=await u();s==null||s.setValues(e)},setSchema:async e=>{const s=await u();s==null||s.setSchema(e)},addSchema:async(e,s)=>{const b=await u();b==null||b.addSchema(e,s)},delSchema:async e=>{const s=await u();s==null||s.delSchema(e)},getFormData:async()=>{const e=await u();return e==null?void 0:e.formModel}};return l&&C.setProps(l),{register:(e,s)=>{x.value=e,d.value=s},elFormRef:d,methods:C}})({model:f.model||{}}),r=async()=>{var l;await((l=t(n))==null?void 0:l.validate(async x=>{if(x){const{getFormData:d}=i,u=await d();_("search",u)}}))},A=async()=>{var d;(d=t(n))==null||d.resetFields();const{getFormData:l}=i,x=await l();_("reset",x)},V=j(()=>({textAlign:f.buttomPosition})),U=()=>{var l;(l=t(n))==null||l.resetFields(),g.value=!t(g)};return(l,x)=>{const d=be,u=ve,C=Pe;return k(),X(xe,null,[h(C,{inline:a.inline,"is-col":a.isCol,"is-custom":!1,"label-width":a.labelWidth,schema:t(P),class:"-mb-15px","hide-required-asterisk":"",onRegister:t(w)},fe({action:O(()=>[a.layout==="inline"?(k(),X("div",ze,[a.showSearch?(k(),M(u,{key:0,onClick:r},{default:O(()=>[h(d,{class:"mr-5px",icon:"ep:search"}),q(" "+B(t(m)("common.query")),1)]),_:1})):T("",!0),a.showReset?(k(),M(u,{key:1,onClick:A},{default:O(()=>[h(d,{class:"mr-5px",icon:"ep:refresh"}),q(" "+B(t(m)("common.reset")),1)]),_:1})):T("",!0),a.expand?(k(),M(u,{key:2,text:"",onClick:U},{default:O(()=>[q(B(t(m)(t(g)?"common.shrink":"common.expand"))+" ",1),h(d,{icon:t(g)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):T("",!0),Y(l.$slots,"actionMore")])):T("",!0)]),_:2},[we(Object.keys(l.$slots),e=>({name:e,fn:O(()=>[Y(l.$slots,e)])}))]),1032,["inline","is-col","label-width","schema","onRegister"]),a.layout==="bottom"?(k(),X("div",{key:0,style:ye(t(V))},[a.showSearch?(k(),M(u,{key:0,type:"primary",onClick:r},{default:O(()=>[h(d,{class:"mr-5px",icon:"ep:search"}),q(" "+B(t(m)("common.query")),1)]),_:1})):T("",!0),a.showReset?(k(),M(u,{key:1,onClick:A},{default:O(()=>[h(d,{class:"mr-5px",icon:"ep:refresh-right"}),q(" "+B(t(m)("common.reset")),1)]),_:1})):T("",!0),a.expand?(k(),M(u,{key:2,text:"",onClick:U},{default:O(()=>[q(B(t(m)(t(g)?"common.shrink":"common.expand"))+" ",1),h(d,{icon:t(g)?"ep:arrow-up":"ep:arrow-down"},null,8,["icon"])]),_:1})):T("",!0),Y(l.$slots,"actionMore")],4)):T("",!0)],64)}}}),{t:S}=ne(),Te=a=>{const o=Se({pageSize:10,currentPage:1,total:10,tableList:[],params:{...(a==null?void 0:a.defaultParams)||{}},loading:!0,exportLoading:!1,currentRow:null}),m=j(()=>({...o.params,pageSize:o.pageSize,pageNo:o.currentPage}));I(()=>o.currentPage,()=>{w.getList()}),I(()=>o.pageSize,()=>{o.currentPage===1||(o.currentPage=1),w.getList()});const f=v(),_=v(),g=async()=>(await te(),t(f)),P=async n=>{let i=1;n instanceof Array?(i=n.length,await Promise.all(n.map(async r=>{await((a==null?void 0:a.delListApi)&&(a==null?void 0:a.delListApi(r)))}))):await((a==null?void 0:a.delListApi)&&(a==null?void 0:a.delListApi(n))),oe.success(S("common.delSuccess")),o.currentPage=(o.total%o.pageSize===i||o.pageSize===1)&&o.currentPage>1?o.currentPage-1:o.currentPage,await w.getList()},w={getList:async()=>{o.loading=!0;const n=await(a==null?void 0:a.getListApi(t(m)).finally(()=>{o.loading=!1}));n&&(o.tableList=n.list,o.total=n.total??0)},setProps:async(n={})=>{const i=await g();i==null||i.setProps(n)},setColumn:async n=>{const i=await g();i==null||i.setColumn(n)},getSelections:async()=>{const n=await g();return(n==null?void 0:n.selections)||[]},setSearchParams:n=>{o.params=Object.assign(o.params,{pageSize:o.pageSize,pageNo:1,...n}),o.currentPage!==1?o.currentPage=1:w.getList()},delList:async(n,i,r=!0)=>{const A=await g();!i||A!=null&&A.selections.length?r?se.confirm(S("common.delMessage"),S("common.confirmTitle"),{confirmButtonText:S("common.ok"),cancelButtonText:S("common.cancel"),type:"warning"}).then(async()=>{await P(n)}):await P(n):oe.warning(S("common.delNoData"))},exportList:async n=>{o.exportLoading=!0,se.confirm(S("common.exportMessage"),S("common.confirmTitle"),{confirmButtonText:S("common.ok"),cancelButtonText:S("common.cancel"),type:"warning"}).then(async()=>{var r;const i=await((r=a==null?void 0:a.exportListApi)==null?void 0:r.call(a,t(m)));i&&ke.excel(i,n)}).finally(()=>{o.exportLoading=!1})}};return a!=null&&a.props&&w.setProps(a.props),{register:(n,i)=>{f.value=n,_.value=i},elTableRef:_,tableObject:o,methods:w,tableMethods:w}};export{Oe as _,Le as a,Te as u};
