import{_ as da}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{d as ne,r as G,o as l,c as r,g as t,u as e,q as f,w as o,f as a,k as ae,a3 as E,z as gl,ba as re,cW as ue,H as ie,dc as ia,y as ce,bH as pe,x as F,t as P,p as B,F as A,d1 as hl,aY as sa,l as Vl,ai as bl,aj as ll,m as Ul,ao as xe,I as Ee,U as me,W as be,D as Sl,K as Rl,L as Cl,i as al,cg as Dl,T as We,C as He,A as qe,B as Me,a1 as ye,bS as xl,co as Bl,J as Be,e as tl,cT as ra,E as ua,bQ as zl,c1 as Gl,_ as Ol,j as $l,aw as _l,bk as Il,G as ca,dd as pa,al as ma,ay as va,d4 as fa,d2 as ya,d3 as ga,aR as ha,cl as ba,c$ as _a}from"./index-DPENBzsb.js";import{_ as Al}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{N as w,l as ol,i as ze,b as Ll,d as Fl,k as Na,o as ve,p as nl,F as de,S as ka,m as Se,B as jl,q as dl,A as il,T as we,a as Ea,h as Yl,C as J,M as Kl,j as Ta,R as wa,f as Va,g as Pl,c as Ua,e as Sa,O as Xl,P as Ra,D as Ca,r as Wl,s as Ql,t as Da,u as De,v as xa,w as Ge,x as Oa}from"./consts-Dqfik1EE.js";import{a as Qe,b as fe,d as Je,u as Hl,e as Ze,f as _e,g as ql,h as Jl,i as Ia,c as Zl,j as ea,k as Aa,l as La}from"./utils-CjFsbWby.js";import{E as $e}from"./el-drawer-DSddsvoD.js";import{d as el,a as Ml}from"./formatTime-C7TQtsxQ.js";import{E as la}from"./el-tree-select-DxCa0FGQ.js";import{d as aa}from"./tree-Cts6wVCK.js";import{E as Fa}from"./el-space-B67e9bQY.js";import{B as Pa}from"./constants-C8tGWvl2.js";import{d as Ha}from"./download-oWiM5xVU.js";const qa={class:"node-handler-wrapper"},Ma={class:"node-handler"},Ba={class:"handler-item-wrapper"},za={class:"add-icon"},Te=ne({name:"NodeHandler",__name:"NodeHandler",props:{childNode:{type:Object,default:null},currentNode:{type:Object,required:!0}},emits:["update:childNode"],setup(M,{emit:K}){const j=gl(),R=G(!1),v=M,n=K,u=re("readonly"),S=T=>{var y;if(T===w.PARALLEL_BRANCH_NODE&&[w.CONDITION_BRANCH_NODE,w.INCLUSIVE_BRANCH_NODE].includes((y=v.currentNode)==null?void 0:y.type))j.error("\u6761\u4EF6\u5206\u652F\u3001\u5305\u5BB9\u5206\u652F\u540E\u9762\uFF0C\u4E0D\u5141\u8BB8\u76F4\u63A5\u6DFB\u52A0\u5E76\u884C\u5206\u652F");else{if(R.value=!1,T===w.USER_TASK_NODE){const U={id:"Activity_"+ue(),name:ol.get(w.USER_TASK_NODE),showText:"",type:w.USER_TASK_NODE,approveMethod:ze.SEQUENTIAL_APPROVE,rejectHandler:{type:Ll.FINISH_PROCESS},timeoutHandler:{enable:!1},assignEmptyHandler:{type:Fl.APPROVE},assignStartUserHandlerType:Na.START_USER_AUDIT,childNode:v.childNode,taskCreateListener:{enable:!1},taskAssignListener:{enable:!1},taskCompleteListener:{enable:!1}};n("update:childNode",U)}if(T===w.COPY_TASK_NODE){const U={id:"Activity_"+ue(),name:ol.get(w.COPY_TASK_NODE),showText:"",type:w.COPY_TASK_NODE,childNode:v.childNode};n("update:childNode",U)}if(T===w.CONDITION_BRANCH_NODE){const U={name:"\u6761\u4EF6\u5206\u652F",type:w.CONDITION_BRANCH_NODE,id:"GateWay_"+ue(),childNode:v.childNode,conditionNodes:[{id:"Flow_"+ue(),name:"\u6761\u4EF61",showText:"",type:w.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!1,conditionType:ve.RULE,conditionGroups:nl}},{id:"Flow_"+ue(),name:"\u5176\u5B83\u60C5\u51B5",showText:"\u672A\u6EE1\u8DB3\u5176\u5B83\u6761\u4EF6\u65F6\uFF0C\u5C06\u8FDB\u5165\u6B64\u5206\u652F",type:w.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!0}}]};n("update:childNode",U)}if(T===w.PARALLEL_BRANCH_NODE){const U={name:"\u5E76\u884C\u5206\u652F",type:w.PARALLEL_BRANCH_NODE,id:"GateWay_"+ue(),childNode:v.childNode,conditionNodes:[{id:"Flow_"+ue(),name:"\u5E76\u884C1",showText:"\u65E0\u9700\u914D\u7F6E\u6761\u4EF6\u540C\u65F6\u6267\u884C",type:w.CONDITION_NODE,childNode:void 0},{id:"Flow_"+ue(),name:"\u5E76\u884C2",showText:"\u65E0\u9700\u914D\u7F6E\u6761\u4EF6\u540C\u65F6\u6267\u884C",type:w.CONDITION_NODE,childNode:void 0}]};n("update:childNode",U)}if(T===w.INCLUSIVE_BRANCH_NODE){const U={name:"\u5305\u5BB9\u5206\u652F",type:w.INCLUSIVE_BRANCH_NODE,id:"GateWay_"+ue(),childNode:v.childNode,conditionNodes:[{id:"Flow_"+ue(),name:"\u5305\u5BB9\u6761\u4EF61",showText:"",type:w.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!1,conditionType:ve.RULE,conditionGroups:nl}},{id:"Flow_"+ue(),name:"\u5176\u5B83\u60C5\u51B5",showText:"\u672A\u6EE1\u8DB3\u5176\u5B83\u6761\u4EF6\u65F6\uFF0C\u5C06\u8FDB\u5165\u6B64\u5206\u652F",type:w.CONDITION_NODE,childNode:void 0,conditionSetting:{defaultFlow:!0}}]};n("update:childNode",U)}if(T===w.DELAY_TIMER_NODE){const U={id:"Activity_"+ue(),name:ol.get(w.DELAY_TIMER_NODE),showText:"",type:w.DELAY_TIMER_NODE,childNode:v.childNode};n("update:childNode",U)}if(T===w.ROUTER_BRANCH_NODE){const U={id:"GateWay_"+ue(),name:ol.get(w.ROUTER_BRANCH_NODE),showText:"",type:w.ROUTER_BRANCH_NODE,childNode:v.childNode};n("update:childNode",U)}if(T===w.TRIGGER_NODE){const U={id:"Activity_"+ue(),name:ol.get(w.TRIGGER_NODE),showText:"",type:w.TRIGGER_NODE,childNode:v.childNode};n("update:childNode",U)}}};return(T,y)=>{const U=ie,N=ia;return l(),r("div",qa,[t("div",Ma,[e(u)?E("",!0):(l(),f(N,{key:0,trigger:"hover",visible:e(R),"onUpdate:visible":y[8]||(y[8]=_=>ae(R)?R.value=_:null),placement:"right-start",width:"auto"},{reference:o(()=>[t("div",za,[a(U,{icon:"ep:plus"})])]),default:o(()=>[t("div",Ba,[t("div",{class:"handler-item",onClick:y[0]||(y[0]=_=>S(e(w).USER_TASK_NODE))},y[9]||(y[9]=[t("div",{class:"approve handler-item-icon"},[t("span",{class:"iconfont icon-approve icon-size"})],-1),t("div",{class:"handler-item-text"},"\u5BA1\u6279\u4EBA",-1)])),t("div",{class:"handler-item",onClick:y[1]||(y[1]=_=>S(e(w).COPY_TASK_NODE))},y[10]||(y[10]=[t("div",{class:"handler-item-icon copy"},[t("span",{class:"iconfont icon-size icon-copy"})],-1),t("div",{class:"handler-item-text"},"\u6284\u9001",-1)])),t("div",{class:"handler-item",onClick:y[2]||(y[2]=_=>S(e(w).CONDITION_BRANCH_NODE))},y[11]||(y[11]=[t("div",{class:"handler-item-icon condition"},[t("span",{class:"iconfont icon-size icon-exclusive"})],-1),t("div",{class:"handler-item-text"},"\u6761\u4EF6\u5206\u652F",-1)])),t("div",{class:"handler-item",onClick:y[3]||(y[3]=_=>S(e(w).PARALLEL_BRANCH_NODE))},y[12]||(y[12]=[t("div",{class:"handler-item-icon parallel"},[t("span",{class:"iconfont icon-size icon-parallel"})],-1),t("div",{class:"handler-item-text"},"\u5E76\u884C\u5206\u652F",-1)])),t("div",{class:"handler-item",onClick:y[4]||(y[4]=_=>S(e(w).INCLUSIVE_BRANCH_NODE))},y[13]||(y[13]=[t("div",{class:"handler-item-icon inclusive"},[t("span",{class:"iconfont icon-size icon-inclusive"})],-1),t("div",{class:"handler-item-text"},"\u5305\u5BB9\u5206\u652F",-1)])),t("div",{class:"handler-item",onClick:y[5]||(y[5]=_=>S(e(w).DELAY_TIMER_NODE))},y[14]||(y[14]=[t("div",{class:"handler-item-icon delay"},[t("span",{class:"iconfont icon-size icon-delay"})],-1),t("div",{class:"handler-item-text"},"\u5EF6\u8FDF\u5668",-1)])),t("div",{class:"handler-item",onClick:y[6]||(y[6]=_=>S(e(w).ROUTER_BRANCH_NODE))},y[15]||(y[15]=[t("div",{class:"handler-item-icon router"},[t("span",{class:"iconfont icon-size icon-router"})],-1),t("div",{class:"handler-item-text"},"\u8DEF\u7531\u5206\u652F",-1)])),t("div",{class:"handler-item",onClick:y[7]||(y[7]=_=>S(e(w).TRIGGER_NODE))},y[16]||(y[16]=[t("div",{class:"handler-item-icon trigger"},[t("span",{class:"iconfont icon-size icon-trigger"})],-1),t("div",{class:"handler-item-text"},"\u89E6\u53D1\u5668",-1)]))])]),_:1},8,["visible"]))])])}}}),Ga={class:"config-header"},$a=["placeholder"],ja={key:1,class:"node-name"},Ya={class:"field-setting-pane"},Ka={class:"field-setting-item-label"},Xa={class:"item-radio-wrap"},Wa={class:"item-radio-wrap"},Qa={class:"item-radio-wrap"},Ja=ne({name:"StartUserNodeConfig",__name:"StartUserNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(M,{expose:K}){const j=M,R=re("startUserIds"),v=re("userList"),{settingVisible:n,closeDrawer:u,openDrawer:S}=Qe(),T=fe(j),{nodeName:y,showInput:U,clickIcon:N,blurEvent:_}=Je(w.COPY_TASK_NODE),s=G("user"),{formType:h,fieldsPermissionConfig:g,getNodeConfigFormFields:k}=Hl(de.WRITE),d=C=>{if(!C||C.length===0)return"";const p=[];return C.forEach(V=>{const D=v==null?void 0:v.value.find(z=>z.id===V);D&&D.nickname&&p.push(D.nickname)}),p.join(",")},b=async()=>(s.value="user",T.value.name=y.value,T.value.showText="\u5DF2\u8BBE\u7F6E",T.value.fieldsPermission=g.value,T.value.buttonsSetting=ka,n.value=!1,!0);return K({openDrawer:S,showStartUserNodeConfig:C=>{y.value=C.name,k(C.fieldsPermission)}}),(C,p)=>{const V=ie,D=hl,z=sa,x=Vl,I=bl,W=ll,X=Ul,Z=xe,Q=Ee,L=$e,Ne=me("mountedFocus");return l(),f(L,{"append-to-body":!0,modelValue:e(n),"onUpdate:modelValue":p[4]||(p[4]=q=>ae(n)?n.value=q:null),"show-close":!1,size:550,"before-close":b},{header:o(()=>[t("div",Ga,[e(U)?ce((l(),r("input",{key:0,type:"text",class:"config-editable-input",onBlur:p[0]||(p[0]=q=>e(_)()),"onUpdate:modelValue":p[1]||(p[1]=q=>ae(y)?y.value=q:null),placeholder:e(y)},null,40,$a)),[[Ne],[pe,e(y)]]):(l(),r("div",ja,[F(P(e(y))+" ",1),a(V,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:p[2]||(p[2]=q=>e(N)())})])),p[5]||(p[5]=t("div",{class:"divide-line"},null,-1))])]),footer:o(()=>[a(Z),t("div",null,[a(Q,{type:"primary",onClick:b},{default:o(()=>p[12]||(p[12]=[F("\u786E \u5B9A")])),_:1}),a(Q,{onClick:e(u)},{default:o(()=>p[13]||(p[13]=[F("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:o(()=>[a(X,{type:"border-card",modelValue:e(s),"onUpdate:modelValue":p[3]||(p[3]=q=>ae(s)?s.value=q:null)},{default:o(()=>[a(x,{label:"\u6743\u9650",name:"user"},{default:o(()=>[e(R)&&e(R).length!==0?e(R).length==1?(l(),f(D,{key:1},{default:o(()=>[F(P(d(e(R)))+" \u53EF\u53D1\u8D77\u6D41\u7A0B ",1)]),_:1})):(l(),f(D,{key:2},{default:o(()=>[a(z,{class:"box-item",effect:"dark",placement:"top",content:d(e(R))},{default:o(()=>[F(P(d(e(R).slice(0,2)))+" \u7B49 "+P(e(R).length)+" \u4EBA\u53EF\u53D1\u8D77\u6D41\u7A0B ",1)]),_:1},8,["content"])]),_:1})):(l(),f(D,{key:0},{default:o(()=>p[6]||(p[6]=[F(" \u5168\u90E8\u6210\u5458\u53EF\u4EE5\u53D1\u8D77\u6D41\u7A0B ")])),_:1}))]),_:1}),e(h)===10?(l(),f(x,{key:0,label:"\u8868\u5355\u5B57\u6BB5\u6743\u9650",name:"fields"},{default:o(()=>[t("div",Ya,[p[10]||(p[10]=t("div",{class:"field-setting-desc"},"\u5B57\u6BB5\u6743\u9650",-1)),p[11]||(p[11]=t("div",{class:"field-permit-title"},[t("div",{class:"setting-title-label first-title"}," \u5B57\u6BB5\u540D\u79F0 "),t("div",{class:"other-titles"},[t("span",{class:"setting-title-label"},"\u53EA\u8BFB"),t("span",{class:"setting-title-label"},"\u53EF\u7F16\u8F91"),t("span",{class:"setting-title-label"},"\u9690\u85CF")])],-1)),(l(!0),r(A,null,B(e(g),(q,Y)=>(l(),r("div",{class:"field-setting-item",key:Y},[t("div",Ka,P(q.title),1),a(W,{class:"field-setting-item-group",modelValue:q.permission,"onUpdate:modelValue":$=>q.permission=$},{default:o(()=>[t("div",Xa,[a(I,{value:e(de).READ,size:"large",label:e(de).READ},{default:o(()=>p[7]||(p[7]=[t("span",null,null,-1)])),_:1},8,["value","label"])]),t("div",Wa,[a(I,{value:e(de).WRITE,size:"large",label:e(de).WRITE},{default:o(()=>p[8]||(p[8]=[t("span",null,null,-1)])),_:1},8,["value","label"])]),t("div",Qa,[a(I,{value:e(de).NONE,size:"large",label:e(de).NONE},{default:o(()=>p[9]||(p[9]=[t("span",null,null,-1)])),_:1},8,["value","label"])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})):E("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Za={class:"node-wrapper"},et={class:"node-container"},lt={class:"node-title-container"},at=["placeholder"],tt=["title"],ot={key:1,class:"node-text"},nt=ne({name:"StartEventNode",__name:"StartUserNode",props:{flowNode:{type:Object,default:()=>null}},emits:["update:modelValue"],setup(M,{emit:K}){const j=M,R=re("readonly"),v=re("tasks",G([])),n=fe(j),{showInput:u,blurEvent:S,clickTitle:T}=Ze(n,w.START_USER_NODE),y=G(),U=()=>{R?v&&v.value&&(_.value=n.value.name,s.value=v.value.filter(h=>(h==null?void 0:h.taskDefinitionKey)===n.value.id),N.value=!0):(y.value.showStartUserNodeConfig(n.value),y.value.openDrawer())},N=G(!1),_=G(void 0),s=G([]);return(h,g)=>{var z;const k=ie,d=Rl,b=Al,C=Cl,p=al,V=Dl,D=me("mountedFocus");return l(),r(A,null,[t("div",Za,[t("div",et,[t("div",{class:be(["node-box",[{"node-config-error":!e(n).showText},`${e(_e)((z=e(n))==null?void 0:z.activityStatus)}`]])},[t("div",lt,[g[5]||(g[5]=t("div",{class:"node-title-icon start-user"},[t("span",{class:"iconfont icon-start-user"})],-1)),!e(R)&&e(u)?ce((l(),r("input",{key:0,type:"text",class:"editable-title-input",onBlur:g[0]||(g[0]=x=>e(S)()),"onUpdate:modelValue":g[1]||(g[1]=x=>e(n).name=x),placeholder:e(n).name},null,40,at)),[[D],[pe,e(n).name]]):(l(),r("div",{key:1,class:"node-title",onClick:g[2]||(g[2]=(...x)=>e(T)&&e(T)(...x))},P(e(n).name),1))]),t("div",{class:"node-content",onClick:U},[e(n).showText?(l(),r("div",{key:0,class:"node-text",title:e(n).showText},P(e(n).showText),9,tt)):(l(),r("div",ot,P(e(Se).get(e(w).START_USER_NODE)),1)),e(R)?E("",!0):(l(),f(k,{key:2,icon:"ep:arrow-right-bold"}))])],2),e(n)?(l(),f(Te,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":g[3]||(g[3]=x=>e(n).childNode=x),"current-node":e(n)},null,8,["child-node","current-node"])):E("",!0)])]),!e(R)&&e(n)?(l(),f(Ja,{key:0,ref_key:"nodeSetting",ref:y,"flow-node":e(n)},null,8,["flow-node"])):E("",!0),a(V,{title:e(_)||"\u5BA1\u6279\u8BB0\u5F55",modelValue:e(N),"onUpdate:modelValue":g[4]||(g[4]=x=>ae(N)?N.value=x:null),width:"1000px","append-to-body":""},{default:o(()=>[a(p,null,{default:o(()=>[a(C,{data:e(s),size:"small",border:"","header-cell-class-name":"table-header-gray"},{default:o(()=>[a(d,{label:"\u5E8F\u53F7","header-align":"center",align:"center",type:"index",width:"50"}),a(d,{label:"\u5BA1\u6279\u4EBA","min-width":"100",align:"center"},{default:o(x=>{var I,W;return[F(P(((I=x.row.assigneeUser)==null?void 0:I.nickname)||((W=x.row.ownerUser)==null?void 0:W.nickname)),1)]}),_:1}),a(d,{label:"\u90E8\u95E8","min-width":"100",align:"center"},{default:o(x=>{var I,W;return[F(P(((I=x.row.assigneeUser)==null?void 0:I.deptName)||((W=x.row.ownerUser)==null?void 0:W.deptName)),1)]}),_:1}),a(d,{formatter:e(el),align:"center",label:"\u5F00\u59CB\u65F6\u95F4",prop:"createTime","min-width":"140"},null,8,["formatter"]),a(d,{formatter:e(el),align:"center",label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime","min-width":"140"},null,8,["formatter"]),a(d,{align:"center",label:"\u5BA1\u6279\u72B6\u6001",prop:"status","min-width":"90"},{default:o(x=>[a(b,{type:e(Sl).BPM_TASK_STATUS,value:x.row.status},null,8,["type","value"])]),_:1}),a(d,{align:"center",label:"\u5BA1\u6279\u5EFA\u8BAE",prop:"reason","min-width":"120"}),a(d,{align:"center",label:"\u8017\u65F6",prop:"durationInMillis",width:"100"},{default:o(x=>[F(P(e(Ml)(x.row.durationInMillis)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["title","modelValue"])],64)}}}),dt={class:"end-node-wrapper"},it=ne({name:"EndEventNode",__name:"EndEventNode",props:{flowNode:{type:Object,default:()=>null}},setup(M){const K=fe(M),j=re("readonly"),R=re("processInstance",G({})),v=G(!1),n=G([]),u=()=>{j&&R&&R.value&&(n.value=[{assigneeUser:R.value.startUser,createTime:R.value.startTime,endTime:R.value.endTime,status:R.value.status,durationInMillis:R.value.durationInMillis}],v.value=!0)};return(S,T)=>{var h;const y=Rl,U=Al,N=Cl,_=al,s=Dl;return l(),r(A,null,[t("div",dt,[t("div",{class:be(["end-node-box cursor-pointer",`${e(_e)((h=e(K))==null?void 0:h.activityStatus)}`]),onClick:u},T[1]||(T[1]=[t("span",{class:"node-fixed-name",title:"\u7ED3\u675F"},"\u7ED3\u675F",-1)]),2)]),a(s,{title:"\u5BA1\u6279\u4FE1\u606F",modelValue:e(v),"onUpdate:modelValue":T[0]||(T[0]=g=>ae(v)?v.value=g:null),width:"1000px","append-to-body":""},{default:o(()=>[a(_,null,{default:o(()=>[a(N,{data:e(n),size:"small",border:"","header-cell-class-name":"table-header-gray"},{default:o(()=>[a(y,{label:"\u5E8F\u53F7","header-align":"center",align:"center",type:"index",width:"50"}),a(y,{label:"\u53D1\u8D77\u4EBA",prop:"assigneeUser.nickname","min-width":"100",align:"center"}),a(y,{label:"\u90E8\u95E8","min-width":"100",align:"center"},{default:o(g=>{var k,d;return[F(P(((k=g.row.assigneeUser)==null?void 0:k.deptName)||((d=g.row.ownerUser)==null?void 0:d.deptName)),1)]}),_:1}),a(y,{formatter:e(el),align:"center",label:"\u5F00\u59CB\u65F6\u95F4",prop:"createTime","min-width":"140"},null,8,["formatter"]),a(y,{formatter:e(el),align:"center",label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime","min-width":"140"},null,8,["formatter"]),a(y,{align:"center",label:"\u5BA1\u6279\u72B6\u6001",prop:"status","min-width":"90"},{default:o(g=>[a(U,{type:e(Sl).BPM_PROCESS_INSTANCE_STATUS,value:g.row.status},null,8,["type","value"])]),_:1}),a(y,{align:"center",label:"\u8017\u65F6",prop:"durationInMillis",width:"100"},{default:o(g=>[F(P(e(Ml)(g.row.durationInMillis)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])],64)}}}),st={class:"mr-2"},rt={class:"mr-2"},ut={class:"mr-2"},ct={class:"mr-1 flex items-center"},pt={class:"mr-2"},mt={class:"mr-2"},vt={class:"mr-2"},ft={class:"mr-1 flex items-center"},ta=ne({name:"HttpRequestParamSetting",__name:"HttpRequestParamSetting",props:{header:{type:Array,required:!1,default:()=>[]},body:{type:Array,required:!1,default:()=>[]},bind:{type:String,required:!0}},setup(M){const K=M,j=ql(),R=n=>{n.push({key:"",type:dl.FIXED_VALUE,value:""})},v=(n,u)=>{n.splice(u,1)};return(n,u)=>{const S=We,T=He,y=qe,U=Me,N=ie,_=Ee;return l(),r(A,null,[a(T,{label:"\u8BF7\u6C42\u5934"},{default:o(()=>[(l(!0),r(A,null,B(K.header,(s,h)=>(l(),r("div",{class:"flex pt-2",key:h},[t("div",st,[a(T,{prop:`${M.bind}.header.${h}.key`,rules:{required:!0,message:"\u53C2\u6570\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[a(S,{class:"w-160px",modelValue:s.key,"onUpdate:modelValue":g=>s.key=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),t("div",rt,[a(U,{class:"w-100px!",modelValue:s.type,"onUpdate:modelValue":g=>s.type=g},{default:o(()=>[(l(!0),r(A,null,B(e(jl),g=>(l(),f(y,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),t("div",ut,[a(T,{prop:`${M.bind}.header.${h}.value`,rules:{required:!0,message:"\u53C2\u6570\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[s.type===e(dl).FIXED_VALUE?(l(),f(S,{key:0,class:"w-160px",modelValue:s.value,"onUpdate:modelValue":g=>s.value=g},null,8,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:2},1032,["prop"]),a(T,{prop:`${M.bind}.header.${h}.value`,rules:{required:!0,message:"\u53C2\u6570\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}},{default:o(()=>[s.type===e(dl).FROM_FORM?(l(),f(U,{key:0,class:"w-160px!",modelValue:s.value,"onUpdate:modelValue":g=>s.value=g},{default:o(()=>[(l(!0),r(A,null,B(e(j),(g,k)=>(l(),f(y,{key:k,label:g.title,value:g.field,disabled:!g.required},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:2},1032,["prop"])]),t("div",ct,[a(N,{icon:"ep:delete",size:18,onClick:g=>v(K.header,h)},null,8,["onClick"])])]))),128)),a(_,{type:"primary",text:"",onClick:u[0]||(u[0]=s=>R(K.header))},{default:o(()=>[a(N,{icon:"ep:plus",class:"mr-5px"}),u[2]||(u[2]=F("\u6DFB\u52A0\u4E00\u884C "))]),_:1})]),_:1}),a(T,{label:"\u8BF7\u6C42\u4F53"},{default:o(()=>[(l(!0),r(A,null,B(K.body,(s,h)=>(l(),r("div",{class:"flex pt-2",key:h},[t("div",pt,[a(T,{prop:`${M.bind}.body.${h}.key`,rules:{required:!0,message:"\u53C2\u6570\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[a(S,{class:"w-160px",modelValue:s.key,"onUpdate:modelValue":g=>s.key=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),t("div",mt,[a(U,{class:"w-100px!",modelValue:s.type,"onUpdate:modelValue":g=>s.type=g},{default:o(()=>[(l(!0),r(A,null,B(e(jl),g=>(l(),f(y,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),t("div",vt,[a(T,{prop:`${M.bind}.body.${h}.value`,rules:{required:!0,message:"\u53C2\u6570\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[s.type===e(dl).FIXED_VALUE?(l(),f(S,{key:0,class:"w-160px",modelValue:s.value,"onUpdate:modelValue":g=>s.value=g},null,8,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:2},1032,["prop"]),a(T,{prop:`${M.bind}.body.${h}.value`,rules:{required:!0,message:"\u53C2\u6570\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}},{default:o(()=>[s.type===e(dl).FROM_FORM?(l(),f(U,{key:0,class:"w-160px!",modelValue:s.value,"onUpdate:modelValue":g=>s.value=g},{default:o(()=>[(l(!0),r(A,null,B(e(j),(g,k)=>(l(),f(y,{key:k,label:g.title,value:g.field,disabled:!g.required},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:2},1032,["prop"])]),t("div",ft,[a(N,{icon:"ep:delete",size:18,onClick:g=>v(K.body,h)},null,8,["onClick"])])]))),128)),a(_,{type:"primary",text:"",onClick:u[1]||(u[1]=s=>R(K.body))},{default:o(()=>[a(N,{icon:"ep:plus",class:"mr-5px"}),u[3]||(u[3]=F("\u6DFB\u52A0\u4E00\u884C "))]),_:1})]),_:1})],64)}}}),yt={key:0},gt=ne({__name:"UserTaskListener",props:{modelValue:{type:Object,required:!0},formFieldOptions:{type:Object,required:!0}},emits:["update:modelValue"],setup(M,{expose:K,emit:j}){const R=M,v=j,n=G(),u=ye({get:()=>R.modelValue,set(T){v("update:modelValue",T)}}),S=G([{name:"\u521B\u5EFA\u4EFB\u52A1",type:"Create"},{name:"\u6307\u6D3E\u4EFB\u52A1\u6267\u884C\u4EBA\u5458",type:"Assign"},{name:"\u5B8C\u6210\u4EFB\u52A1",type:"Complete"}]);return K({validate:async()=>!!n&&await n.value.validate()}),(T,y)=>{const U=hl,N=xe,_=xl,s=He,h=Bl,g=We,k=Be;return l(),f(k,{ref_key:"listenerFormRef",ref:n,model:e(u),"label-position":"top"},{default:o(()=>[(l(!0),r(A,null,B(e(S),(d,b)=>(l(),r("div",{key:b},[a(N,{"content-position":"left"},{default:o(()=>[a(U,{tag:"b",size:"large"},{default:o(()=>[F(P(d.name),1)]),_:2},1024)]),_:2},1024),a(s,null,{default:o(()=>[a(_,{modelValue:e(u)[`task${d.type}ListenerEnable`],"onUpdate:modelValue":C=>e(u)[`task${d.type}ListenerEnable`]=C,"active-text":"\u5F00\u542F","inactive-text":"\u5173\u95ED"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(u)[`task${d.type}ListenerEnable`]?(l(),r("div",yt,[a(s,null,{default:o(()=>[a(h,{title:"\u4EC5\u652F\u6301 POST \u8BF7\u6C42\uFF0C\u4EE5\u8BF7\u6C42\u4F53\u65B9\u5F0F\u63A5\u6536\u53C2\u6570",type:"warning","show-icon":"",closable:!1})]),_:1}),a(s,{label:"\u8BF7\u6C42\u5730\u5740",prop:`task${d.type}ListenerPath`,rules:{required:!0,message:"\u8BF7\u6C42\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[a(g,{modelValue:e(u)[`task${d.type}ListenerPath`],"onUpdate:modelValue":C=>e(u)[`task${d.type}ListenerPath`]=C},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),a(ta,{header:e(u)[`task${d.type}Listener`].header,body:e(u)[`task${d.type}Listener`].body,bind:`task${d.type}Listener`},null,8,["header","body","bind"])])):E("",!0)]))),128))]),_:1},8,["model"])}}}),ht={class:"config-header"},bt=["placeholder"],_t={key:1,class:"node-name"},Nt={class:"flex flex-items-center mb-3"},kt={class:"flex-col"},Et={class:"flex-col"},Tt={class:"flex-col"},wt={class:"flex-col"},Vt={class:"button-setting-pane"},Ut={class:"button-setting-item-label"},St={class:"button-setting-item-label"},Rt=["onBlur","onUpdate:modelValue","placeholder"],Ct={class:"button-setting-item-label"},Dt={class:"field-setting-pane"},xt={class:"field-setting-item-label"},Ot={class:"item-radio-wrap"},It={class:"item-radio-wrap"},At={class:"item-radio-wrap"},Lt=Ol(ne({name:"UserTaskNodeConfig",__name:"UserTaskNodeConfig",props:{flowNode:{type:Object,required:!0}},emits:["find:returnTaskNodes"],setup(M,{expose:K,emit:j}){const R=M,v=j,n=ye(()=>{let O="\u90E8\u95E8\u8D1F\u8D23\u4EBA\u6765\u6E90";return c.value.candidateStrategy==J.MULTI_LEVEL_DEPT_LEADER?O+="(\u6307\u5B9A\u90E8\u95E8\u5411\u4E0A)":c.value.candidateStrategy==J.FORM_DEPT_LEADER?O+="(\u8868\u5355\u5185\u90E8\u95E8\u5411\u4E0A)":O+="(\u53D1\u8D77\u4EBA\u90E8\u95E8\u5411\u4E0A)",O}),u=fe(R),{settingVisible:S,closeDrawer:T,openDrawer:y}=Qe(),{nodeName:U,showInput:N,clickIcon:_,blurEvent:s}=Je(w.USER_TASK_NODE),h=G("user"),{formType:g,fieldsPermissionConfig:k,formFieldOptions:d,getNodeConfigFormFields:b}=Hl(de.READ),C=ye(()=>(d.unshift({field:Ra.START_USER_ID,title:"\u53D1\u8D77\u4EBA",type:"UserSelect",required:!0}),d.filter(O=>O.type==="UserSelect"))),p=ye(()=>d.filter(O=>O.type==="DeptSelect")),{buttonsSetting:V,btnDisplayNameEdit:D,changeBtnDisplayName:z,btnDisplayNameBlurEvent:x}=function(){const O=G(),i=G([]);return{buttonsSetting:O,btnDisplayNameEdit:i,changeBtnDisplayName:te=>{i.value[te]=!0},btnDisplayNameBlurEvent:te=>{i.value[te]=!1;const oe=O.value[te];oe.displayName=oe.displayName||Xl.get(oe.id)}}}(),I=G(il.USER),W=G(),X=tl({candidateStrategy:[{required:!0,message:"\u5BA1\u6279\u4EBA\u8BBE\u7F6E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userIds:[{required:!0,message:"\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],roleIds:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],deptIds:[{required:!0,message:"\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userGroups:[{required:!0,message:"\u7528\u6237\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formUser:[{required:!0,message:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formDept:[{required:!0,message:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],postIds:[{required:!0,message:"\u5C97\u4F4D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],expression:[{required:!0,message:"\u6D41\u7A0B\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],approveMethod:[{required:!0,message:"\u591A\u4EBA\u5BA1\u6279\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],approveRatio:[{required:!0,message:"\u901A\u8FC7\u6BD4\u4F8B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],returnNodeId:[{required:!0,message:"\u9A73\u56DE\u8282\u70B9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],timeoutHandlerEnable:[{required:!0}],timeoutHandlerType:[{required:!0}],timeDuration:[{required:!0,message:"\u8D85\u65F6\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],maxRemindCount:[{required:!0,message:"\u63D0\u9192\u6B21\u6570\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],assignEmptyHandlerType:[{required:!0}],assignEmptyHandlerUserIds:[{required:!0,message:"\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],assignStartUserHandlerType:[{required:!0}]}),{configForm:Z,roleOptions:Q,postOptions:L,userOptions:Ne,userGroupOptions:q,deptTreeOptions:Y,handleCandidateParam:$,parseCandidateParam:H,getShowText:Oe}=Jl(w.USER_TASK_NODE),c=Z,sl=()=>{c.value.userIds=[],c.value.deptIds=[],c.value.roleIds=[],c.value.postIds=[],c.value.userGroups=[],c.value.deptLevel=1,c.value.formUser="",c.value.formDept="",c.value.approveMethod=ze.SEQUENTIAL_APPROVE},ke=()=>{c.value.rejectHandlerType=Ll.FINISH_PROCESS,c.value.approveMethod===ze.APPROVE_BY_RATIO&&(c.value.approveRatio=100),W.value.clearValidate("approveRatio")},Ve=G([]),{timeoutHandlerChange:Re,cTimeoutType:kl,timeoutHandlerTypeChanged:El,timeUnit:je,timeUnitChange:rl,isoTimeDuration:Tl,cTimeoutMaxRemindCount:wl}=function(){const O=G(we.HOUR),i=ye(()=>{if(c.value.timeoutHandlerEnable)return c.value.timeoutHandlerType}),te=ye(()=>{if(!c.value.timeoutHandlerEnable)return;let se="PT";return O.value===we.MINUTE&&(se+=c.value.timeDuration+"M"),O.value===we.HOUR&&(se+=c.value.timeDuration+"H"),O.value===we.DAY&&(se+=c.value.timeDuration+"D"),se}),oe=ye(()=>{if(c.value.timeoutHandlerEnable&&c.value.timeoutHandlerType===Wl.REMINDER)return c.value.maxRemindCount});return{timeoutHandlerChange:()=>{c.value.timeoutHandlerEnable&&(O.value=2,c.value.timeDuration=6,c.value.timeoutHandlerType=1,c.value.maxRemindCount=1)},cTimeoutType:i,timeoutHandlerTypeChanged:()=>{c.value.timeoutHandlerType===Wl.REMINDER&&(c.value.maxRemindCount=1)},timeUnit:O,timeUnitChange:()=>{O.value===we.MINUTE&&(c.value.timeDuration=60),O.value===we.HOUR&&(c.value.timeDuration=6),O.value===we.DAY&&(c.value.timeDuration=1)},isoTimeDuration:te,cTimeoutMaxRemindCount:oe}}(),Ye=G(),ul=async()=>{var i,te,oe,se,Ie,Ae;if(u.value.name=U.value,u.value.approveType=I.value,I.value!==il.USER)return u.value.showText=Ia(I.value),S.value=!1,!0;if(!W||!Ye||!(await W.value.validate()&&await Ye.value.validate()))return!1;const O=Oe();return!!O&&(u.value.candidateStrategy=c.value.candidateStrategy,u.value.candidateParam=$(),u.value.approveMethod=c.value.approveMethod,c.value.approveMethod===ze.APPROVE_BY_RATIO&&(u.value.approveRatio=c.value.approveRatio),u.value.rejectHandler={type:c.value.rejectHandlerType,returnNodeId:c.value.returnNodeId},u.value.timeoutHandler={enable:c.value.timeoutHandlerEnable,type:kl.value,timeDuration:Tl.value,maxRemindCount:wl.value},u.value.assignEmptyHandler={type:c.value.assignEmptyHandlerType,userIds:c.value.assignEmptyHandlerType===Fl.ASSIGN_USER?c.value.assignEmptyHandlerUserIds:void 0},u.value.assignStartUserHandlerType=c.value.assignStartUserHandlerType,u.value.fieldsPermission=k.value,u.value.buttonsSetting=V.value,u.value.taskCreateListener={enable:c.value.taskCreateListenerEnable??!1,path:c.value.taskCreateListenerPath,header:(i=c.value.taskCreateListener)==null?void 0:i.header,body:(te=c.value.taskCreateListener)==null?void 0:te.body},u.value.taskAssignListener={enable:c.value.taskAssignListenerEnable??!1,path:c.value.taskAssignListenerPath,header:(oe=c.value.taskAssignListener)==null?void 0:oe.header,body:(se=c.value.taskAssignListener)==null?void 0:se.body},u.value.taskCompleteListener={enable:c.value.taskCompleteListenerEnable??!1,path:c.value.taskCompleteListenerPath,header:(Ie=c.value.taskCompleteListener)==null?void 0:Ie.header,body:(Ae=c.value.taskCompleteListener)==null?void 0:Ae.body},u.value.signEnable=c.value.signEnable,u.value.reasonRequire=c.value.reasonRequire,u.value.showText=O,S.value=!1,!0)};return K({openDrawer:y,showUserTaskNodeConfig:O=>{var te,oe,se,Ie,Ae,ee,ge,he,cl,pl,Ke,Ue,Le,ml,vl,Fe,Xe,fl,yl;if(U.value=O.name,I.value=O.approveType?O.approveType:il.USER,I.value!==il.USER)return;c.value.candidateStrategy=O.candidateStrategy,H(O.candidateStrategy,O==null?void 0:O.candidateParam),c.value.approveMethod=O.approveMethod,O.approveMethod==ze.APPROVE_BY_RATIO&&(c.value.approveRatio=O.approveRatio),c.value.rejectHandlerType=O.rejectHandler.type,c.value.returnNodeId=(te=O.rejectHandler)==null?void 0:te.returnNodeId;const i=[];if(v("find:returnTaskNodes",i),Ve.value=i,c.value.timeoutHandlerEnable=O.timeoutHandler.enable,((oe=O.timeoutHandler)==null?void 0:oe.enable)&&((se=O.timeoutHandler)==null?void 0:se.timeDuration)){const Pe=O.timeoutHandler.timeDuration;let m=Pe.slice(2,Pe.length-1),le=Pe.slice(Pe.length-1);c.value.timeDuration=parseInt(m),je.value=Zl(le)}c.value.timeoutHandlerType=(Ie=O.timeoutHandler)==null?void 0:Ie.type,c.value.maxRemindCount=(Ae=O.timeoutHandler)==null?void 0:Ae.maxRemindCount,c.value.assignEmptyHandlerType=(ee=O.assignEmptyHandler)==null?void 0:ee.type,c.value.assignEmptyHandlerUserIds=(ge=O.assignEmptyHandler)==null?void 0:ge.userIds,c.value.assignStartUserHandlerType=O.assignStartUserHandlerType,V.value=ra(O.buttonsSetting)||Ca,b(O.fieldsPermission),c.value.taskCreateListenerEnable=(he=O.taskCreateListener)==null?void 0:he.enable,c.value.taskCreateListenerPath=(cl=O.taskCreateListener)==null?void 0:cl.path,c.value.taskCreateListener={header:((pl=O.taskCreateListener)==null?void 0:pl.header)??[],body:((Ke=O.taskCreateListener)==null?void 0:Ke.body)??[]},c.value.taskAssignListenerEnable=(Ue=O.taskAssignListener)==null?void 0:Ue.enable,c.value.taskAssignListenerPath=(Le=O.taskAssignListener)==null?void 0:Le.path,c.value.taskAssignListener={header:((ml=O.taskAssignListener)==null?void 0:ml.header)??[],body:((vl=O.taskAssignListener)==null?void 0:vl.body)??[]},c.value.taskCompleteListenerEnable=(Fe=O.taskCompleteListener)==null?void 0:Fe.enable,c.value.taskCompleteListenerPath=(Xe=O.taskCompleteListener)==null?void 0:Xe.path,c.value.taskCompleteListener={header:((fl=O.taskCompleteListener)==null?void 0:fl.header)??[],body:((yl=O.taskCompleteListener)==null?void 0:yl.body)??[]},c.value.signEnable=(O==null?void 0:O.signEnable)??!1,c.value.reasonRequire=(O==null?void 0:O.reasonRequire)??!1}}),(O,i)=>{const te=ie,oe=bl,se=ll,Ie=ua,Ae=al,ee=He,ge=qe,he=Me,cl=la,pl=We,Ke=zl,Ue=xe,Le=xl,ml=Gl,vl=Be,Fe=Vl,Xe=Ee,fl=Ul,yl=$e,Pe=me("mountedFocus");return l(),f(yl,{"append-to-body":!0,modelValue:e(S),"onUpdate:modelValue":i[30]||(i[30]=m=>ae(S)?S.value=m:null),"show-close":!1,size:580,"before-close":ul,class:"justify-start"},{header:o(()=>[t("div",ht,[e(N)?ce((l(),r("input",{key:0,type:"text",class:"config-editable-input",onBlur:i[0]||(i[0]=m=>e(s)()),"onUpdate:modelValue":i[1]||(i[1]=m=>ae(U)?U.value=m:null),placeholder:e(U)},null,40,bt)),[[Pe],[pe,e(U)]]):(l(),r("div",_t,[F(P(e(U))+" ",1),a(te,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:i[2]||(i[2]=m=>e(_)())})])),i[31]||(i[31]=t("div",{class:"divide-line"},null,-1))])]),footer:o(()=>[a(Ue),t("div",null,[a(Xe,{type:"primary",onClick:ul},{default:o(()=>i[48]||(i[48]=[F("\u786E \u5B9A")])),_:1}),a(Xe,{onClick:e(T)},{default:o(()=>i[49]||(i[49]=[F("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:o(()=>[t("div",Nt,[i[32]||(i[32]=t("span",{class:"font-size-16px mr-3"},"\u5BA1\u6279\u7C7B\u578B :",-1)),a(se,{modelValue:e(I),"onUpdate:modelValue":i[3]||(i[3]=m=>ae(I)?I.value=m:null)},{default:o(()=>[(l(!0),r(A,null,B(e(Ea),(m,le)=>(l(),f(oe,{key:le,value:m.value,label:m.value},{default:o(()=>[F(P(m.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),e(I)===e(il).USER?(l(),f(fl,{key:0,type:"border-card",modelValue:e(h),"onUpdate:modelValue":i[29]||(i[29]=m=>ae(h)?h.value=m:null)},{default:o(()=>[a(Fe,{label:"\u5BA1\u6279\u4EBA",name:"user"},{default:o(()=>[t("div",null,[a(vl,{ref_key:"formRef",ref:W,model:e(c),"label-position":"top",rules:e(X)},{default:o(()=>[a(ee,{label:"\u5BA1\u6279\u4EBA\u8BBE\u7F6E",prop:"candidateStrategy"},{default:o(()=>[a(se,{modelValue:e(c).candidateStrategy,"onUpdate:modelValue":i[4]||(i[4]=m=>e(c).candidateStrategy=m),onChange:sl},{default:o(()=>[a(Ae,null,{default:o(()=>[(l(!0),r(A,null,B(e(Yl),(m,le)=>(l(),f(Ie,{key:le,span:8},{default:o(()=>[a(oe,{value:m.value,label:m.value},{default:o(()=>[F(P(m.label),1)]),_:2},1032,["value","label"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c).candidateStrategy==e(J).ROLE?(l(),f(ee,{key:0,label:"\u6307\u5B9A\u89D2\u8272",prop:"roleIds"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).roleIds,"onUpdate:modelValue":i[5]||(i[5]=m=>e(c).roleIds=m),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(Q),m=>(l(),f(ge,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(c).candidateStrategy==e(J).DEPT_MEMBER||e(c).candidateStrategy==e(J).DEPT_LEADER||e(c).candidateStrategy==e(J).MULTI_LEVEL_DEPT_LEADER?(l(),f(ee,{key:1,label:"\u6307\u5B9A\u90E8\u95E8",prop:"deptIds",span:"24"},{default:o(()=>[a(cl,{ref:"treeRef",modelValue:e(c).deptIds,"onUpdate:modelValue":i[6]||(i[6]=m=>e(c).deptIds=m),data:e(Y),props:e(aa),"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E",multiple:"","node-key":"id","check-strictly":!0,style:{width:"100%"},"show-checkbox":""},null,8,["modelValue","data","props"])]),_:1})):E("",!0),e(c).candidateStrategy==e(J).POST?(l(),f(ee,{key:2,label:"\u6307\u5B9A\u5C97\u4F4D",prop:"postIds",span:"24"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).postIds,"onUpdate:modelValue":i[7]||(i[7]=m=>e(c).postIds=m),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(L),m=>(l(),f(ge,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(c).candidateStrategy==e(J).USER?(l(),f(ee,{key:3,label:"\u6307\u5B9A\u7528\u6237",prop:"userIds",span:"24"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).userIds,"onUpdate:modelValue":i[8]||(i[8]=m=>e(c).userIds=m),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(Ne),m=>(l(),f(ge,{key:m.id,label:m.nickname,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(c).candidateStrategy===e(J).USER_GROUP?(l(),f(ee,{key:4,label:"\u6307\u5B9A\u7528\u6237\u7EC4",prop:"userGroups"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).userGroups,"onUpdate:modelValue":i[9]||(i[9]=m=>e(c).userGroups=m),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(q),m=>(l(),f(ge,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(c).candidateStrategy===e(J).FORM_USER?(l(),f(ee,{key:5,label:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5",prop:"formUser"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).formUser,"onUpdate:modelValue":i[10]||(i[10]=m=>e(c).formUser=m),clearable:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(C),(m,le)=>(l(),f(ge,{key:le,label:m.title,value:m.field,disabled:!m.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(c).candidateStrategy===e(J).FORM_DEPT_LEADER?(l(),f(ee,{key:6,label:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5",prop:"formDept"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).formDept,"onUpdate:modelValue":i[11]||(i[11]=m=>e(c).formDept=m),clearable:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(p),(m,le)=>(l(),f(ge,{key:le,label:m.title,value:m.field,disabled:!m.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(c).candidateStrategy==e(J).MULTI_LEVEL_DEPT_LEADER||e(c).candidateStrategy==e(J).START_USER_DEPT_LEADER||e(c).candidateStrategy==e(J).START_USER_MULTI_LEVEL_DEPT_LEADER||e(c).candidateStrategy==e(J).FORM_DEPT_LEADER?(l(),f(ee,{key:7,label:e(n),prop:"deptLevel",span:"24"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).deptLevel,"onUpdate:modelValue":i[12]||(i[12]=m=>e(c).deptLevel=m),clearable:""},{default:o(()=>[(l(!0),r(A,null,B(e(Kl),(m,le)=>(l(),f(ge,{key:le,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):E("",!0),e(c).candidateStrategy===e(J).EXPRESSION?(l(),f(ee,{key:8,label:"\u6D41\u7A0B\u8868\u8FBE\u5F0F",prop:"expression"},{default:o(()=>[a(pl,{type:"textarea",modelValue:e(c).expression,"onUpdate:modelValue":i[13]||(i[13]=m=>e(c).expression=m),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):E("",!0),a(ee,{label:"\u591A\u4EBA\u5BA1\u6279\u65B9\u5F0F",prop:"approveMethod"},{default:o(()=>[a(se,{modelValue:e(c).approveMethod,"onUpdate:modelValue":i[15]||(i[15]=m=>e(c).approveMethod=m),onChange:ke},{default:o(()=>[t("div",kt,[(l(!0),r(A,null,B(e(Ta),(m,le)=>(l(),r("div",{key:le,class:"flex items-center"},[a(oe,{value:m.value,label:m.value},{default:o(()=>[F(P(m.label),1)]),_:2},1032,["value","label"]),a(ee,{prop:"approveRatio"},{default:o(()=>[m.value===e(ze).APPROVE_BY_RATIO&&e(c).approveMethod===e(ze).APPROVE_BY_RATIO?(l(),f(Ke,{key:0,modelValue:e(c).approveRatio,"onUpdate:modelValue":i[14]||(i[14]=Ce=>e(c).approveRatio=Ce),min:10,max:100,step:10,size:"small"},null,8,["modelValue"])):E("",!0)]),_:2},1024)]))),128))])]),_:1},8,["modelValue"])]),_:1}),a(Ue,{"content-position":"left"},{default:o(()=>i[33]||(i[33]=[F("\u5BA1\u6279\u4EBA\u62D2\u7EDD\u65F6")])),_:1}),a(ee,{prop:"rejectHandlerType"},{default:o(()=>[a(se,{modelValue:e(c).rejectHandlerType,"onUpdate:modelValue":i[16]||(i[16]=m=>e(c).rejectHandlerType=m)},{default:o(()=>[t("div",Et,[(l(!0),r(A,null,B(e(wa),(m,le)=>(l(),r("div",{key:le},[(l(),f(oe,{key:m.value,value:m.value,label:m.label},null,8,["value","label"]))]))),128))])]),_:1},8,["modelValue"])]),_:1}),e(c).rejectHandlerType==e(Ll).RETURN_USER_TASK?(l(),f(ee,{key:9,label:"\u9A73\u56DE\u8282\u70B9",prop:"returnNodeId"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).returnNodeId,"onUpdate:modelValue":i[17]||(i[17]=m=>e(c).returnNodeId=m),clearable:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(Ve),m=>(l(),f(ge,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),a(Ue,{"content-position":"left"},{default:o(()=>i[34]||(i[34]=[F("\u5BA1\u6279\u4EBA\u8D85\u65F6\u672A\u5904\u7406\u65F6")])),_:1}),a(ee,{label:"\u542F\u7528\u5F00\u5173",prop:"timeoutHandlerEnable"},{default:o(()=>[a(Le,{modelValue:e(c).timeoutHandlerEnable,"onUpdate:modelValue":i[18]||(i[18]=m=>e(c).timeoutHandlerEnable=m),"active-text":"\u5F00\u542F","inactive-text":"\u5173\u95ED",onChange:e(Re)},null,8,["modelValue","onChange"])]),_:1}),e(c).timeoutHandlerEnable?(l(),f(ee,{key:10,label:"\u6267\u884C\u52A8\u4F5C",prop:"timeoutHandlerType"},{default:o(()=>[a(se,{modelValue:e(c).timeoutHandlerType,"onUpdate:modelValue":i[19]||(i[19]=m=>e(c).timeoutHandlerType=m),onChange:e(El)},{default:o(()=>[(l(!0),r(A,null,B(e(Va),m=>(l(),f(ml,{key:m.value,value:m.value,label:m.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})):E("",!0),e(c).timeoutHandlerEnable?(l(),f(ee,{key:11,label:"\u8D85\u65F6\u65F6\u95F4\u8BBE\u7F6E"},{default:o(()=>[i[35]||(i[35]=t("span",{class:"mr-2"},"\u5F53\u8D85\u8FC7",-1)),a(ee,{prop:"timeDuration"},{default:o(()=>[a(Ke,{class:"mr-2",style:{width:"100px"},modelValue:e(c).timeDuration,"onUpdate:modelValue":i[20]||(i[20]=m=>e(c).timeDuration=m),min:1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(he,{filterable:"",modelValue:e(je),"onUpdate:modelValue":i[21]||(i[21]=m=>ae(je)?je.value=m:null),class:"mr-2",style:{width:"100px"},onChange:e(rl)},{default:o(()=>[(l(!0),r(A,null,B(e(Pl),m=>(l(),f(ge,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),i[36]||(i[36]=F(" \u672A\u5904\u7406 "))]),_:1})):E("",!0),e(c).timeoutHandlerEnable&&e(c).timeoutHandlerType===1?(l(),f(ee,{key:12,label:"\u6700\u5927\u63D0\u9192\u6B21\u6570",prop:"maxRemindCount"},{default:o(()=>[a(Ke,{modelValue:e(c).maxRemindCount,"onUpdate:modelValue":i[22]||(i[22]=m=>e(c).maxRemindCount=m),min:1,max:10},null,8,["modelValue"])]),_:1})):E("",!0),a(Ue,{"content-position":"left"},{default:o(()=>i[37]||(i[37]=[F("\u5BA1\u6279\u4EBA\u4E3A\u7A7A\u65F6")])),_:1}),a(ee,{prop:"assignEmptyHandlerType"},{default:o(()=>[a(se,{modelValue:e(c).assignEmptyHandlerType,"onUpdate:modelValue":i[23]||(i[23]=m=>e(c).assignEmptyHandlerType=m)},{default:o(()=>[t("div",Tt,[(l(!0),r(A,null,B(e(Ua),(m,le)=>(l(),r("div",{key:le},[(l(),f(oe,{key:m.value,value:m.value,label:m.label},null,8,["value","label"]))]))),128))])]),_:1},8,["modelValue"])]),_:1}),e(c).assignEmptyHandlerType==e(Fl).ASSIGN_USER?(l(),f(ee,{key:13,label:"\u6307\u5B9A\u7528\u6237",prop:"assignEmptyHandlerUserIds",span:"24"},{default:o(()=>[a(he,{filterable:"",modelValue:e(c).assignEmptyHandlerUserIds,"onUpdate:modelValue":i[24]||(i[24]=m=>e(c).assignEmptyHandlerUserIds=m),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(Ne),m=>(l(),f(ge,{key:m.id,label:m.nickname,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),a(Ue,{"content-position":"left"},{default:o(()=>i[38]||(i[38]=[F("\u5BA1\u6279\u4EBA\u4E0E\u63D0\u4EA4\u4EBA\u4E3A\u540C\u4E00\u4EBA\u65F6")])),_:1}),a(ee,{prop:"assignStartUserHandlerType"},{default:o(()=>[a(se,{modelValue:e(c).assignStartUserHandlerType,"onUpdate:modelValue":i[25]||(i[25]=m=>e(c).assignStartUserHandlerType=m)},{default:o(()=>[t("div",wt,[(l(!0),r(A,null,B(e(Sa),(m,le)=>(l(),r("div",{key:le},[(l(),f(oe,{key:m.value,value:m.value,label:m.label},null,8,["value","label"]))]))),128))])]),_:1},8,["modelValue"])]),_:1}),a(Ue,{"content-position":"left"},{default:o(()=>i[39]||(i[39]=[F("\u662F\u5426\u9700\u8981\u7B7E\u540D")])),_:1}),a(ee,{prop:"signEnable"},{default:o(()=>[a(Le,{modelValue:e(c).signEnable,"onUpdate:modelValue":i[26]||(i[26]=m=>e(c).signEnable=m),"active-text":"\u662F","inactive-text":"\u5426"},null,8,["modelValue"])]),_:1}),a(Ue,{"content-position":"left"},{default:o(()=>i[40]||(i[40]=[F("\u5BA1\u6279\u610F\u89C1")])),_:1}),a(ee,{prop:"reasonRequire"},{default:o(()=>[a(Le,{modelValue:e(c).reasonRequire,"onUpdate:modelValue":i[27]||(i[27]=m=>e(c).reasonRequire=m),"active-text":"\u5FC5\u586B","inactive-text":"\u975E\u5FC5\u586B"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1}),a(Fe,{label:"\u64CD\u4F5C\u6309\u94AE\u8BBE\u7F6E",name:"buttons"},{default:o(()=>[t("div",Vt,[i[41]||(i[41]=t("div",{class:"button-setting-desc"},"\u64CD\u4F5C\u6309\u94AE",-1)),i[42]||(i[42]=t("div",{class:"button-setting-title"},[t("div",{class:"button-title-label"},"\u64CD\u4F5C\u6309\u94AE"),t("div",{class:"pl-4 button-title-label"},"\u663E\u793A\u540D\u79F0"),t("div",{class:"button-title-label"},"\u542F\u7528")],-1)),(l(!0),r(A,null,B(e(V),(m,le)=>(l(),r("div",{class:"button-setting-item",key:le},[t("div",Ut,P(e(Xl).get(m.id)),1),t("div",St,[e(D)[le]?ce((l(),r("input",{key:0,type:"text",class:"editable-title-input",onBlur:Ce=>e(x)(le),"onUpdate:modelValue":Ce=>m.displayName=Ce,placeholder:m.displayName},null,40,Rt)),[[Pe],[pe,m.displayName]]):(l(),f(Xe,{key:1,text:"",onClick:Ce=>e(z)(le)},{default:o(()=>[F(P(m.displayName)+" \xA0",1),a(te,{icon:"ep:edit"})]),_:2},1032,["onClick"]))]),t("div",Ct,[a(Le,{modelValue:m.enable,"onUpdate:modelValue":Ce=>m.enable=Ce},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1}),e(g)===10?(l(),f(Fe,{key:0,label:"\u8868\u5355\u5B57\u6BB5\u6743\u9650",name:"fields"},{default:o(()=>[t("div",Dt,[i[46]||(i[46]=t("div",{class:"field-setting-desc"},"\u5B57\u6BB5\u6743\u9650",-1)),i[47]||(i[47]=t("div",{class:"field-permit-title"},[t("div",{class:"setting-title-label first-title"}," \u5B57\u6BB5\u540D\u79F0 "),t("div",{class:"other-titles"},[t("span",{class:"setting-title-label"},"\u53EA\u8BFB"),t("span",{class:"setting-title-label"},"\u53EF\u7F16\u8F91"),t("span",{class:"setting-title-label"},"\u9690\u85CF")])],-1)),(l(!0),r(A,null,B(e(k),(m,le)=>(l(),r("div",{class:"field-setting-item",key:le},[t("div",xt,P(m.title),1),a(se,{class:"field-setting-item-group",modelValue:m.permission,"onUpdate:modelValue":Ce=>m.permission=Ce},{default:o(()=>[t("div",Ot,[a(oe,{value:e(de).READ,size:"large",label:e(de).READ},{default:o(()=>i[43]||(i[43]=[t("span",null,null,-1)])),_:1},8,["value","label"])]),t("div",It,[a(oe,{value:e(de).WRITE,size:"large",label:e(de).WRITE},{default:o(()=>i[44]||(i[44]=[t("span",null,null,-1)])),_:1},8,["value","label"])]),t("div",At,[a(oe,{value:e(de).NONE,size:"large",label:e(de).NONE},{default:o(()=>i[45]||(i[45]=[t("span",null,null,-1)])),_:1},8,["value","label"])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})):E("",!0),a(Fe,{label:"\u76D1\u542C\u5668",name:"listener"},{default:o(()=>[a(gt,{ref_key:"userTaskListenerRef",ref:Ye,modelValue:e(c),"onUpdate:modelValue":i[28]||(i[28]=m=>ae(c)?c.value=m:null),"form-field-options":e(d)},null,8,["modelValue","form-field-options"])]),_:1})]),_:1},8,["modelValue"])):E("",!0)]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-0e955032"]]),Ft={class:"node-wrapper"},Pt={class:"node-container"},Ht={class:"node-title-container"},qt=["placeholder"],Mt=["title"],Bt={key:1,class:"node-text"},zt={key:0,class:"node-toolbar"},Gt={class:"toolbar-icon"},$t=ne({name:"UserTaskNode",__name:"UserTaskNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode","find:parentNode"],setup(M,{emit:K}){const j=M,R=K,v=re("readonly"),n=re("tasks",G([])),u=fe(j),{showInput:S,blurEvent:T,clickTitle:y}=Ze(u,w.START_USER_NODE),U=G(),N=()=>{v?n&&n.value&&(g.value=u.value.name,k.value=n.value.filter(d=>(d==null?void 0:d.taskDefinitionKey)===u.value.id),h.value=!0):(U.value.showUserTaskNodeConfig(u.value),U.value.openDrawer())},_=()=>{R("update:flowNode",u.value.childNode)},s=d=>{R("find:parentNode",d,w.USER_TASK_NODE)},h=G(!1),g=G(void 0),k=G([]);return(d,b)=>{var W;const C=ie,p=Rl,V=Al,D=Cl,z=al,x=Dl,I=me("mountedFocus");return l(),r(A,null,[t("div",Ft,[t("div",Pt,[t("div",{class:be(["node-box",[{"node-config-error":!e(u).showText},`${e(_e)((W=e(u))==null?void 0:W.activityStatus)}`]])},[t("div",Ht,[b[5]||(b[5]=t("div",{class:"node-title-icon user-task"},[t("span",{class:"iconfont icon-approve"})],-1)),!e(v)&&e(S)?ce((l(),r("input",{key:0,type:"text",class:"editable-title-input",onBlur:b[0]||(b[0]=X=>e(T)()),"onUpdate:modelValue":b[1]||(b[1]=X=>e(u).name=X),placeholder:e(u).name},null,40,qt)),[[I],[pe,e(u).name]]):(l(),r("div",{key:1,class:"node-title",onClick:b[2]||(b[2]=(...X)=>e(y)&&e(y)(...X))},P(e(u).name),1))]),t("div",{class:"node-content",onClick:N},[e(u).showText?(l(),r("div",{key:0,class:"node-text",title:e(u).showText},P(e(u).showText),9,Mt)):(l(),r("div",Bt,P(e(Se).get(e(w).USER_TASK_NODE)),1)),e(v)?E("",!0):(l(),f(C,{key:2,icon:"ep:arrow-right-bold"}))]),e(v)?E("",!0):(l(),r("div",zt,[t("div",Gt,[a(C,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:_})])]))],2),e(u)?(l(),f(Te,{key:0,"child-node":e(u).childNode,"onUpdate:childNode":b[3]||(b[3]=X=>e(u).childNode=X),"current-node":e(u)},null,8,["child-node","current-node"])):E("",!0)])]),e(u)?(l(),f(Lt,{key:0,ref_key:"nodeSetting",ref:U,"flow-node":e(u),"onFind:returnTaskNodes":s},null,8,["flow-node"])):E("",!0),a(x,{title:e(g)||"\u5BA1\u6279\u8BB0\u5F55",modelValue:e(h),"onUpdate:modelValue":b[4]||(b[4]=X=>ae(h)?h.value=X:null),width:"1000px","append-to-body":""},{default:o(()=>[a(z,null,{default:o(()=>[a(D,{data:e(k),size:"small",border:"","header-cell-class-name":"table-header-gray"},{default:o(()=>[a(p,{label:"\u5E8F\u53F7","header-align":"center",align:"center",type:"index",width:"50"}),a(p,{label:"\u5BA1\u6279\u4EBA","min-width":"100",align:"center"},{default:o(X=>{var Z,Q;return[F(P(((Z=X.row.assigneeUser)==null?void 0:Z.nickname)||((Q=X.row.ownerUser)==null?void 0:Q.nickname)),1)]}),_:1}),a(p,{label:"\u90E8\u95E8","min-width":"100",align:"center"},{default:o(X=>{var Z,Q;return[F(P(((Z=X.row.assigneeUser)==null?void 0:Z.deptName)||((Q=X.row.ownerUser)==null?void 0:Q.deptName)),1)]}),_:1}),a(p,{formatter:e(el),align:"center",label:"\u5F00\u59CB\u65F6\u95F4",prop:"createTime","min-width":"140"},null,8,["formatter"]),a(p,{formatter:e(el),align:"center",label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime","min-width":"140"},null,8,["formatter"]),a(p,{align:"center",label:"\u5BA1\u6279\u72B6\u6001",prop:"status","min-width":"90"},{default:o(X=>[a(V,{type:e(Sl).BPM_TASK_STATUS,value:X.row.status},null,8,["type","value"])]),_:1}),a(p,{align:"center",label:"\u5BA1\u6279\u5EFA\u8BAE",prop:"reason","min-width":"120"}),a(p,{align:"center",label:"\u8017\u65F6",prop:"durationInMillis",width:"100"},{default:o(X=>[F(P(e(Ml)(X.row.durationInMillis)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["title","modelValue"])],64)}}}),jt={class:"config-header"},Yt=["placeholder"],Kt={key:1,class:"node-name"},Xt={class:"field-setting-pane"},Wt={class:"field-setting-item-label"},Qt={class:"item-radio-wrap"},Jt={class:"item-radio-wrap"},Zt={class:"item-radio-wrap"},eo=ne({name:"CopyTaskNodeConfig",__name:"CopyTaskNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(M,{expose:K}){const j=M,R=ye(()=>{let $="\u90E8\u95E8\u8D1F\u8D23\u4EBA\u6765\u6E90";return L.value.candidateStrategy==J.MULTI_LEVEL_DEPT_LEADER?$+="(\u6307\u5B9A\u90E8\u95E8\u5411\u4E0A)":$+="(\u53D1\u8D77\u4EBA\u90E8\u95E8\u5411\u4E0A)",$}),{settingVisible:v,closeDrawer:n,openDrawer:u}=Qe(),S=fe(j),{nodeName:T,showInput:y,clickIcon:U,blurEvent:N}=Je(w.COPY_TASK_NODE),_=G("user"),{formType:s,fieldsPermissionConfig:h,formFieldOptions:g,getNodeConfigFormFields:k}=Hl(de.READ),d=ye(()=>g.filter($=>$.type==="UserSelect")),b=ye(()=>g.filter($=>$.type==="DeptSelect")),C=G(),p=tl({candidateStrategy:[{required:!0,message:"\u6284\u9001\u4EBA\u8BBE\u7F6E\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userIds:[{required:!0,message:"\u7528\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],roleIds:[{required:!0,message:"\u89D2\u8272\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],deptIds:[{required:!0,message:"\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],userGroups:[{required:!0,message:"\u7528\u6237\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],postIds:[{required:!0,message:"\u5C97\u4F4D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formUser:[{required:!0,message:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],formDept:[{required:!0,message:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],expression:[{required:!0,message:"\u6D41\u7A0B\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),{configForm:V,roleOptions:D,postOptions:z,userOptions:x,userGroupOptions:I,deptTreeOptions:W,getShowText:X,handleCandidateParam:Z,parseCandidateParam:Q}=Jl(w.COPY_TASK_NODE),L=V,Ne=ye(()=>Yl.filter($=>$.value!==J.START_USER)),q=()=>{L.value.userIds=[],L.value.deptIds=[],L.value.roleIds=[],L.value.postIds=[],L.value.userGroups=[],L.value.deptLevel=1,L.value.formUser=""},Y=async()=>{if(_.value="user",!C||!await C.value.validate())return!1;const $=X();return!!$&&(S.value.name=T.value,S.value.candidateParam=Z(),S.value.candidateStrategy=L.value.candidateStrategy,S.value.showText=$,S.value.fieldsPermission=h.value,v.value=!1,!0)};return K({openDrawer:u,showCopyTaskNodeConfig:$=>{T.value=$.name,L.value.candidateStrategy=$.candidateStrategy,Q($.candidateStrategy,$==null?void 0:$.candidateParam),k($.fieldsPermission)}}),($,H)=>{const Oe=ie,c=bl,sl=ll,ke=He,Ve=qe,Re=Me,kl=la,El=We,je=Be,rl=Vl,Tl=Ul,wl=xe,Ye=Ee,ul=$e,O=me("mountedFocus");return l(),f(ul,{"append-to-body":!0,modelValue:e(v),"onUpdate:modelValue":H[14]||(H[14]=i=>ae(v)?v.value=i:null),"show-close":!1,size:550,"before-close":Y},{header:o(()=>[t("div",jt,[e(y)?ce((l(),r("input",{key:0,type:"text",class:"config-editable-input",onBlur:H[0]||(H[0]=i=>e(N)()),"onUpdate:modelValue":H[1]||(H[1]=i=>ae(T)?T.value=i:null),placeholder:e(T)},null,40,Yt)),[[O],[pe,e(T)]]):(l(),r("div",Kt,[F(P(e(T))+" ",1),a(Oe,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:H[2]||(H[2]=i=>e(U)())})])),H[15]||(H[15]=t("div",{class:"divide-line"},null,-1))])]),footer:o(()=>[a(wl),t("div",null,[a(Ye,{type:"primary",onClick:Y},{default:o(()=>H[21]||(H[21]=[F("\u786E \u5B9A")])),_:1}),a(Ye,{onClick:e(n)},{default:o(()=>H[22]||(H[22]=[F("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:o(()=>[a(Tl,{type:"border-card",modelValue:e(_),"onUpdate:modelValue":H[13]||(H[13]=i=>ae(_)?_.value=i:null)},{default:o(()=>[a(rl,{label:"\u6284\u9001\u4EBA",name:"user"},{default:o(()=>[t("div",null,[a(je,{ref_key:"formRef",ref:C,model:e(L),"label-position":"top",rules:e(p)},{default:o(()=>[a(ke,{label:"\u6284\u9001\u4EBA\u8BBE\u7F6E",prop:"candidateStrategy"},{default:o(()=>[a(sl,{modelValue:e(L).candidateStrategy,"onUpdate:modelValue":H[3]||(H[3]=i=>e(L).candidateStrategy=i),onChange:q},{default:o(()=>[(l(!0),r(A,null,B(e(Ne),(i,te)=>(l(),f(c,{key:te,value:i.value,label:i.value},{default:o(()=>[F(P(i.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(L).candidateStrategy==e(J).ROLE?(l(),f(ke,{key:0,label:"\u6307\u5B9A\u89D2\u8272",prop:"roleIds"},{default:o(()=>[a(Re,{modelValue:e(L).roleIds,"onUpdate:modelValue":H[4]||(H[4]=i=>e(L).roleIds=i),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(D),i=>(l(),f(Ve,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(L).candidateStrategy==e(J).DEPT_MEMBER||e(L).candidateStrategy==e(J).DEPT_LEADER||e(L).candidateStrategy==e(J).MULTI_LEVEL_DEPT_LEADER?(l(),f(ke,{key:1,label:"\u6307\u5B9A\u90E8\u95E8",prop:"deptIds",span:"24"},{default:o(()=>[a(kl,{ref:"treeRef",modelValue:e(L).deptIds,"onUpdate:modelValue":H[5]||(H[5]=i=>e(L).deptIds=i),data:e(W),props:e(aa),"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E",multiple:"","node-key":"id",style:{width:"100%"},"show-checkbox":""},null,8,["modelValue","data","props"])]),_:1})):E("",!0),e(L).candidateStrategy==e(J).POST?(l(),f(ke,{key:2,label:"\u6307\u5B9A\u5C97\u4F4D",prop:"postIds",span:"24"},{default:o(()=>[a(Re,{modelValue:e(L).postIds,"onUpdate:modelValue":H[6]||(H[6]=i=>e(L).postIds=i),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(z),i=>(l(),f(Ve,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(L).candidateStrategy==e(J).USER?(l(),f(ke,{key:3,label:"\u6307\u5B9A\u7528\u6237",prop:"userIds",span:"24"},{default:o(()=>[a(Re,{modelValue:e(L).userIds,"onUpdate:modelValue":H[7]||(H[7]=i=>e(L).userIds=i),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(x),i=>(l(),f(Ve,{key:i.id,label:i.nickname,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(L).candidateStrategy===e(J).USER_GROUP?(l(),f(ke,{key:4,label:"\u6307\u5B9A\u7528\u6237\u7EC4",prop:"userGroups"},{default:o(()=>[a(Re,{modelValue:e(L).userGroups,"onUpdate:modelValue":H[8]||(H[8]=i=>e(L).userGroups=i),clearable:"",multiple:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(I),i=>(l(),f(Ve,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(L).candidateStrategy===e(J).FORM_USER?(l(),f(ke,{key:5,label:"\u8868\u5355\u5185\u7528\u6237\u5B57\u6BB5",prop:"formUser"},{default:o(()=>[a(Re,{modelValue:e(L).formUser,"onUpdate:modelValue":H[9]||(H[9]=i=>e(L).formUser=i),clearable:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(d),(i,te)=>(l(),f(Ve,{key:te,label:i.title,value:i.field,disabled:!i.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(L).candidateStrategy===e(J).FORM_DEPT_LEADER?(l(),f(ke,{key:6,label:"\u8868\u5355\u5185\u90E8\u95E8\u5B57\u6BB5",prop:"formDept"},{default:o(()=>[a(Re,{modelValue:e(L).formDept,"onUpdate:modelValue":H[10]||(H[10]=i=>e(L).formDept=i),clearable:"",style:{width:"100%"}},{default:o(()=>[(l(!0),r(A,null,B(e(b),(i,te)=>(l(),f(Ve,{key:te,label:i.title,value:i.field,disabled:!i.required},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(L).candidateStrategy==e(J).MULTI_LEVEL_DEPT_LEADER||e(L).candidateStrategy==e(J).START_USER_DEPT_LEADER||e(L).candidateStrategy==e(J).START_USER_MULTI_LEVEL_DEPT_LEADER||e(L).candidateStrategy==e(J).FORM_DEPT_LEADER?(l(),f(ke,{key:7,label:e(R),prop:"deptLevel",span:"24"},{default:o(()=>[a(Re,{modelValue:e(L).deptLevel,"onUpdate:modelValue":H[11]||(H[11]=i=>e(L).deptLevel=i),clearable:""},{default:o(()=>[(l(!0),r(A,null,B(e(Kl),(i,te)=>(l(),f(Ve,{key:te,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):E("",!0),e(L).candidateStrategy===e(J).EXPRESSION?(l(),f(ke,{key:8,label:"\u6D41\u7A0B\u8868\u8FBE\u5F0F",prop:"expression"},{default:o(()=>[a(El,{type:"textarea",modelValue:e(L).expression,"onUpdate:modelValue":H[12]||(H[12]=i=>e(L).expression=i),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):E("",!0)]),_:1},8,["model","rules"])])]),_:1}),e(s)===10?(l(),f(rl,{key:0,label:"\u8868\u5355\u5B57\u6BB5\u6743\u9650",name:"fields"},{default:o(()=>[t("div",Xt,[H[19]||(H[19]=t("div",{class:"field-setting-desc"},"\u5B57\u6BB5\u6743\u9650",-1)),H[20]||(H[20]=t("div",{class:"field-permit-title"},[t("div",{class:"setting-title-label first-title"}," \u5B57\u6BB5\u540D\u79F0 "),t("div",{class:"other-titles"},[t("span",{class:"setting-title-label"},"\u53EA\u8BFB"),t("span",{class:"setting-title-label"},"\u53EF\u7F16\u8F91"),t("span",{class:"setting-title-label"},"\u9690\u85CF")])],-1)),(l(!0),r(A,null,B(e(h),(i,te)=>(l(),r("div",{class:"field-setting-item",key:te},[t("div",Wt,P(i.title),1),a(sl,{class:"field-setting-item-group",modelValue:i.permission,"onUpdate:modelValue":oe=>i.permission=oe},{default:o(()=>[t("div",Qt,[a(c,{value:e(de).READ,size:"large",label:e(de).WRITE},{default:o(()=>H[16]||(H[16]=[t("span",null,null,-1)])),_:1},8,["value","label"])]),t("div",Jt,[a(c,{value:e(de).WRITE,size:"large",label:e(de).WRITE,disabled:""},{default:o(()=>H[17]||(H[17]=[t("span",null,null,-1)])),_:1},8,["value","label"])]),t("div",Zt,[a(c,{value:e(de).NONE,size:"large",label:e(de).NONE},{default:o(()=>H[18]||(H[18]=[t("span",null,null,-1)])),_:1},8,["value","label"])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])]),_:1})):E("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),lo={class:"node-wrapper"},ao={class:"node-container"},to={class:"node-title-container"},oo=["placeholder"],no=["title"],io={key:1,class:"node-text"},so={key:0,class:"node-toolbar"},ro={class:"toolbar-icon"},uo=ne({name:"CopyTaskNode",__name:"CopyTaskNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(M,{emit:K}){const j=M,R=K,v=re("readonly"),n=fe(j),{showInput:u,blurEvent:S,clickTitle:T}=Ze(n,w.COPY_TASK_NODE),y=G(),U=()=>{v||(y.value.showCopyTaskNodeConfig(n.value),y.value.openDrawer())},N=()=>{R("update:flowNode",n.value.childNode)};return(_,s)=>{var k;const h=ie,g=me("mountedFocus");return l(),r("div",lo,[t("div",ao,[t("div",{class:be(["node-box",[{"node-config-error":!e(n).showText},`${e(_e)((k=e(n))==null?void 0:k.activityStatus)}`]])},[t("div",to,[s[4]||(s[4]=t("div",{class:"node-title-icon copy-task"},[t("span",{class:"iconfont icon-copy"})],-1)),!e(v)&&e(u)?ce((l(),r("input",{key:0,type:"text",class:"editable-title-input",onBlur:s[0]||(s[0]=d=>e(S)()),"onUpdate:modelValue":s[1]||(s[1]=d=>e(n).name=d),placeholder:e(n).name},null,40,oo)),[[g],[pe,e(n).name]]):(l(),r("div",{key:1,class:"node-title",onClick:s[2]||(s[2]=(...d)=>e(T)&&e(T)(...d))},P(e(n).name),1))]),t("div",{class:"node-content",onClick:U},[e(n).showText?(l(),r("div",{key:0,class:"node-text",title:e(n).showText},P(e(n).showText),9,no)):(l(),r("div",io,P(e(Se).get(e(w).COPY_TASK_NODE)),1)),e(v)?E("",!0):(l(),f(h,{key:2,icon:"ep:arrow-right-bold"}))]),e(v)?E("",!0):(l(),r("div",so,[t("div",ro,[a(h,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),f(Te,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":s[3]||(s[3]=d=>e(n).childNode=d),"current-node":e(n)},null,8,["child-node","current-node"])):E("",!0)]),!e(v)&&e(n)?(l(),f(eo,{key:0,ref_key:"nodeSetting",ref:y,"flow-node":e(n)},null,8,["flow-node"])):E("",!0)])}}}),co={class:"condition-group-tool"},po={class:"flex items-center"},mo={key:0,class:"condition-group-delete"},vo={class:"flex items-center justify-between"},fo={class:"flex"},yo={class:"mr-2"},go={class:"mr-2"},ho={class:"mr-2"},bo={key:0,class:"mr-1 flex items-center"},_o={class:"flex items-center"},No={title:"\u6DFB\u52A0\u6761\u4EF6\u7EC4",class:"mt-4 cursor-pointer"},oa=Ol(ne({__name:"Condition",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(M,{expose:K,emit:j}){const R=M,v=j,n=ye({get:()=>R.modelValue,set(_){v("update:modelValue",_)}}),u=re("formType"),S=ye(()=>Da.filter(_=>(u==null?void 0:u.value)!==Pa.CUSTOM||_.value!==ve.RULE)),T=ql(),y=tl({conditionType:[{required:!0,message:"\u914D\u7F6E\u65B9\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],conditionExpression:[{required:!0,message:"\u6761\u4EF6\u8868\u8FBE\u5F0F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),U=G(),N=()=>{n.value.conditionType===ve.RULE&&(n.value.conditionGroups||(n.value.conditionGroups=nl))};return K({validate:async()=>!!U&&await U.value.validate()}),(_,s)=>{const h=bl,g=ll,k=He,d=xl,b=ie,C=qe,p=Me,V=We,D=$l,z=Fa,x=Be;return l(),f(x,{ref_key:"formRef",ref:U,model:e(n),rules:e(y),"label-position":"top"},{default:o(()=>[a(k,{label:"\u914D\u7F6E\u65B9\u5F0F",prop:"conditionType"},{default:o(()=>[a(g,{modelValue:e(n).conditionType,"onUpdate:modelValue":s[0]||(s[0]=I=>e(n).conditionType=I),onChange:N},{default:o(()=>[(l(!0),r(A,null,B(e(S),(I,W)=>(l(),f(h,{key:W,value:I.value,label:I.value},{default:o(()=>[F(P(I.label),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n).conditionType===e(ve).RULE&&e(n).conditionGroups?(l(),f(k,{key:0,label:"\u6761\u4EF6\u89C4\u5219"},{default:o(()=>[t("div",co,[t("div",po,[s[4]||(s[4]=t("div",{class:"mr-4"},"\u6761\u4EF6\u7EC4\u5173\u7CFB",-1)),a(d,{modelValue:e(n).conditionGroups.and,"onUpdate:modelValue":s[1]||(s[1]=I=>e(n).conditionGroups.and=I),"inline-prompt":"","active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue"])])]),a(z,{direction:"vertical",spacer:e(n).conditionGroups.and?"\u4E14":"\u6216"},{default:o(()=>[(l(!0),r(A,null,B(e(n).conditionGroups.conditions,(I,W)=>(l(),f(D,{class:"condition-group",style:{width:"530px"},key:W},{header:o(()=>[t("div",vo,[s[6]||(s[6]=t("div",null,"\u6761\u4EF6\u7EC4",-1)),t("div",fo,[s[5]||(s[5]=t("div",{class:"mr-4"},"\u89C4\u5219\u5173\u7CFB",-1)),a(d,{modelValue:I.and,"onUpdate:modelValue":X=>I.and=X,"inline-prompt":"","active-text":"\u4E14","inactive-text":"\u6216"},null,8,["modelValue","onUpdate:modelValue"])])])]),default:o(()=>[e(n).conditionGroups.conditions.length>1?(l(),r("div",mo,[a(b,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:X=>{return Z=e(n).conditionGroups.conditions,Q=W,void Z.splice(Q,1);var Z,Q}},null,8,["onClick"])])):E("",!0),(l(!0),r(A,null,B(I.rules,(X,Z)=>(l(),r("div",{class:"flex pt-2",key:Z},[t("div",yo,[a(k,{prop:`conditionGroups.conditions.${W}.rules.${Z}.leftSide`,rules:{required:!0,message:"\u5DE6\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}},{default:o(()=>[a(p,{style:{width:"160px"},modelValue:X.leftSide,"onUpdate:modelValue":Q=>X.leftSide=Q},{default:o(()=>[(l(!0),r(A,null,B(e(T),(Q,L)=>(l(),f(C,{key:L,label:Q.title,value:Q.field,disabled:!Q.required},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),t("div",go,[a(p,{modelValue:X.opCode,"onUpdate:modelValue":Q=>X.opCode=Q,style:{width:"100px"}},{default:o(()=>[(l(!0),r(A,null,B(e(Ql),Q=>(l(),f(C,{key:Q.value,label:Q.label,value:Q.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),t("div",ho,[a(k,{prop:`conditionGroups.conditions.${W}.rules.${Z}.rightSide`,rules:{required:!0,message:"\u53F3\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[a(V,{modelValue:X.rightSide,"onUpdate:modelValue":Q=>X.rightSide=Q,style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),I.rules.length>1?(l(),r("div",bo,[a(b,{icon:"ep:delete",size:18,onClick:Q=>{return L=Z,void I.rules.splice(L,1);var L}},null,8,["onClick"])])):E("",!0),t("div",_o,[a(b,{icon:"ep:plus",size:18,onClick:Q=>{return L=Z,void I.rules.splice(L+1,0,{opCode:"==",leftSide:"",rightSide:""});var L}},null,8,["onClick"])])]))),128))]),_:2},1024))),128))]),_:1},8,["spacer"]),t("div",No,[a(b,{color:"#0089ff",icon:"ep:plus",size:24,onClick:s[2]||(s[2]=I=>{var X;return W=(X=e(n).conditionGroups)==null?void 0:X.conditions,void W.push({and:!0,rules:[{opCode:"==",leftSide:"",rightSide:""}]});var W})})])]),_:1})):E("",!0),e(n).conditionType===e(ve).EXPRESSION?(l(),f(k,{key:1,label:"\u6761\u4EF6\u8868\u8FBE\u5F0F",prop:"conditionExpression"},{default:o(()=>[a(V,{type:"textarea",modelValue:e(n).conditionExpression,"onUpdate:modelValue":s[3]||(s[3]=I=>e(n).conditionExpression=I),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):E("",!0)]),_:1},8,["model","rules"])}}}),[["__scopeId","data-v-15599f77"]]),ko={class:"config-header"},Eo=["placeholder"],To={key:1,class:"node-name"},wo={key:0,class:"mb-3 font-size-16px"},Vo={key:1},na=Ol(ne({name:"ConditionNodeConfig",__name:"ConditionNodeConfig",props:{conditionNode:{type:Object,required:!0},nodeIndex:{type:Number,required:!0}},setup(M,{expose:K}){const j=gl(),R=M,v=G(!1),n=G(R.conditionNode),u=G();_l(()=>R.conditionNode,k=>{n.value=k});const S=G(!1);K({open:()=>{u.value=n.value.conditionSetting,v.value=!0}});const T=()=>{v.value=!1},y=async k=>{await N()?k():k(!0)},U=G(),N=async()=>{var k,d,b,C,p;if(!((k=n.value.conditionSetting)!=null&&k.defaultFlow)){if(!await U.value.validate())return!1;const V=_();if(!V)return!1;n.value.showText=V,n.value.conditionSetting.conditionType=(d=u.value)==null?void 0:d.conditionType,((b=n.value.conditionSetting)==null?void 0:b.conditionType)===ve.EXPRESSION&&(n.value.conditionSetting.conditionGroups=void 0,n.value.conditionSetting.conditionExpression=(C=u.value)==null?void 0:C.conditionExpression),n.value.conditionSetting.conditionType===ve.RULE&&(n.value.conditionSetting.conditionExpression=void 0,n.value.conditionSetting.conditionGroups=(p=u.value)==null?void 0:p.conditionGroups)}return v.value=!1,!0},_=()=>{var d,b,C,p;let k="";if(((d=u.value)==null?void 0:d.conditionType)===ve.EXPRESSION&&u.value.conditionExpression&&(k=`\u8868\u8FBE\u5F0F\uFF1A${u.value.conditionExpression}`),((b=u.value)==null?void 0:b.conditionType)===ve.RULE){const V=(C=u.value.conditionGroups)==null?void 0:C.and;let D;const z=(p=u.value.conditionGroups)==null?void 0:p.conditions.map(x=>"("+x.rules.map(I=>I.leftSide&&I.rightSide?h(I.leftSide)+" "+g(I.opCode)+" "+I.rightSide:(D="\u8BF7\u5B8C\u5584\u6761\u4EF6\u89C4\u5219","")).join(x.and?" \u4E14 ":" \u6216 ")+" ) ");D?(j.warning(D),k=""):k=z.join(V?" \u4E14 ":" \u6216 ")}return k},s=ql(),h=k=>{const d=s.find(b=>b.field===k);return d==null?void 0:d.title},g=k=>{const d=Ql.find(b=>b.value===k);return d==null?void 0:d.label};return(k,d)=>{const b=ie,C=xe,p=Ee,V=$e,D=me("mountedFocus");return l(),f(V,{"append-to-body":!0,modelValue:e(v),"onUpdate:modelValue":d[4]||(d[4]=z=>ae(v)?v.value=z:null),"show-close":!1,size:588,"before-close":y},{header:o(()=>[t("div",ko,[e(S)?ce((l(),r("input",{key:0,type:"text",class:"config-editable-input",onBlur:d[0]||(d[0]=z=>{var x,I;return S.value=!1,void(n.value.name=n.value.name||ea(R.nodeIndex,(I=(x=n.value)==null?void 0:x.conditionSetting)==null?void 0:I.defaultFlow))}),"onUpdate:modelValue":d[1]||(d[1]=z=>e(n).name=z),placeholder:e(n).name},null,40,Eo)),[[D],[pe,e(n).name]]):(l(),r("div",To,[F(P(e(n).name)+" ",1),a(b,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:d[2]||(d[2]=z=>{S.value=!0})})])),d[5]||(d[5]=t("div",{class:"divide-line"},null,-1))])]),footer:o(()=>[a(C),t("div",null,[a(p,{type:"primary",onClick:N},{default:o(()=>d[6]||(d[6]=[F("\u786E \u5B9A")])),_:1}),a(p,{onClick:T},{default:o(()=>d[7]||(d[7]=[F("\u53D6 \u6D88")])),_:1})])]),default:o(()=>{var z;return[t("div",null,[(z=e(n).conditionSetting)!=null&&z.defaultFlow?(l(),r("div",wo,"\u672A\u6EE1\u8DB3\u5176\u5B83\u6761\u4EF6\u65F6\uFF0C\u5C06\u8FDB\u5165\u6B64\u5206\u652F\uFF08\u8BE5\u5206\u652F\u4E0D\u53EF\u7F16\u8F91\u548C\u5220\u9664\uFF09")):(l(),r("div",Vo,[a(oa,{ref_key:"conditionRef",ref:U,modelValue:e(u),"onUpdate:modelValue":d[3]||(d[3]=x=>ae(u)?u.value=x:null)},null,8,["modelValue"])]))])]}),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-94dd5b59"]]),Uo={class:"branch-node-wrapper"},So={class:"branch-node-container"},Ro={class:"node-wrapper"},Co={class:"node-container"},Do={class:"branch-node-title-container"},xo={key:0},Oo=["onBlur","onUpdate:modelValue"],Io=["onClick"],Ao={class:"branch-priority"},Lo=["onClick"],Fo=["title"],Po={key:1,class:"branch-node-text"},Ho={key:0,class:"node-toolbar"},qo={class:"toolbar-icon"},Mo=["onClick"],Bo=["onClick"],zo=ne({name:"ExclusiveNode",__name:"ExclusiveNode",props:{flowNode:{type:Object,required:!0}},emits:["update:modelValue","find:parentNode","find:recursiveFindParentNode"],setup(M,{emit:K}){const{proxy:j}=Il(),R=M,v=K,n=re("readonly"),u=G(R.flowNode);_l(()=>R.flowNode,N=>{u.value=N});const S=G([]),T=()=>{const N=u.value.conditionNodes;if(N){const _=N.length;let s=_-1;const h={id:"Flow_"+ue(),name:"\u6761\u4EF6"+_,showText:"",type:w.CONDITION_NODE,childNode:void 0,conditionNodes:[],conditionSetting:{defaultFlow:!1,conditionType:ve.RULE,conditionGroups:nl}};N.splice(s,0,h)}},y=(N,_)=>{u.value.conditionNodes&&(u.value.conditionNodes[N]=u.value.conditionNodes.splice(N+_,1,u.value.conditionNodes[N])[0])},U=(N,_,s)=>{_&&_.type!==w.START_USER_NODE&&(_.type===s&&N.push(_),v("find:parentNode",N,s))};return(N,_)=>{var k;const s=Ee,h=ie,g=me("mountedFocus");return l(),r("div",Uo,[t("div",So,[e(n)?(l(),r("div",{key:0,class:be(["branch-node-readonly",`${e(_e)((k=e(u))==null?void 0:k.activityStatus)}`])},_[1]||(_[1]=[t("span",{class:"iconfont icon-exclusive icon-size condition"},null,-1)]),2)):(l(),f(s,{key:1,class:"branch-node-add",color:"#67c23a",onClick:T,plain:""},{default:o(()=>_[2]||(_[2]=[F("\u6DFB\u52A0\u6761\u4EF6")])),_:1})),(l(!0),r(A,null,B(e(u).conditionNodes,(d,b)=>{var C,p,V;return l(),r("div",{class:"branch-node-item",key:b},[b==0?(l(),r(A,{key:0},[_[3]||(_[3]=t("div",{class:"branch-line-first-top"},null,-1)),_[4]||(_[4]=t("div",{class:"branch-line-first-bottom"},null,-1))],64)):E("",!0),b+1==((C=e(u).conditionNodes)==null?void 0:C.length)?(l(),r(A,{key:1},[_[5]||(_[5]=t("div",{class:"branch-line-last-top"},null,-1)),_[6]||(_[6]=t("div",{class:"branch-line-last-bottom"},null,-1))],64)):E("",!0),t("div",Ro,[t("div",Co,[t("div",{class:be(["node-box",[{"node-config-error":!d.showText},`${e(_e)(d.activityStatus)}`]])},[t("div",Do,[!e(n)&&e(S)[b]?(l(),r("div",xo,[ce(t("input",{type:"text",class:"input-max-width editable-title-input",onBlur:D=>(z=>{var I,W;S.value[z]=!1;const x=(I=u.value.conditionNodes)==null?void 0:I.at(z);x.name=x.name||ea(z,(W=x.conditionSetting)==null?void 0:W.defaultFlow)})(b),"onUpdate:modelValue":D=>d.name=D},null,40,Oo),[[g],[pe,d.name]])])):(l(),r("div",{key:1,class:"branch-title",onClick:D=>(z=>{S.value[z]=!0})(b)},P(d.name),9,Io)),t("div",Ao," \u4F18\u5148\u7EA7"+P(b+1),1)]),t("div",{class:"branch-node-content",onClick:D=>(z=>{n||j.$refs[z][0].open()})(d.id)},[d.showText?(l(),r("div",{key:0,class:"branch-node-text",title:d.showText},P(d.showText),9,Fo)):(l(),r("div",Po,P(e(Se).get(e(w).CONDITION_NODE)),1))],8,Lo),e(n)||b+1===((p=e(u).conditionNodes)==null?void 0:p.length)?E("",!0):(l(),r("div",Ho,[t("div",qo,[a(h,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:D=>(z=>{const x=u.value.conditionNodes;if(x&&(x.splice(z,1),x.length==1)){const I=u.value.childNode;v("update:modelValue",I)}})(b)},null,8,["onClick"])])])),b!=0&&b+1!==((V=e(u).conditionNodes)==null?void 0:V.length)?(l(),r("div",{key:1,class:"branch-node-move move-node-left",onClick:D=>y(b,-1)},[a(h,{icon:"ep:arrow-left"})],8,Mo)):E("",!0),e(u).conditionNodes&&b<e(u).conditionNodes.length-2?(l(),r("div",{key:2,class:"branch-node-move move-node-right",onClick:D=>y(b,1)},[a(h,{icon:"ep:arrow-right"})],8,Bo)):E("",!0)],2),a(Te,{"child-node":d.childNode,"onUpdate:childNode":D=>d.childNode=D,"current-node":d},null,8,["child-node","onUpdate:childNode","current-node"])])]),a(na,{"node-index":b,"condition-node":d,ref_for:!0,ref:d.id},null,8,["node-index","condition-node"]),d&&d.childNode?(l(),f(Nl,{key:2,"parent-node":d,"flow-node":d.childNode,"onUpdate:flowNode":D=>d.childNode=D,"onFind:recursiveFindParentNode":U},null,8,["parent-node","flow-node","onUpdate:flowNode"])):E("",!0)])}),128))]),e(u)?(l(),f(Te,{key:0,"child-node":e(u).childNode,"onUpdate:childNode":_[0]||(_[0]=d=>e(u).childNode=d),"current-node":e(u)},null,8,["child-node","current-node"])):E("",!0)])}}}),Go={class:"branch-node-wrapper"},$o={class:"branch-node-container"},jo={class:"node-wrapper"},Yo={class:"node-container"},Ko={class:"branch-node-title-container"},Xo={key:0},Wo=["onBlur","onUpdate:modelValue"],Qo=["onClick"],Jo=["onClick"],Zo=["title"],en={key:1,class:"branch-node-text"},ln={key:0,class:"node-toolbar"},an={class:"toolbar-icon"},tn=ne({name:"ParallelNode",__name:"ParallelNode",props:{flowNode:{type:Object,required:!0}},emits:["update:modelValue","find:parentNode","find:recursiveFindParentNode"],setup(M,{emit:K}){const{proxy:j}=Il(),R=M,v=K,n=G(R.flowNode),u=re("readonly");_l(()=>R.flowNode,U=>{n.value=U});const S=G([]),T=()=>{const U=n.value.conditionNodes;if(U){const N=U.length;let _=N-1;const s={id:"Flow_"+ue(),name:"\u5E76\u884C"+N,showText:"\u65E0\u9700\u914D\u7F6E\u6761\u4EF6\u540C\u65F6\u6267\u884C",type:w.CONDITION_NODE,childNode:void 0,conditionNodes:[]};U.splice(_,0,s)}},y=(U,N,_)=>{N&&N.type!==w.START_USER_NODE&&(N.type===_&&U.push(N),v("find:parentNode",U,_))};return(U,N)=>{var g;const _=Ee,s=ie,h=me("mountedFocus");return l(),r("div",Go,[t("div",$o,[e(u)?(l(),r("div",{key:0,class:be(["branch-node-readonly",`${e(_e)((g=e(n))==null?void 0:g.activityStatus)}`])},N[1]||(N[1]=[t("span",{class:"iconfont icon-parallel icon-size parallel"},null,-1)]),2)):(l(),f(_,{key:1,class:"branch-node-add",color:"#626aef",onClick:T,plain:""},{default:o(()=>N[2]||(N[2]=[F("\u6DFB\u52A0\u5206\u652F")])),_:1})),(l(!0),r(A,null,B(e(n).conditionNodes,(k,d)=>{var b;return l(),r("div",{class:"branch-node-item",key:d},[d==0?(l(),r(A,{key:0},[N[3]||(N[3]=t("div",{class:"branch-line-first-top"},null,-1)),N[4]||(N[4]=t("div",{class:"branch-line-first-bottom"},null,-1))],64)):E("",!0),d+1==((b=e(n).conditionNodes)==null?void 0:b.length)?(l(),r(A,{key:1},[N[5]||(N[5]=t("div",{class:"branch-line-last-top"},null,-1)),N[6]||(N[6]=t("div",{class:"branch-line-last-bottom"},null,-1))],64)):E("",!0),t("div",jo,[t("div",Yo,[t("div",{class:be(["node-box",`${e(_e)(k.activityStatus)}`])},[t("div",Ko,[e(S)[d]?(l(),r("div",Xo,[ce(t("input",{type:"text",class:"input-max-width editable-title-input",onBlur:C=>(p=>{var D;S.value[p]=!1;const V=(D=n.value.conditionNodes)==null?void 0:D.at(p);V.name=V.name||`\u5E76\u884C${p+1}`})(d),"onUpdate:modelValue":C=>k.name=C},null,40,Wo),[[h],[pe,k.name]])])):(l(),r("div",{key:1,class:"branch-title",onClick:C=>(p=>{S.value[p]=!0})(d)},P(k.name),9,Qo)),N[7]||(N[7]=t("div",{class:"branch-priority"},"\u65E0\u4F18\u5148\u7EA7",-1))]),t("div",{class:"branch-node-content",onClick:C=>{return p=k.id,void j.$refs[p][0].open();var p}},[k.showText?(l(),r("div",{key:0,class:"branch-node-text",title:k.showText},P(k.showText),9,Zo)):(l(),r("div",en,P(e(Se).get(e(w).CONDITION_NODE)),1))],8,Jo),e(u)?E("",!0):(l(),r("div",ln,[t("div",an,[a(s,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:C=>(p=>{const V=n.value.conditionNodes;if(V&&(V.splice(p,1),V.length==1)){const D=n.value.childNode;v("update:modelValue",D)}})(d)},null,8,["onClick"])])]))],2),a(Te,{"child-node":k.childNode,"onUpdate:childNode":C=>k.childNode=C,"current-node":k},null,8,["child-node","onUpdate:childNode","current-node"])])]),k&&k.childNode?(l(),f(Nl,{key:2,"parent-node":k,"flow-node":k.childNode,"onUpdate:flowNode":C=>k.childNode=C,"onFind:recursiveFindParentNode":y},null,8,["parent-node","flow-node","onUpdate:flowNode"])):E("",!0)])}),128))]),e(n)?(l(),f(Te,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":N[0]||(N[0]=k=>e(n).childNode=k),"current-node":e(n)},null,8,["child-node","current-node"])):E("",!0)])}}}),on={class:"branch-node-wrapper"},nn={class:"branch-node-container"},dn={class:"node-wrapper"},sn={class:"node-container"},rn={class:"branch-node-title-container"},un={key:0},cn=["onBlur","onUpdate:modelValue"],pn=["onClick"],mn=["onClick"],vn=["title"],fn={key:1,class:"branch-node-text"},yn={key:0,class:"node-toolbar"},gn={class:"toolbar-icon"},hn=["onClick"],bn=["onClick"],_n=ne({name:"InclusiveNode",__name:"InclusiveNode",props:{flowNode:{type:Object,required:!0}},emits:["update:modelValue","find:parentNode","find:recursiveFindParentNode"],setup(M,{emit:K}){const{proxy:j}=Il(),R=M,v=K,n=re("readonly"),u=G(R.flowNode);_l(()=>R.flowNode,N=>{u.value=N});const S=G([]),T=()=>{const N=u.value.conditionNodes;if(N){const _=N.length;let s=_-1;const h={id:"Flow_"+ue(),name:"\u5305\u5BB9\u6761\u4EF6"+_,showText:"",type:w.CONDITION_NODE,childNode:void 0,conditionNodes:[],conditionSetting:{defaultFlow:!1,conditionType:ve.RULE,conditionGroups:nl}};N.splice(s,0,h)}},y=(N,_)=>{u.value.conditionNodes&&(u.value.conditionNodes[N]=u.value.conditionNodes.splice(N+_,1,u.value.conditionNodes[N])[0])},U=(N,_,s)=>{_&&_.type!==w.START_USER_NODE&&(_.type===s&&N.push(_),v("find:parentNode",N,s))};return(N,_)=>{var k;const s=Ee,h=ie,g=me("mountedFocus");return l(),r("div",on,[t("div",nn,[e(n)?(l(),r("div",{key:0,class:be(["branch-node-readonly",`${e(_e)((k=e(u))==null?void 0:k.activityStatus)}`])},_[1]||(_[1]=[t("span",{class:"iconfont icon-inclusive icon-size inclusive"},null,-1)]),2)):(l(),f(s,{key:1,class:"branch-node-add",color:"#345da2",onClick:T,plain:""},{default:o(()=>_[2]||(_[2]=[F("\u6DFB\u52A0\u6761\u4EF6")])),_:1})),(l(!0),r(A,null,B(e(u).conditionNodes,(d,b)=>{var C,p,V;return l(),r("div",{class:"branch-node-item",key:b},[b==0?(l(),r(A,{key:0},[_[3]||(_[3]=t("div",{class:"branch-line-first-top"},null,-1)),_[4]||(_[4]=t("div",{class:"branch-line-first-bottom"},null,-1))],64)):E("",!0),b+1==((C=e(u).conditionNodes)==null?void 0:C.length)?(l(),r(A,{key:1},[_[5]||(_[5]=t("div",{class:"branch-line-last-top"},null,-1)),_[6]||(_[6]=t("div",{class:"branch-line-last-bottom"},null,-1))],64)):E("",!0),t("div",dn,[t("div",sn,[t("div",{class:be(["node-box",[{"node-config-error":!d.showText},`${e(_e)(d.activityStatus)}`]])},[t("div",rn,[!e(n)&&e(S)[b]?(l(),r("div",un,[ce(t("input",{type:"text",class:"editable-title-input",onBlur:D=>(z=>{var I,W;S.value[z]=!1;const x=(I=u.value.conditionNodes)==null?void 0:I.at(z);x.name=x.name||Aa(z,(W=x.conditionSetting)==null?void 0:W.defaultFlow)})(b),"onUpdate:modelValue":D=>d.name=D},null,40,cn),[[g],[pe,d.name]])])):(l(),r("div",{key:1,class:"branch-title",onClick:D=>(z=>{S.value[z]=!0})(b)},P(d.name),9,pn))]),t("div",{class:"branch-node-content",onClick:D=>(z=>{n||j.$refs[z][0].open()})(d.id)},[d.showText?(l(),r("div",{key:0,class:"branch-node-text",title:d.showText},P(d.showText),9,vn)):(l(),r("div",fn,P(e(Se).get(e(w).CONDITION_NODE)),1))],8,mn),e(n)||b+1===((p=e(u).conditionNodes)==null?void 0:p.length)?E("",!0):(l(),r("div",yn,[t("div",gn,[a(h,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:D=>(z=>{const x=u.value.conditionNodes;if(x&&(x.splice(z,1),x.length==1)){const I=u.value.childNode;v("update:modelValue",I)}})(b)},null,8,["onClick"])])])),e(n)||b==0||b+1===((V=e(u).conditionNodes)==null?void 0:V.length)?E("",!0):(l(),r("div",{key:1,class:"branch-node-move move-node-left",onClick:D=>y(b,-1)},[a(h,{icon:"ep:arrow-left"})],8,hn)),!e(n)&&e(u).conditionNodes&&b<e(u).conditionNodes.length-2?(l(),r("div",{key:2,class:"branch-node-move move-node-right",onClick:D=>y(b,1)},[a(h,{icon:"ep:arrow-right"})],8,bn)):E("",!0)],2),a(Te,{"child-node":d.childNode,"onUpdate:childNode":D=>d.childNode=D,"current-node":d},null,8,["child-node","onUpdate:childNode","current-node"])])]),a(na,{"node-index":b,"condition-node":d,ref_for:!0,ref:d.id},null,8,["node-index","condition-node"]),d&&d.childNode?(l(),f(Nl,{key:2,"parent-node":d,"flow-node":d.childNode,"onUpdate:flowNode":D=>d.childNode=D,"onFind:recursiveFindParentNode":U},null,8,["parent-node","flow-node","onUpdate:flowNode"])):E("",!0)])}),128))]),e(u)?(l(),f(Te,{key:0,"child-node":e(u).childNode,"onUpdate:childNode":_[0]||(_[0]=d=>e(u).childNode=d),"current-node":e(u)},null,8,["child-node","current-node"])):E("",!0)])}}}),Nn={class:"config-header"},kn=["placeholder"],En={key:1,class:"node-name"},Tn=ne({name:"DelayTimerNodeConfig",__name:"DelayTimerNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(M,{expose:K}){const j=M,{settingVisible:R,closeDrawer:v,openDrawer:n}=Qe(),u=fe(j),{nodeName:S,showInput:T,clickIcon:y,blurEvent:U}=Je(w.DELAY_TIMER_NODE),N=G(),_=tl({delayType:[{required:!0,message:"\u5EF6\u8FDF\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],timeDuration:[{required:!0,message:"\u5EF6\u8FDF\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],dateTime:[{required:!0,message:"\u5EF6\u8FDF\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}]}),s=G({delayType:De.FIXED_TIME_DURATION,timeDuration:1,timeUnit:we.HOUR,dateTime:""}),h=async()=>{if(!N||!await N.value.validate())return!1;const d=g();return!!d&&(u.value.name=S.value,u.value.showText=d,s.value.delayType===De.FIXED_TIME_DURATION&&(u.value.delaySetting={delayType:s.value.delayType,delayTime:k()}),s.value.delayType===De.FIXED_DATE_TIME&&(u.value.delaySetting={delayType:s.value.delayType,delayTime:s.value.dateTime}),R.value=!1,!0)},g=()=>{let d="";return s.value.delayType===De.FIXED_TIME_DURATION&&(d=`\u5EF6\u8FDF${s.value.timeDuration}${Pl.find(b=>b.value===s.value.timeUnit).label}`),s.value.delayType===De.FIXED_DATE_TIME&&(d=`\u5EF6\u8FDF\u81F3${s.value.dateTime.replace("T"," ")}`),d},k=()=>{let d="PT";return s.value.timeUnit===we.MINUTE&&(d+=s.value.timeDuration+"M"),s.value.timeUnit===we.HOUR&&(d+=s.value.timeDuration+"H"),s.value.timeUnit===we.DAY&&(d+=s.value.timeDuration+"D"),d};return K({openDrawer:n,showDelayTimerNodeConfig:d=>{if(S.value=d.name,d.delaySetting){if(s.value.delayType=d.delaySetting.delayType,s.value.delayType===De.FIXED_TIME_DURATION){const b=d.delaySetting.delayTime;let C=b.slice(2,b.length-1),p=b.slice(b.length-1);s.value.timeDuration=parseInt(C),s.value.timeUnit=Zl(p)}s.value.delayType===De.FIXED_DATE_TIME&&(s.value.dateTime=d.delaySetting.delayTime)}}}),(d,b)=>{const C=ie,p=Gl,V=ll,D=He,z=zl,x=qe,I=Me,W=hl,X=ca,Z=Be,Q=xe,L=Ee,Ne=$e,q=me("mountedFocus");return l(),f(Ne,{"append-to-body":!0,modelValue:e(R),"onUpdate:modelValue":b[7]||(b[7]=Y=>ae(R)?R.value=Y:null),"show-close":!1,size:550,"before-close":h},{header:o(()=>[t("div",Nn,[e(T)?ce((l(),r("input",{key:0,type:"text",class:"config-editable-input",onBlur:b[0]||(b[0]=Y=>e(U)()),"onUpdate:modelValue":b[1]||(b[1]=Y=>ae(S)?S.value=Y:null),placeholder:e(S)},null,40,kn)),[[q],[pe,e(S)]]):(l(),r("div",En,[F(P(e(S))+" ",1),a(C,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:b[2]||(b[2]=Y=>e(y)())})])),b[8]||(b[8]=t("div",{class:"divide-line"},null,-1))])]),footer:o(()=>[a(Q),t("div",null,[a(L,{type:"primary",onClick:h},{default:o(()=>b[11]||(b[11]=[F("\u786E \u5B9A")])),_:1}),a(L,{onClick:e(v)},{default:o(()=>b[12]||(b[12]=[F("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:o(()=>[t("div",null,[a(Z,{ref_key:"formRef",ref:N,model:e(s),"label-position":"top",rules:e(_)},{default:o(()=>[a(D,{label:"\u5EF6\u8FDF\u65F6\u95F4",prop:"delayType"},{default:o(()=>[a(V,{modelValue:e(s).delayType,"onUpdate:modelValue":b[3]||(b[3]=Y=>e(s).delayType=Y)},{default:o(()=>[(l(!0),r(A,null,B(e(xa),Y=>(l(),f(p,{key:Y.value,label:Y.label,value:Y.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s).delayType===e(De).FIXED_TIME_DURATION?(l(),f(D,{key:0},{default:o(()=>[a(D,{prop:"timeDuration"},{default:o(()=>[a(z,{class:"mr-2",style:{width:"100px"},modelValue:e(s).timeDuration,"onUpdate:modelValue":b[4]||(b[4]=Y=>e(s).timeDuration=Y),min:1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(I,{modelValue:e(s).timeUnit,"onUpdate:modelValue":b[5]||(b[5]=Y=>e(s).timeUnit=Y),class:"mr-2",style:{width:"100px"}},{default:o(()=>[(l(!0),r(A,null,B(e(Pl),Y=>(l(),f(x,{key:Y.value,label:Y.label,value:Y.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(W,null,{default:o(()=>b[9]||(b[9]=[F("\u540E\u8FDB\u5165\u4E0B\u4E00\u8282\u70B9")])),_:1})]),_:1})):E("",!0),e(s).delayType===e(De).FIXED_DATE_TIME?(l(),f(D,{key:1,prop:"dateTime"},{default:o(()=>[a(X,{class:"mr-2",modelValue:e(s).dateTime,"onUpdate:modelValue":b[6]||(b[6]=Y=>e(s).dateTime=Y),type:"datetime",placeholder:"\u8BF7\u9009\u62E9\u65E5\u671F\u548C\u65F6\u95F4","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"]),a(W,null,{default:o(()=>b[10]||(b[10]=[F("\u540E\u8FDB\u5165\u4E0B\u4E00\u8282\u70B9")])),_:1})]),_:1})):E("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}}),wn={class:"node-wrapper"},Vn={class:"node-container"},Un={class:"node-title-container"},Sn=["placeholder"],Rn=["title"],Cn={key:1,class:"node-text"},Dn={key:0,class:"node-toolbar"},xn={class:"toolbar-icon"},On=ne({name:"DelayTimerNode",__name:"DelayTimerNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(M,{emit:K}){const j=M,R=K,v=re("readonly"),n=fe(j),{showInput:u,blurEvent:S,clickTitle:T}=Ze(n,w.DELAY_TIMER_NODE),y=G(),U=()=>{v||(y.value.showDelayTimerNodeConfig(n.value),y.value.openDrawer())},N=()=>{R("update:flowNode",n.value.childNode)};return(_,s)=>{var k;const h=ie,g=me("mountedFocus");return l(),r("div",wn,[t("div",Vn,[t("div",{class:be(["node-box",[{"node-config-error":!e(n).showText},`${e(_e)((k=e(n))==null?void 0:k.activityStatus)}`]])},[t("div",Un,[s[4]||(s[4]=t("div",{class:"node-title-icon delay-node"},[t("span",{class:"iconfont icon-delay"})],-1)),!e(v)&&e(u)?ce((l(),r("input",{key:0,type:"text",class:"editable-title-input",onBlur:s[0]||(s[0]=d=>e(S)()),"onUpdate:modelValue":s[1]||(s[1]=d=>e(n).name=d),placeholder:e(n).name},null,40,Sn)),[[g],[pe,e(n).name]]):(l(),r("div",{key:1,class:"node-title",onClick:s[2]||(s[2]=(...d)=>e(T)&&e(T)(...d))},P(e(n).name),1))]),t("div",{class:"node-content",onClick:U},[e(n).showText?(l(),r("div",{key:0,class:"node-text",title:e(n).showText},P(e(n).showText),9,Rn)):(l(),r("div",Cn,P(e(Se).get(e(w).DELAY_TIMER_NODE)),1)),e(v)?E("",!0):(l(),f(h,{key:2,icon:"ep:arrow-right-bold"}))]),e(v)?E("",!0):(l(),r("div",Dn,[t("div",xn,[a(h,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),f(Te,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":s[3]||(s[3]=d=>e(n).childNode=d),"current-node":e(n)},null,8,["child-node","current-node"])):E("",!0)]),!e(v)&&e(n)?(l(),f(Tn,{key:0,ref_key:"nodeSetting",ref:y,"flow-node":e(n)},null,8,["flow-node"])):E("",!0)])}}}),In={class:"config-header"},An=["placeholder"],Ln={key:1,class:"node-name"},Fn={class:"flex flex-items-center"},Pn=ne({name:"RouterNodeConfig",__name:"RouterNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(M,{expose:K}){const j=gl(),R=M,v=re("processNodeTree"),{settingVisible:n,closeDrawer:u,openDrawer:S}=Qe(),T=fe(R),{nodeName:y,showInput:U,clickIcon:N,blurEvent:_}=Je(w.ROUTER_BRANCH_NODE),s=G([]),h=G([]),g=G([]),k=async()=>{let p=!0;for(const D of g.value)D&&!await D.validate()&&(p=!1);if(!p)return!1;const V=d();return!!V&&(T.value.name=y.value,T.value.showText=V,T.value.routerGroups=s.value,n.value=!1,!0)},d=()=>{if(!s.value||!Array.isArray(s.value)||s.value.length<=0)return j.warning("\u8BF7\u914D\u7F6E\u8DEF\u7531\uFF01"),"";for(const p of s.value){if(!p.nodeId||!p.conditionType||p.conditionType===ve.EXPRESSION&&!p.conditionExpression)return j.warning("\u8BF7\u5B8C\u5584\u8DEF\u7531\u914D\u7F6E\u9879\uFF01"),"";if(p.conditionType===ve.RULE){for(const V of p.conditionGroups.conditions)for(const D of V.rules)if(!D.leftSide||!D.rightSide)return j.warning("\u8BF7\u5B8C\u5584\u8DEF\u7531\u914D\u7F6E\u9879\uFF01"),""}}return`${s.value.length}\u6761\u8DEF\u7531\u5206\u652F`},b=()=>{s.value.push({nodeId:"",conditionType:ve.RULE,conditionExpression:"",conditionGroups:{and:!0,conditions:[{and:!0,rules:[{opCode:"==",leftSide:"",rightSide:""}]}]}})},C=p=>{for(;p&&(p.type!==w.ROUTER_BRANCH_NODE&&p.type!==w.CONDITION_NODE&&h.value.push({label:p.name,value:p.id}),p.childNode&&p.type!==w.END_EVENT_NODE);)p.conditionNodes&&p.conditionNodes.length&&p.conditionNodes.forEach(V=>{C(V)}),p=p.childNode};return K({openDrawer:S,showRouteNodeConfig:p=>{C(v==null?void 0:v.value),s.value=[],y.value=p.name,p.routerGroups&&(s.value=p.routerGroups)}}),(p,V)=>{const D=ie,z=hl,x=qe,I=Me,W=Ee,X=$l,Z=Be,Q=xe,L=$e,Ne=me("mountedFocus");return l(),f(L,{"append-to-body":!0,modelValue:e(n),"onUpdate:modelValue":V[3]||(V[3]=q=>ae(n)?n.value=q:null),"show-close":!1,size:630,"before-close":k},{header:o(()=>[t("div",In,[e(U)?ce((l(),r("input",{key:0,type:"text",class:"config-editable-input",onBlur:V[0]||(V[0]=q=>e(_)()),"onUpdate:modelValue":V[1]||(V[1]=q=>ae(y)?y.value=q:null),placeholder:e(y)},null,40,An)),[[Ne],[pe,e(y)]]):(l(),r("div",Ln,[F(P(e(y))+" ",1),a(D,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:V[2]||(V[2]=q=>e(N)())})])),V[4]||(V[4]=t("div",{class:"divide-line"},null,-1))])]),footer:o(()=>[a(Q),t("div",null,[a(W,{type:"primary",onClick:k},{default:o(()=>V[7]||(V[7]=[F("\u786E \u5B9A")])),_:1}),a(W,{onClick:e(u)},{default:o(()=>V[8]||(V[8]=[F("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:o(()=>[t("div",null,[a(Z,{"label-position":"top"},{default:o(()=>[(l(!0),r(A,null,B(e(s),(q,Y)=>(l(),f(X,{class:"mb-15px",key:Y},{header:o(()=>[t("div",Fn,[a(z,{size:"large"},{default:o(()=>[F("\u8DEF\u7531"+P(Y+1),1)]),_:2},1024),a(I,{class:"ml-15px",modelValue:q.nodeId,"onUpdate:modelValue":$=>q.nodeId=$,style:{width:"180px"}},{default:o(()=>[(l(!0),r(A,null,B(e(h),$=>(l(),f(x,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(W,{class:"mla",type:"danger",link:"",onClick:$=>(H=>{s.value.splice(H,1)})(Y)},{default:o(()=>V[5]||(V[5]=[F(" \u5220\u9664 ")])),_:2},1032,["onClick"])])]),default:o(()=>[a(oa,{ref_for:!0,ref:$=>e(g)[Y]=$,modelValue:e(s)[Y],"onUpdate:modelValue":$=>e(s)[Y]=$},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1}),a(W,{class:"w-1/1",type:"primary",icon:e(pa),onClick:b},{default:o(()=>V[6]||(V[6]=[F(" \u65B0\u589E\u8DEF\u7531\u5206\u652F ")])),_:1},8,["icon"])])]),_:1},8,["modelValue"])}}}),Hn={class:"node-wrapper"},qn={class:"node-container"},Mn={class:"node-title-container"},Bn=["placeholder"],zn=["title"],Gn={key:1,class:"node-text"},$n={key:0,class:"node-toolbar"},jn={class:"toolbar-icon"},Yn=ne({name:"RouterNode",__name:"RouterNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(M,{emit:K}){const j=M,R=K,v=re("readonly"),n=fe(j),{showInput:u,blurEvent:S,clickTitle:T}=Ze(n,w.ROUTER_BRANCH_NODE),y=G(),U=()=>{v||(y.value.showRouteNodeConfig(n.value),y.value.openDrawer())},N=()=>{R("update:flowNode",n.value.childNode)};return(_,s)=>{var k;const h=ie,g=me("mountedFocus");return l(),r("div",Hn,[t("div",qn,[t("div",{class:be(["node-box",[{"node-config-error":!e(n).showText},`${e(_e)((k=e(n))==null?void 0:k.activityStatus)}`]])},[t("div",Mn,[s[4]||(s[4]=t("div",{class:"node-title-icon router-node"},[t("span",{class:"iconfont icon-router"})],-1)),!e(v)&&e(u)?ce((l(),r("input",{key:0,type:"text",class:"editable-title-input",onBlur:s[0]||(s[0]=d=>e(S)()),"onUpdate:modelValue":s[1]||(s[1]=d=>e(n).name=d),placeholder:e(n).name},null,40,Bn)),[[g],[pe,e(n).name]]):(l(),r("div",{key:1,class:"node-title",onClick:s[2]||(s[2]=(...d)=>e(T)&&e(T)(...d))},P(e(n).name),1))]),t("div",{class:"node-content",onClick:U},[e(n).showText?(l(),r("div",{key:0,class:"node-text",title:e(n).showText},P(e(n).showText),9,zn)):(l(),r("div",Gn,P(e(Se).get(e(w).ROUTER_BRANCH_NODE)),1)),e(v)?E("",!0):(l(),f(h,{key:2,icon:"ep:arrow-right-bold"}))]),e(v)?E("",!0):(l(),r("div",$n,[t("div",jn,[a(h,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),f(Te,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":s[3]||(s[3]=d=>e(n).childNode=d),"current-node":e(n)},null,8,["child-node","current-node"])):E("",!0)]),!e(v)&&e(n)?(l(),f(Pn,{key:0,ref_key:"nodeSetting",ref:y,"flow-node":e(n)},null,8,["flow-node"])):E("",!0)])}}}),Kn={class:"config-header"},Xn=["placeholder"],Wn={key:1,class:"node-name"},Qn={key:0},Jn={class:"mr-2"},Zn={class:"mr-2"},ed={class:"mr-1 pt-1 cursor-pointer"},ld={key:1},ad={class:"mr-2 flex items-center"},td={class:"mx-2"},od={class:"mr-2"},nd={class:"mr-1 pt-1 cursor-pointer"},dd=ne({name:"TriggerNodeConfig",__name:"TriggerNodeConfig",props:{flowNode:{type:Object,required:!0}},setup(M,{expose:K}){const j=M,R=gl(),{settingVisible:v,closeDrawer:n,openDrawer:u}=Qe(),S=fe(j),{nodeName:T,showInput:y,clickIcon:U,blurEvent:N}=Je(w.TRIGGER_NODE),_=G(),s=tl({type:[{required:!0,message:"\u89E6\u53D1\u5668\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],"httpRequestSetting.url":[{required:!0,message:"\u8BF7\u6C42\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),h=G({type:Ge.HTTP_REQUEST,httpRequestSetting:{url:"",header:[],body:[],response:[]},normalFormSetting:{updateFormFields:{}}}),g=La(),k=ye(()=>{var p;const C=Object.keys(((p=h.value.normalFormSetting)==null?void 0:p.updateFormFields)||{});return g.map(V=>({title:V.title,field:V.field,disabled:C.includes(V.field)}))}),d=async()=>{if(!_||!await _.value.validate())return!1;const C=b();return!!C&&(S.value.name=T.value,S.value.showText=C,h.value.type===Ge.HTTP_REQUEST&&(h.value.normalFormSetting=void 0),h.value.type===Ge.UPDATE_NORMAL_FORM&&(h.value.httpRequestSetting=void 0),S.value.triggerSetting=h.value,v.value=!1,!0)},b=()=>{var p,V;let C="";return h.value.type===Ge.HTTP_REQUEST?C=`${(p=h.value.httpRequestSetting)==null?void 0:p.url}`:h.value.type===Ge.UPDATE_NORMAL_FORM&&(Object.keys(((V=h.value.normalFormSetting)==null?void 0:V.updateFormFields)||{}).length===0?R.warning("\u8BF7\u8BBE\u7F6E\u4FEE\u6539\u8868\u5355\u5B57\u6BB5"):C="\u4FEE\u6539\u8868\u5355\u6570\u636E"),C};return K({openDrawer:u,showTriggerNodeConfig:C=>{T.value=C.name,C.triggerSetting&&(h.value={type:C.triggerSetting.type,httpRequestSetting:C.triggerSetting.httpRequestSetting||{url:"",header:[],body:[],response:[]},normalFormSetting:C.triggerSetting.normalFormSetting||{updateFormFields:{}}})}}),(C,p)=>{const V=ie,D=qe,z=Me,x=He,I=Bl,W=We,X=Ee,Z=xe,Q=Be,L=$e,Ne=me("mountedFocus");return l(),f(L,{"append-to-body":!0,modelValue:e(v),"onUpdate:modelValue":p[7]||(p[7]=q=>ae(v)?v.value=q:null),"show-close":!1,size:550,"before-close":d},{header:o(()=>[t("div",Kn,[e(y)?ce((l(),r("input",{key:0,type:"text",class:"config-editable-input",onBlur:p[0]||(p[0]=q=>e(N)()),"onUpdate:modelValue":p[1]||(p[1]=q=>ae(T)?T.value=q:null),placeholder:e(T)},null,40,Xn)),[[Ne],[pe,e(T)]]):(l(),r("div",Wn,[F(P(e(T))+" ",1),a(V,{class:"ml-1",icon:"ep:edit-pen",size:16,onClick:p[2]||(p[2]=q=>e(U)())})])),p[8]||(p[8]=t("div",{class:"divide-line"},null,-1))])]),footer:o(()=>[a(Z),t("div",null,[a(X,{type:"primary",onClick:d},{default:o(()=>p[13]||(p[13]=[F("\u786E \u5B9A")])),_:1}),a(X,{onClick:e(n)},{default:o(()=>p[14]||(p[14]=[F("\u53D6 \u6D88")])),_:1},8,["onClick"])])]),default:o(()=>[t("div",null,[a(Q,{ref_key:"formRef",ref:_,model:e(h),"label-position":"top",rules:e(s)},{default:o(()=>[a(x,{label:"\u89E6\u53D1\u5668\u7C7B\u578B",prop:"type"},{default:o(()=>[a(z,{modelValue:e(h).type,"onUpdate:modelValue":p[3]||(p[3]=q=>e(h).type=q)},{default:o(()=>[(l(!0),r(A,null,B(e(Oa),(q,Y)=>(l(),f(D,{key:Y,value:q.value,label:q.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h).type===e(Ge).HTTP_REQUEST&&e(h).httpRequestSetting?(l(),r("div",Qn,[a(x,null,{default:o(()=>[a(I,{title:"\u4EC5\u652F\u6301 POST \u8BF7\u6C42\uFF0C\u4EE5\u8BF7\u6C42\u4F53\u65B9\u5F0F\u63A5\u6536\u53C2\u6570",type:"warning","show-icon":"",closable:!1})]),_:1}),a(x,{label:"\u8BF7\u6C42\u5730\u5740",prop:"httpRequestSetting.url"},{default:o(()=>[a(W,{modelValue:e(h).httpRequestSetting.url,"onUpdate:modelValue":p[4]||(p[4]=q=>e(h).httpRequestSetting.url=q)},null,8,["modelValue"])]),_:1}),a(ta,{header:e(h).httpRequestSetting.header,body:e(h).httpRequestSetting.body,bind:"httpRequestSetting"},null,8,["header","body"]),a(x,{label:"\u8FD4\u56DE\u503C"},{default:o(()=>[a(I,{title:"\u901A\u8FC7\u8BF7\u6C42\u8FD4\u56DE\u503C, \u53EF\u4EE5\u4FEE\u6539\u6D41\u7A0B\u8868\u5355\u7684\u503C",type:"warning","show-icon":"",closable:!1})]),_:1}),a(x,null,{default:o(()=>[(l(!0),r(A,null,B(e(h).httpRequestSetting.response,(q,Y)=>(l(),r("div",{class:"flex pt-2",key:Y},[t("div",Jn,[a(x,{prop:`httpRequestSetting.response.${Y}.key`,rules:{required:!0,message:"\u8868\u5355\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[a(z,{class:"w-160px!",modelValue:q.key,"onUpdate:modelValue":$=>q.key=$,placeholder:"\u8BF7\u9009\u62E9\u8868\u5355\u5B57\u6BB5"},{default:o(()=>[(l(!0),r(A,null,B(e(g),($,H)=>(l(),f(D,{key:H,label:$.title,value:$.field,disabled:!$.required},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),t("div",Zn,[a(x,{prop:`httpRequestSetting.response.${Y}.value`,rules:{required:!0,message:"\u8BF7\u6C42\u8FD4\u56DE\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[a(W,{class:"w-160px",modelValue:q.value,"onUpdate:modelValue":$=>q.value=$,placeholder:"\u8BF7\u6C42\u8FD4\u56DE\u5B57\u6BB5"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),t("div",ed,[a(V,{icon:"ep:delete",size:18,onClick:$=>((H,Oe)=>{H.splice(Oe,1)})(e(h).httpRequestSetting.response,Y)},null,8,["onClick"])])]))),128)),a(X,{type:"primary",text:"",onClick:p[5]||(p[5]=q=>{e(h).httpRequestSetting.response.push({key:"",value:""})})},{default:o(()=>[a(V,{icon:"ep:plus",class:"mr-5px"}),p[9]||(p[9]=F("\u6DFB\u52A0\u4E00\u884C "))]),_:1})]),_:1})])):E("",!0),e(h).type===e(Ge).UPDATE_NORMAL_FORM&&e(h).normalFormSetting?(l(),r("div",ld,[a(Z,{"content-position":"left"},{default:o(()=>p[10]||(p[10]=[F("\u4FEE\u6539\u8868\u5355\u8BBE\u7F6E")])),_:1}),(l(!0),r(A,null,B(Object.keys(e(h).normalFormSetting.updateFormFields),q=>(l(),r("div",{class:"flex items-center",key:q},[t("div",ad,[a(x,null,{default:o(()=>[a(z,{class:"w-160px!","model-value":q,"onUpdate:modelValue":Y=>(($,H)=>{var c;if(!((c=h.value.normalFormSetting)!=null&&c.updateFormFields))return;const Oe=h.value.normalFormSetting.updateFormFields[$];delete h.value.normalFormSetting.updateFormFields[$],h.value.normalFormSetting.updateFormFields[H]=Oe})(q,Y),placeholder:"\u8BF7\u9009\u62E9\u8868\u5355\u5B57\u6BB5",disabled:q!==""},{default:o(()=>[(l(!0),r(A,null,B(e(k),(Y,$)=>(l(),f(D,{key:$,label:Y.title,value:Y.field,disabled:Y.disabled},null,8,["label","value","disabled"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue","disabled"])]),_:2},1024)]),t("div",td,[a(x,null,{default:o(()=>p[11]||(p[11]=[F("\u7684\u503C\u8BBE\u7F6E\u4E3A")])),_:1})]),t("div",od,[a(x,{prop:`normalFormSetting.updateFormFields.${q}`,rules:{required:!0,message:"\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}},{default:o(()=>[a(W,{class:"w-160px",modelValue:e(h).normalFormSetting.updateFormFields[q],"onUpdate:modelValue":Y=>e(h).normalFormSetting.updateFormFields[q]=Y,placeholder:"\u8BF7\u8F93\u5165",disabled:!q},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),t("div",nd,[a(x,null,{default:o(()=>[a(V,{icon:"ep:delete",size:18,onClick:Y=>($=>{var H;(H=h.value.normalFormSetting)!=null&&H.updateFormFields&&delete h.value.normalFormSetting.updateFormFields[$]})(q)},null,8,["onClick"])]),_:2},1024)])]))),128)),a(X,{type:"primary",text:"",onClick:p[6]||(p[6]=q=>(h.value.normalFormSetting.updateFormFields===void 0&&(h.value.normalFormSetting.updateFormFields={}),void(h.value.normalFormSetting.updateFormFields[""]=void 0)))},{default:o(()=>[a(V,{icon:"ep:plus",class:"mr-5px"}),p[12]||(p[12]=F("\u6DFB\u52A0\u4FEE\u6539\u5B57\u6BB5 "))]),_:1})])):E("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}}),id={class:"node-wrapper"},sd={class:"node-container"},rd={class:"node-title-container"},ud=["placeholder"],cd=["title"],pd={key:1,class:"node-text"},md={key:0,class:"node-toolbar"},vd={class:"toolbar-icon"},fd=ne({name:"TriggerNode",__name:"TriggerNode",props:{flowNode:{type:Object,required:!0}},emits:["update:flowNode"],setup(M,{emit:K}){const j=M,R=K,v=re("readonly"),n=fe(j),{showInput:u,blurEvent:S,clickTitle:T}=Ze(n,w.TRIGGER_NODE),y=G(),U=()=>{v||(y.value.showTriggerNodeConfig(n.value),y.value.openDrawer())},N=()=>{R("update:flowNode",n.value.childNode)};return(_,s)=>{var k;const h=ie,g=me("mountedFocus");return l(),r("div",id,[t("div",sd,[t("div",{class:be(["node-box",[{"node-config-error":!e(n).showText},`${e(_e)((k=e(n))==null?void 0:k.activityStatus)}`]])},[t("div",rd,[s[4]||(s[4]=t("div",{class:"node-title-icon trigger-node"},[t("span",{class:"iconfont icon-trigger"})],-1)),!e(v)&&e(u)?ce((l(),r("input",{key:0,type:"text",class:"editable-title-input",onBlur:s[0]||(s[0]=d=>e(S)()),"onUpdate:modelValue":s[1]||(s[1]=d=>e(n).name=d),placeholder:e(n).name},null,40,ud)),[[g],[pe,e(n).name]]):(l(),r("div",{key:1,class:"node-title",onClick:s[2]||(s[2]=(...d)=>e(T)&&e(T)(...d))},P(e(n).name),1))]),t("div",{class:"node-content",onClick:U},[e(n).showText?(l(),r("div",{key:0,class:"node-text",title:e(n).showText},P(e(n).showText),9,cd)):(l(),r("div",pd,P(e(Se).get(e(w).TRIGGER_NODE)),1)),e(v)?E("",!0):(l(),f(h,{key:2,icon:"ep:arrow-right-bold"}))]),e(v)?E("",!0):(l(),r("div",md,[t("div",vd,[a(h,{color:"#0089ff",icon:"ep:circle-close-filled",size:18,onClick:N})])]))],2),e(n)?(l(),f(Te,{key:0,"child-node":e(n).childNode,"onUpdate:childNode":s[3]||(s[3]=d=>e(n).childNode=d),"current-node":e(n)},null,8,["child-node","current-node"])):E("",!0)]),!e(v)&&e(n)?(l(),f(dd,{key:0,ref_key:"nodeSetting",ref:y,"flow-node":e(n)},null,8,["flow-node"])):E("",!0)])}}}),Nl=ne({name:"ProcessNodeTree",__name:"ProcessNodeTree",props:{parentNode:{type:Object,default:()=>null},flowNode:{type:Object,default:()=>null}},emits:["update:flowNode","find:recursiveFindParentNode"],setup(M,{emit:K}){const j=M,R=K,v=fe(j),n=T=>{R("update:flowNode",T)},u=(T,y)=>{R("find:recursiveFindParentNode",T,j.parentNode,y)},S=(T,y,U)=>{y&&(y.type!==w.START_USER_NODE?(y.type===U&&T.push(y),R("find:recursiveFindParentNode",T,j.parentNode,U)):T.push(y))};return(T,y)=>{const U=ma("ProcessNodeTree",!0);return l(),r(A,null,[e(v)&&e(v).type===e(w).START_USER_NODE?(l(),f(nt,{key:0,"flow-node":e(v)},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).USER_TASK_NODE?(l(),f($t,{key:1,"flow-node":e(v),"onUpdate:flowNode":n,"onFind:parentNode":u},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).COPY_TASK_NODE?(l(),f(uo,{key:2,"flow-node":e(v),"onUpdate:flowNode":n},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).CONDITION_BRANCH_NODE?(l(),f(zo,{key:3,"flow-node":e(v),"onUpdate:modelValue":n,"onFind:parentNode":u},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).PARALLEL_BRANCH_NODE?(l(),f(tn,{key:4,"flow-node":e(v),"onUpdate:modelValue":n,"onFind:parentNode":u},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).INCLUSIVE_BRANCH_NODE?(l(),f(_n,{key:5,"flow-node":e(v),"onUpdate:modelValue":n,"onFind:parentNode":u},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).DELAY_TIMER_NODE?(l(),f(On,{key:6,"flow-node":e(v),"onUpdate:flowNode":n},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).ROUTER_BRANCH_NODE?(l(),f(Yn,{key:7,"flow-node":e(v),"onUpdate:flowNode":n},null,8,["flow-node"])):E("",!0),e(v)&&e(v).type===e(w).TRIGGER_NODE?(l(),f(fd,{key:8,"flow-node":e(v),"onUpdate:flowNode":n},null,8,["flow-node"])):E("",!0),e(v)&&e(v).childNode?(l(),f(U,{key:9,"flow-node":e(v).childNode,"onUpdate:flowNode":y[0]||(y[0]=N=>e(v).childNode=N),"parent-node":e(v),"onFind:recursiveFindParentNode":S},null,8,["flow-node","parent-node"])):E("",!0),e(v)&&e(v).type===e(w).END_EVENT_NODE?(l(),f(it,{key:10,"flow-node":e(v)},null,8,["flow-node"])):E("",!0)],64)}}}),yd={class:"simple-process-model-container position-relative"},gd={class:"position-absolute top-0px right-0px bg-#fff"},hd=ne({name:"SimpleProcessModel",__name:"SimpleProcessModel",props:{flowNode:{type:Object,required:!0},readonly:{type:Boolean,required:!1,default:!0}},emits:["save"],setup(M,{expose:K,emit:j}){const R=M,v=j,n=fe(R);va("readonly",R.readonly);let u=G(100);const S=G(!1);let T=[];const y=(h,g)=>{if(h){const{type:k,showText:d,conditionNodes:b}=h;if(k==w.END_EVENT_NODE)return;k==w.START_USER_NODE&&y(h.childNode,g),k!==w.USER_TASK_NODE&&k!==w.COPY_TASK_NODE&&k!==w.CONDITION_NODE||(d||g.push(h),y(h.childNode,g)),k!=w.CONDITION_BRANCH_NODE&&k!=w.PARALLEL_BRANCH_NODE&&k!=w.INCLUSIVE_BRANCH_NODE||(b==null||b.forEach(C=>{y(C,g)}),y(h.childNode,g))}};K({getCurrentFlowData:async()=>{try{return T=[],y(n.value,T),T.length>0?void(S.value=!0):n.value}catch{return}}});const U=()=>{Ha.json(new Blob([JSON.stringify(n.value)]),"model.json")},N=G(),_=()=>{N.value.click()},s=()=>{const h=N.value.files[0],g=new FileReader;g.readAsText(h),g.onload=function(){ba(this.result)&&(n.value=JSON.parse(this.result),v("save",n.value))}};return(h,g)=>{const k=ie,d=Ee,b=_a,C=al,p=da;return l(),r(A,null,[t("div",yd,[t("div",gd,[a(C,{type:"flex",justify:"end"},{default:o(()=>[a(b,{key:"scale-control",size:"default"},{default:o(()=>[M.readonly?E("",!0):(l(),f(d,{key:0,size:"default",onClick:U},{default:o(()=>[a(k,{icon:"ep:download"}),g[6]||(g[6]=F(" \u5BFC\u51FA "))]),_:1})),M.readonly?E("",!0):(l(),f(d,{key:1,size:"default",onClick:_},{default:o(()=>[a(k,{icon:"ep:upload"}),g[7]||(g[7]=F("\u5BFC\u5165 "))]),_:1})),M.readonly?E("",!0):(l(),r("input",{key:2,type:"file",id:"files",ref_key:"refFile",ref:N,style:{display:"none"},accept:".json",onChange:s},null,544)),a(d,{size:"default",icon:e(fa),onClick:g[0]||(g[0]=V=>{u.value=100})},null,8,["icon"]),a(d,{size:"default",plain:!0,icon:e(ya),onClick:g[1]||(g[1]=V=>{u.value!=50&&(u.value-=10)})},null,8,["icon"]),a(d,{size:"default",class:"w-80px"},{default:o(()=>[F(P(e(u))+"% ",1)]),_:1}),a(d,{size:"default",plain:!0,icon:e(ga),onClick:g[2]||(g[2]=V=>{u.value!=200&&(u.value+=10)})},null,8,["icon"])]),_:1})]),_:1})]),t("div",{class:"simple-process-model",style:ha(`transform: scale(${e(u)/100});`)},[e(n)?(l(),f(Nl,{key:0,"flow-node":e(n),"onUpdate:flowNode":g[3]||(g[3]=V=>ae(n)?n.value=V:null)},null,8,["flow-node"])):E("",!0)],4)]),a(p,{modelValue:e(S),"onUpdate:modelValue":g[5]||(g[5]=V=>ae(S)?S.value=V:null),title:"\u4FDD\u5B58\u5931\u8D25",width:"400",fullscreen:!1},{footer:o(()=>[a(d,{type:"primary",onClick:g[4]||(g[4]=V=>S.value=!1)},{default:o(()=>g[8]||(g[8]=[F("\u77E5\u9053\u4E86")])),_:1})]),default:o(()=>[g[9]||(g[9]=t("div",{class:"mb-2"},"\u4EE5\u4E0B\u8282\u70B9\u5185\u5BB9\u4E0D\u5B8C\u5584\uFF0C\u8BF7\u4FEE\u6539\u540E\u4FDD\u5B58",-1)),(l(!0),r(A,null,B(e(T),(V,D)=>(l(),r("div",{class:"mb-3 b-rounded-1 bg-gray-100 p-2 line-height-normal",key:D},P(V.name)+" : "+P(e(Se).get(V.type)),1))),128))]),_:1},8,["modelValue"])],64)}}});export{hd as _};
