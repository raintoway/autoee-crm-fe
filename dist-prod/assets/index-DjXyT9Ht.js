import{d as P,r as m,n as Q,o as l,c as U,y as V,u as t,q as s,w as o,x as g,a3 as u,f as i,P as W,z as j,a as H,I as J,l as K,m as X,E as Z,M as $}from"./index-DPENBzsb.js";import{g as G,_ as Y}from"./index-D9VBT2CA.js";import{u as tt}from"./tagsView-uxrzGHKp.js";import{g as rt}from"./index-BRgO_Nxc.js";import{_ as it}from"./ContractDetailsInfo.vue_vue_type_script_setup_true_lang-cSbcuseL.js";import{_ as et}from"./ContractDetailsHeader.vue_vue_type_script_setup_true_lang-4i1ihXq_.js";import{_ as at}from"./ContractProductList.vue_vue_type_script_setup_true_lang-BIhUfga2.js";import{B as n}from"./index-Cb-L5Bqt.js";import{_ as ot}from"./ContractForm.vue_vue_type_script_setup_true_lang-CnyZ7o7h.js";import{_ as mt}from"./TransferForm.vue_vue_type_script_setup_true_lang-BQHZ7ctl.js";import{_ as lt}from"./PermissionList.vue_vue_type_script_setup_true_lang-Ch3d1W7H.js";import{_ as st}from"./index.vue_vue_type_script_setup_true_lang-BVFvTCKz.js";import{_ as pt}from"./ReceivableList.vue_vue_type_script_setup_true_lang-boZy12vZ.js";import{_ as ut}from"./ReceivablePlanList.vue_vue_type_script_setup_true_lang-IZFfLr7D.js";import"./el-timeline-item-DOhCPhED.js";import"./formatTime-C7TQtsxQ.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import"./el-descriptions-item-BD45d2S6.js";import"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import"./color-DXkOL5Tu.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./index-OU-fIsLR.js";import"./index-Co9HWb9O.js";import"./index-zBhacYdK.js";import"./index-D0zCJsCp.js";import"./ContractProductForm.vue_vue_type_script_setup_true_lang-BE66Fj5y.js";import"./index-B6l7NQIx.js";import"./index-DvyG3vlo.js";import"./PermissionForm.vue_vue_type_script_setup_true_lang-DymHMb9s.js";import"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import"./index-C2tU_CDa.js";import"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-DooL9HAc.js";import"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-B4zmNLSs.js";import"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-Cw7cyvrf.js";import"./BusinessListModal.vue_vue_type_script_setup_true_lang-B4bxVlIN.js";import"./BusinessForm.vue_vue_type_script_setup_true_lang-aTUZuI7c.js";import"./index-Cj_ALIC1.js";import"./BusinessProductForm.vue_vue_type_script_setup_true_lang-z3hq65Lx.js";import"./ContactListModal.vue_vue_type_script_setup_true_lang-BDJxp_NS.js";import"./ContactForm.vue_vue_type_script_setup_true_lang-CDIYsxb8.js";import"./index-gTb5e5TR.js";import"./tree-Cts6wVCK.js";import"./index-DBsmcN-E.js";import"./ReceivableForm.vue_vue_type_script_setup_true_lang-Byp1QREC.js";import"./index-NfHILKK3.js";import"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-GTVL39Jl.js";const nt=P({name:"CrmContractDetail",__name:"index",props:{id:{}},setup(M){const O=M,x=W(),A=j(),d=m(0),c=m(!0),r=m({id:0,customerId:0}),f=m(),y=m(),b=async()=>{c.value=!0;try{r.value=await rt(d.value),await N(d.value)}finally{c.value=!1}},v=m([]),N=async e=>{if(!e)return;const a=await G({bizType:n.CRM_CONTRACT,bizId:e});v.value=a.list},C=m(),D=e=>{var a;(a=C.value)==null||a.createReceivable(e)},R=m(),L=()=>{var e;(e=R.value)==null||e.open(r.value.id)},{delView:S}=tt(),{currentRoute:h}=H(),_=()=>{S(t(h))};return Q(async()=>{const e=O.id||x.params.id;if(!e)return A.warning("\u53C2\u6570\u9519\u8BEF\uFF0C\u5408\u540C\u4E0D\u80FD\u4E3A\u7A7A\uFF01"),void _();d.value=e,await b()}),(e,a)=>{const z=J,p=K,q=Y,B=X,E=Z,F=$;return l(),U("div",null,[V((l(),s(et,{contract:t(r)},{default:o(()=>{var k,T;return[(k=t(f))!=null&&k.validateWrite?(l(),s(z,{key:0,onClick:a[0]||(a[0]=dt=>{return w="update",I=t(r).id,void y.value.open(w,I);var w,I})},{default:o(()=>a[1]||(a[1]=[g(" \u7F16\u8F91 ")])),_:1})):u("",!0),(T=t(f))!=null&&T.validateOwnerUser?(l(),s(z,{key:1,type:"primary",onClick:L},{default:o(()=>a[2]||(a[2]=[g(" \u8F6C\u79FB ")])),_:1})):u("",!0)]}),_:1},8,["contract"])),[[F,t(c)]]),i(E,null,{default:o(()=>[i(B,null,{default:o(()=>[i(p,{label:"\u8DDF\u8FDB\u8BB0\u5F55"},{default:o(()=>[t(r).id?(l(),s(st,{key:0,"biz-id":t(r).id,"biz-type":t(n).CRM_CONTRACT},null,8,["biz-id","biz-type"])):u("",!0)]),_:1}),i(p,{label:"\u56DE\u6B3E"},{default:o(()=>[t(r).id&&t(r).customerId?(l(),s(ut,{key:0,"contract-id":t(r).id,"customer-id":t(r).customerId,onCreateReceivable:D},null,8,["contract-id","customer-id"])):u("",!0),t(r).id&&t(r).customerId?(l(),s(pt,{key:1,ref_key:"receivableListRef",ref:C,"contract-id":t(r).id,"customer-id":t(r).customerId},null,8,["contract-id","customer-id"])):u("",!0)]),_:1}),i(p,{label:"\u57FA\u672C\u4FE1\u606F"},{default:o(()=>[t(r).id?(l(),s(it,{key:0,contract:t(r)},null,8,["contract"])):u("",!0)]),_:1}),i(p,{label:"\u4EA7\u54C1"},{default:o(()=>[i(at,{contract:t(r)},null,8,["contract"])]),_:1}),i(p,{label:"\u56E2\u961F\u6210\u5458"},{default:o(()=>[i(lt,{ref_key:"permissionListRef",ref:f,"biz-id":t(r).id,"biz-type":t(n).CRM_CONTRACT,"show-action":!0,onQuitTeam:_},null,8,["biz-id","biz-type"])]),_:1}),i(p,{label:"\u64CD\u4F5C\u65E5\u5FD7"},{default:o(()=>[i(q,{"log-list":t(v)},null,8,["log-list"])]),_:1})]),_:1})]),_:1}),i(ot,{ref_key:"formRef",ref:y,onSuccess:b},null,512),i(mt,{ref_key:"transferFormRef",ref:R,"biz-type":t(n).CRM_CONTRACT,onSuccess:_},null,8,["biz-type"])])}}});export{nt as default};
