import{d as j,r as p,e as B,aw as M,o as d,c as q,f as a,w as i,x as I,y as g,u as o,q as v,D as A,dB as D,F,z as H,h as K,H as V,I as W,i as Y,K as G,L as J,U as O,M as Q}from"./index-DPENBzsb.js";import{_ as X}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{_ as $}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{a as ee,d as ae}from"./index-DBsmcN-E.js";import{_ as te}from"./ReceivableForm.vue_vue_type_script_setup_true_lang-Byp1QREC.js";import{b as re}from"./formatTime-C7TQtsxQ.js";const oe=j({name:"CrmReceivableList",__name:"ReceivableList",props:{customerId:{},contractId:{}},setup(x,{expose:C}){const t=x,_=H(),{t:h}=K(),m=p(!0),b=p(0),w=p([]),r=B({pageNo:1,pageSize:10,customerId:void 0,contractId:void 0}),s=async()=>{m.value=!0;try{t.customerId&&!t.contractId?r.customerId=t.customerId:t.customerId&&t.contractId&&(r.customerId=t.customerId,r.contractId=t.contractId);const l=await ee(r);w.value=l.list,b.value=l.total}finally{m.value=!1}},u=p(),y=(l,e)=>{u.value.open(l,e,{customerId:t.customerId,contractId:t.contractId})};return C({createReceivable:l=>{const e=l;u.value.open("create",void 0,e)}}),M(()=>[t.customerId,t.contractId],l=>{l[0]&&(r.pageNo=1,r.customerId=void 0,r.contractId=void 0,s())},{immediate:!0,deep:!0}),(l,e)=>{const R=V,f=W,N=Y,c=G,S=$,U=J,E=Z,T=X,k=O("hasPermi"),z=Q;return d(),q(F,null,[a(N,{justify:"end"},{default:i(()=>[a(f,{onClick:e[0]||(e[0]=n=>y("create"))},{default:i(()=>[a(R,{class:"mr-5px",icon:"icon-park:income-one"}),e[3]||(e[3]=I(" \u521B\u5EFA\u56DE\u6B3E "))]),_:1})]),_:1}),a(T,{class:"mt-10px"},{default:i(()=>[g((d(),v(U,{data:o(w),"show-overflow-tooltip":!0,stripe:!0},{default:i(()=>[a(c,{align:"center",label:"\u56DE\u6B3E\u7F16\u53F7",prop:"no"}),a(c,{align:"center",label:"\u5BA2\u6237",prop:"customerName"}),a(c,{align:"center",label:"\u5408\u540C",prop:"contract.no"}),a(c,{formatter:o(re),align:"center",label:"\u56DE\u6B3E\u65E5\u671F",prop:"returnTime",width:"150px"},null,8,["formatter"]),a(c,{align:"center",label:"\u56DE\u6B3E\u65B9\u5F0F",prop:"returnType",width:"130px"},{default:i(n=>[a(S,{type:o(A).CRM_RECEIVABLE_RETURN_TYPE,value:n.row.returnType},null,8,["type","value"])]),_:1}),a(c,{align:"center",label:"\u56DE\u6B3E\u91D1\u989D(\u5143)",prop:"price",formatter:o(D)},null,8,["formatter"]),a(c,{align:"center",label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName"}),a(c,{align:"center",label:"\u5907\u6CE8",prop:"remark"}),a(c,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"130px"},{default:i(n=>[g((d(),v(f,{link:"",type:"primary",onClick:L=>y("update",n.row.id)},{default:i(()=>e[4]||(e[4]=[I(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[k,["crm:receivable:update"]]]),g((d(),v(f,{link:"",type:"danger",onClick:L=>(async P=>{try{await _.delConfirm(),await ae(P),_.success(h("common.delSuccess")),await s()}catch{}})(n.row.id)},{default:i(()=>e[5]||(e[5]=[I(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[k,["crm:receivable:delete"]]])]),_:1})]),_:1},8,["data"])),[[z,o(m)]]),a(E,{limit:o(r).pageSize,"onUpdate:limit":e[1]||(e[1]=n=>o(r).pageSize=n),page:o(r).pageNo,"onUpdate:page":e[2]||(e[2]=n=>o(r).pageNo=n),total:o(b),onPagination:s},null,8,["limit","page","total"])]),_:1}),a(te,{ref_key:"formRef",ref:u,onSuccess:s},null,512)],64)}}});export{oe as _};
