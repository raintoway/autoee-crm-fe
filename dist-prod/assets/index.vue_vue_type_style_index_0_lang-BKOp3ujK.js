import{_ as K}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{g as R,i as A,a as U,b as V,c as p,d as D,e as $,f as q,h as z,P as F,j as H,k as J}from"./bpmn-embedded-BBruoZr8.js";import{d as X,r as T,cX as Q,ax as W,o as M,q as j,w as Y,f as Z,aJ as ee,u as g,k as te,a3 as ne,z as ae,ay as B,ba as L}from"./index-DPENBzsb.js";function oe(t){return function(c,s){return(R(c)||c).button===s}(t,0)}function ie(t){var c=R(t)||t;return!!oe(t)&&(/mac/i.test(navigator.platform)?c.metaKey:c.ctrlKey)}function N(t,c,s,d,v,h,l,o,r,y,a,e){t=t||{},d.registerProvider(this),this._contextPad=d,this._modeling=v,this._elementFactory=h,this._connect=l,this._create=o,this._popupMenu=r,this._canvas=y,this._rules=a,this._translate=e,t.autoPlace!==!1&&(this._autoPlace=c.get("autoPlace",!1)),s.on("create.end",250,function(i){const u=i.context.shape;if(!ie(i)||!d.isOpen(u))return;const n=d.getEntries(u);n.replace&&n.replace.action.click(i,u)})}function G(t,c,s){const d=t.$instanceOf(c);let v=!1;const h=t.eventDefinitions||[];return z(h,function(l){l.$type===s&&(v=!0)}),d&&v}N.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","elementRegistry"],N.prototype.getContextPadEntries=function(t){const c=this._contextPad,s=this._modeling,d=this._elementFactory,v=this._connect,h=this._create,l=this._popupMenu,o=this._canvas,r=this._rules,y=this._autoPlace,a=this._translate,e={};if(t.type==="label")return e;const i=t.businessObject;function u(m,f){v.start(m,f)}function n(m,f,b,C){function S(x,_){const w=d.createShape(p({type:m},C));h.start(x,w,{source:_})}return typeof b!="string"&&(C=b,b=a("Append {type}",{type:m.replace(/^bpmn:/,"")})),{group:"model",className:f,title:b,action:{dragstart:S,click:y?function(x,_){const w=d.createShape(p({type:m},C));y.append(_,w)}:S}}}function k(m){return function(f,b){s.splitLane(b,m),c.open(b,!0)}}if(A(i,["bpmn:Lane","bpmn:Participant"])&&U(i)){const m=V(t);p(e,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:a("Add Lane above"),action:{click:function(f,b){s.addLane(b,"top")}}}}),m.length<2&&(t.height>=120&&p(e,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:a("Divide into two Lanes"),action:{click:k(2)}}}),t.height>=180&&p(e,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:a("Divide into three Lanes"),action:{click:k(3)}}})),p(e,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:a("Add Lane below"),action:{click:function(f,b){s.addLane(b,"bottom")}}}})}D(i,"bpmn:FlowNode")&&(D(i,"bpmn:EventBasedGateway")?p(e,{"append.receive-task":n("bpmn:ReceiveTask","bpmn-icon-receive-task",a("Append ReceiveTask")),"append.message-intermediate-event":n("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",a("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":n("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",a("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":n("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",a("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":n("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",a("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):G(i,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?p(e,{"append.compensation-activity":n("bpmn:Task","bpmn-icon-task",a("Append compensation activity"),{isForCompensation:!0})}):D(i,"bpmn:EndEvent")||i.isForCompensation||G(i,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||$(i)||p(e,{"append.end-event":n("bpmn:EndEvent","bpmn-icon-end-event-none",a("Append EndEvent")),"append.gateway":n("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",a("Append Gateway")),"append.append-task":n("bpmn:UserTask","bpmn-icon-user-task",a("Append Task")),"append.intermediate-event":n("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",a("Append Intermediate/Boundary Event"))})),l.isEmpty(t,"bpmn-replace")||p(e,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:"\u4FEE\u6539\u7C7B\u578B",action:{click:function(m,f){const b=p(function(C){const S=o.getContainer(),I=c.getPad(C).html,x=S.getBoundingClientRect(),_=I.getBoundingClientRect(),w=_.top-x.top;return{x:_.left-x.left,y:w+_.height+5}}(f),{cursor:{x:m.x,y:m.y}});l.open(f,"bpmn-replace",b)}}}}),A(i,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&p(e,{"append.text-annotation":n("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:a("Connect using "+(i.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:u,dragstart:u}}}),A(i,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&p(e,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:a("Connect using DataInputAssociation"),action:{click:u,dragstart:u}}}),D(i,"bpmn:Group")&&p(e,{"append.text-annotation":n("bpmn:TextAnnotation","bpmn-icon-text-annotation")});let E=r.allowed("elements.delete",{elements:[t]});return q(E)&&(E=E[0]===t),E&&p(e,{delete:{group:"edit",className:"bpmn-icon-trash",title:a("Remove"),action:{click:function(){s.removeElements([t])}}}}),e};const ce={__init__:["contextPadProvider"],contextPadProvider:["type",N]};function P(t,c,s,d,v,h,l,o){F.call(this,t,c,s,d,v,h,l,o,2e3)}const O=function(){};(O.prototype=F.prototype).getPaletteEntries=function(){const t={},c=this._create,s=this._elementFactory,d=this._spaceTool,v=this._lassoTool,h=this._handTool,l=this._globalConnect,o=this._translate;function r(e,i,u,n,k){function E(f){const b=s.createShape(p({type:e},k));c.start(f,b)}const m=e.replace(/^bpmn:/,"");return{group:i,className:u,title:n||o("Create {type}",{type:m}),action:{dragstart:E,click:E}}}function y(e){const i=s.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),u=s.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:i});c.start(e,[i,u],{hints:{autoSelect:[u]}})}function a(e){c.start(e,s.createParticipantShape())}return p(t,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:"\u6FC0\u6D3B\u6293\u624B\u5DE5\u5177",action:{click:function(e){h.activateHand(e)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:o("Activate the lasso tool"),action:{click:function(e){v.activateSelection(e)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:o("Activate the create/remove space tool"),action:{click:function(e){d.activateSelection(e)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:o("Activate the global connect tool"),action:{click:function(e){l.toggle(e)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":r("bpmn:StartEvent","event","bpmn-icon-start-event-none",o("Create StartEvent")),"create.intermediate-event":r("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",o("Create Intermediate/Boundary Event")),"create.end-event":r("bpmn:EndEvent","event","bpmn-icon-end-event-none",o("Create EndEvent")),"create.exclusive-gateway":r("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",o("Create Gateway")),"create.user-task":r("bpmn:UserTask","activity","bpmn-icon-user-task",o("Create User Task")),"create.call-activity":r("bpmn:CallActivity","activity","bpmn-icon-call-activity",o("Create Call Activity")),"create.service-task":r("bpmn:ServiceTask","activity","bpmn-icon-service",o("Create Service Task")),"create.data-object":r("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",o("Create DataObjectReference")),"create.data-store":r("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",o("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:o("Create expanded SubProcess"),action:{dragstart:y,click:y}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:o("Create Pool/Participant"),action:{dragstart:a,click:a}},"create.group":r("bpmn:Group","artifact","bpmn-icon-group",o("Create Group"))}),t},P.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],P.prototype=new O,P.prototype.constructor=P;const se={__init__:["paletteProvider"],paletteProvider:["type",P]},re=X({name:"BpmModelEditor",__name:"index",props:{modelId:{},modelKey:{},modelName:{},value:{}},emits:["success","init-finished"],setup(t,{emit:c}){const s=c,d=ae(),v=T([]),h=T(20);B("formFields",v),B("formType",h);const l=L("processData"),o=L("modelData"),r=Q(),y=T(),a=T({simulation:!0,labelEditing:!1,labelVisible:!1,prefix:"flowable",headerButtonSize:"mini",additionalModel:[ce,se]}),e=T(),i=async n=>{e.value=o.value,r.value=n},u=async n=>{try{l.value=n,s("success",n)}catch{d.error("\u4FDD\u5B58\u5931\u8D25")}};return W(()=>{r.value=null;const n=window;n.bpmnInstances&&(n.bpmnInstances=null)}),(n,k)=>{const E=K;return M(),j(E,null,{default:Y(()=>[Z(g(H),ee({key:"designer",modelValue:g(l),"onUpdate:modelValue":k[0]||(k[0]=m=>te(l)?l.value=m:null),value:g(l)},g(a),{keyboard:"",ref_key:"processDesigner",ref:y,onInitFinished:i,additionalModel:g(a).additionalModel,model:g(e),onSave:u,"process-id":n.modelKey,"process-name":n.modelName}),null,16,["modelValue","value","additionalModel","model","process-id","process-name"]),g(r)?(M(),j(g(J),{key:"penal",bpmnModeler:g(r),prefix:g(a).prefix,class:"process-panel",model:g(e)},null,8,["bpmnModeler","prefix","model"])):ne("",!0)]),_:1})}}});export{re as _};
