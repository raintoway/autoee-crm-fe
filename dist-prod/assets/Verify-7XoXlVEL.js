import{cQ as R,h as ee,bG as te,r as t,e as L,a1 as ne,aw as ve,n as se,o as T,c as C,u as e,aR as w,g as s,y as ie,a2 as ae,f as he,w as de,W as U,t as M,a3 as q,Z as ge,bk as re,am as oe,cR as ce,cS as ue,F as fe,p as ye,_ as me,a_ as be,x as Se,q as xe,aS as we}from"./index-DPENBzsb.js";function Q(i,d="XwKsGlMcdPMEhR1B"){const l=R.enc.Utf8.parse(d),o=R.enc.Utf8.parse(i);return R.AES.encrypt(o,l,{mode:R.mode.ECB,padding:R.pad.Pkcs7}).toString()}function pe(i){let d,l,o,f;const r=window,u=i.$el.parentNode.offsetWidth||r.offsetWidth,y=i.$el.parentNode.offsetHeight||r.offsetHeight;return d=i.imgSize.width.indexOf("%")!=-1?parseInt(i.imgSize.width)/100*u+"px":i.imgSize.width,l=i.imgSize.height.indexOf("%")!=-1?parseInt(i.imgSize.height)/100*y+"px":i.imgSize.height,o=i.barSize.width.indexOf("%")!=-1?parseInt(i.barSize.width)/100*u+"px":i.barSize.width,f=i.barSize.height.indexOf("%")!=-1?parseInt(i.barSize.height)/100*y+"px":i.barSize.height,{imgWidth:d,imgHeight:l,barWidth:o,barHeight:f}}const ze={style:{position:"relative"}},ke=["src"],We=["textContent"],Te=["textContent"],He=["src"],Ie={style:{position:"relative"}},$e={class:"verify-img-out"},Oe=["src"],Ce={class:"verify-msg"},Ne={key:0,class:"verifybox-top"},Be=me({name:"Vue3Verify",components:{VerifySlide:{__name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:""},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"30px"})}},setup(i){const d=i,{t:l}=ee(),{mode:o,captchaType:f,type:r,blockSize:u,explain:y}=te(d),{proxy:v}=re();let p=t(""),z=t(""),_=t(""),P=t(""),H=t(""),m=t(""),j=t(""),b=t(""),k=t(""),E=t(""),h=L({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),N=t(void 0),I=t(void 0),$=t(void 0),B=t("#ddd"),O=t(void 0),D=t("icon-right"),J=t(!1),g=t(!1),n=t(!0),S=t(""),x=t(""),X=t(0);const V=ne(()=>v.$el.querySelector(".verify-bar-area")),K=()=>{y.value===""?k.value=l("captcha.slide"):k.value=y.value,le(),oe(()=>{let{imgHeight:a,imgWidth:c,barHeight:W,barWidth:Z}=pe(v);h.imgHeight=a,h.imgWidth=c,h.barHeight=W,h.barWidth=Z,v.$parent.$emit("ready",v)}),window.removeEventListener("touchmove",function(a){F(a)}),window.removeEventListener("mousemove",function(a){F(a)}),window.removeEventListener("touchend",function(){G()}),window.removeEventListener("mouseup",function(){G()}),window.addEventListener("touchmove",function(a){F(a)}),window.addEventListener("mousemove",function(a){F(a)}),window.addEventListener("touchend",function(){G()}),window.addEventListener("mouseup",function(){G()})};ve(r,()=>{K()}),se(()=>{K(),v.$el.onselectstart=function(){return!1}});const A=a=>{if((a=a||window.event).touches)c=a.touches[0].pageX;else var c=a.clientX;X.value=Math.floor(c-V.value.getBoundingClientRect().left),m.value=+new Date,g.value==0&&(k.value="",$.value="#337ab7",B.value="#337AB7",O.value="#fff",a.stopPropagation(),J.value=!0)},F=a=>{if(a=a||window.event,J.value&&g.value==0){if(a.touches)c=a.touches[0].pageX;else var c=a.clientX;var W=c-V.value.getBoundingClientRect().left;W>=V.value.offsetWidth-parseInt(parseInt(u.value.width)/2)-2&&(W=V.value.offsetWidth-parseInt(parseInt(u.value.width)/2)-2),W<=0&&(W=parseInt(parseInt(u.value.width)/2)),N.value=W-X.value+"px",I.value=W-X.value+"px"}},G=()=>{if(j.value=+new Date,J.value&&g.value==0){var a=parseInt((N.value||"0").replace("px",""));a=310*a/parseInt(h.imgWidth);let c={captchaType:f.value,pointJson:p.value?Q(JSON.stringify({x:a,y:5}),p.value):JSON.stringify({x:a,y:5}),token:H.value};ce(c).then(W=>{if(W.repCode=="0000"){$.value="#5cb85c",B.value="#5cb85c",O.value="#fff",D.value="icon-check",n.value=!1,g.value=!0,o.value=="pop"&&setTimeout(()=>{v.$parent.clickShow=!1,Y()},1500),z.value=!0,b.value=`${((j.value-m.value)/1e3).toFixed(2)}s
            ${l("captcha.success")}`;var Z=p.value?Q(H.value+"---"+JSON.stringify({x:a,y:5}),p.value):H.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{b.value="",v.$parent.closeBox(),v.$parent.$emit("success",{captchaVerification:Z})},1e3)}else $.value="#d9534f",B.value="#d9534f",O.value="#fff",D.value="icon-close",z.value=!1,setTimeout(function(){Y()},1e3),v.$parent.$emit("error",v),b.value=l("captcha.fail"),setTimeout(()=>{b.value=""},1e3)}),J.value=!1}},Y=async()=>{n.value=!0,E.value="",S.value="left .3s",N.value=0,I.value=void 0,x.value="width .3s",B.value="#ddd",$.value="#fff",O.value="#000",D.value="icon-right",g.value=!1,await le(),setTimeout(()=>{x.value="",S.value="",k.value=y.value},300)},le=async()=>{let a={captchaType:f.value};const c=await ue(a);c.repCode=="0000"?(_.value=c.repData.originalImageBase64,P.value=c.repData.jigsawImageBase64,H.value=c.repData.token,p.value=c.repData.secretKey):b.value=c.repMsg};return(a,c)=>(T(),C("div",ze,[e(r)==="2"?(T(),C("div",{key:0,style:w({height:parseInt(e(h).imgHeight)+i.vSpace+"px"}),class:"verify-img-out"},[s("div",{style:w({width:e(h).imgWidth,height:e(h).imgHeight}),class:"verify-img-panel"},[s("img",{src:"data:image/png;base64,"+e(_),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,ke),ie(s("div",{class:"verify-refresh",onClick:Y},c[0]||(c[0]=[s("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[ae,e(n)]]),he(ge,{name:"tips"},{default:de(()=>[e(b)?(T(),C("span",{key:0,class:U([e(z)?"suc-bg":"err-bg","verify-tips"])},M(e(b)),3)):q("",!0)]),_:1})],4)],4)):q("",!0),s("div",{style:w({width:e(h).imgWidth,height:i.barSize.height,"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",{class:"verify-msg",textContent:M(e(k))},null,8,We),s("div",{style:w({width:e(I)!==void 0?e(I):i.barSize.height,height:i.barSize.height,"border-color":e(B),transaction:e(x)}),class:"verify-left-bar"},[s("span",{class:"verify-msg",textContent:M(e(E))},null,8,Te),s("div",{style:w({width:i.barSize.height,height:i.barSize.height,"background-color":e($),left:e(N),transition:e(S)}),class:"verify-move-block",onMousedown:A,onTouchstart:A},[s("i",{class:U(["verify-icon iconfont",e(D)]),style:w({color:e(O)})},null,6),e(r)==="2"?(T(),C("div",{key:0,style:w({width:Math.floor(47*parseInt(e(h).imgWidth)/310)+"px",height:e(h).imgHeight,top:"-"+(parseInt(e(h).imgHeight)+i.vSpace)+"px","background-size":e(h).imgWidth+" "+e(h).imgHeight}),class:"verify-sub-block"},[s("img",{src:"data:image/png;base64,"+e(P),alt:"",style:{display:"block",width:"100%",height:"100%","-webkit-user-drag":"none"}},null,8,He)],4)):q("",!0)],36)],4)],4)]))}},VerifyPoints:{__name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(i){const d=i,{t:l}=ee(),{mode:o,captchaType:f}=te(d),{proxy:r}=re();let u=t(""),y=t(3),v=L([]),p=L([]),z=t(1),_=t(""),P=L([]),H=t(""),m=L({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),j=L([]),b=t(""),k=t(void 0),E=t(void 0),h=t(!0),N=t(!0);se(()=>{v.splice(0,v.length),p.splice(0,p.length),z.value=1,D(),oe(()=>{let{imgHeight:g,imgWidth:n,barHeight:S,barWidth:x}=pe(r);m.imgHeight=g,m.imgWidth=n,m.barHeight=S,m.barWidth=x,r.$parent.$emit("ready",r)}),r.$el.onselectstart=function(){return!1}});const I=t(null),$=function(g,n){return{x:n.offsetX,y:n.offsetY}},B=function(g){return j.push(Object.assign({},g)),z.value+1},O=async function(){j.splice(0,j.length),k.value="#000",E.value="#ddd",N.value=!0,v.splice(0,v.length),p.splice(0,p.length),z.value=1,await D(),h.value=!0},D=async()=>{let g={captchaType:f.value};const n=await ue(g);n.repCode=="0000"?(_.value=n.repData.originalImageBase64,H.value=n.repData.token,u.value=n.repData.secretKey,P.value=n.repData.wordList,b.value=l("captcha.point")+"\u3010"+P.value.join(",")+"\u3011"):b.value=n.repMsg},J=function(g,n){return g.map(S=>({x:Math.round(310*S.x/parseInt(n.imgWidth)),y:Math.round(155*S.y/parseInt(n.imgHeight))}))};return(g,n)=>(T(),C("div",Ie,[s("div",$e,[s("div",{style:w({width:e(m).imgWidth,height:e(m).imgHeight,"background-size":e(m).imgWidth+" "+e(m).imgHeight,"margin-bottom":i.vSpace+"px"}),class:"verify-img-panel"},[ie(s("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:O},n[1]||(n[1]=[s("i",{class:"iconfont icon-refresh"},null,-1)]),512),[[ae,e(h)]]),s("img",{ref_key:"canvas",ref:I,src:"data:image/png;base64,"+e(_),alt:"",style:{display:"block",width:"100%",height:"100%"},onClick:n[0]||(n[0]=S=>e(N)?(x=>{if(p.push($(I,x)),z.value==y.value){z.value=B($(I,x));let X=J(p,m);p.length=0,p.push(...X),setTimeout(()=>{var V=u.value?Q(H.value+"---"+JSON.stringify(p),u.value):H.value+"---"+JSON.stringify(p);let K={captchaType:f.value,pointJson:u.value?Q(JSON.stringify(p),u.value):JSON.stringify(p),token:H.value};ce(K).then(A=>{A.repCode=="0000"?(k.value="#4cae4c",E.value="#5cb85c",b.value=l("captcha.success"),N.value=!1,o.value=="pop"&&setTimeout(()=>{r.$parent.clickShow=!1,O()},1500),r.$parent.$emit("success",{captchaVerification:V})):(r.$parent.$emit("error",r),k.value="#d9534f",E.value="#d9534f",b.value=l("captcha.fail"),setTimeout(()=>{O()},700))})},400)}z.value<y.value&&(z.value=B($(I,x)))})(S):void 0)},null,8,Oe),(T(!0),C(fe,null,ye(e(j),(S,x)=>(T(),C("div",{key:x,style:w({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(S.y-10)+"px",left:parseInt(S.x-10)+"px"}),class:"point-area"},M(x+1),5))),128))],4)]),s("div",{style:w({width:e(m).imgWidth,color:e(k),"border-color":e(E),"line-height":i.barSize.height}),class:"verify-bar-area"},[s("span",Ce,M(e(b)),1)],4)]))}}},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(i){const{t:d}=ee(),{captchaType:l,mode:o}=te(i),f=t(!1),r=t(void 0),u=t(void 0),y=t({}),v=ne(()=>o.value!="pop"||f.value);return be(()=>{switch(l.value){case"blockPuzzle":r.value="2",u.value="VerifySlide";break;case"clickWord":r.value="",u.value="VerifyPoints"}}),{t:d,clickShow:f,verifyType:r,componentType:u,instance:y,showBox:v,closeBox:()=>{f.value=!1,y.value.refresh&&y.value.refresh()},show:()=>{o.value=="pop"&&(f.value=!0)}}}},[["render",function(i,d,l,o,f,r){return ie((T(),C("div",{class:U(l.mode=="pop"?"mask":"")},[s("div",{class:U(l.mode=="pop"?"verifybox":""),style:w({"max-width":parseInt(l.imgSize.width)+20+"px"})},[l.mode=="pop"?(T(),C("div",Ne,[Se(M(o.t("captcha.verification"))+" ",1),s("span",{class:"verifybox-close",onClick:d[0]||(d[0]=(...u)=>o.closeBox&&o.closeBox(...u))},d[1]||(d[1]=[s("i",{class:"iconfont icon-close"},null,-1)]))])):q("",!0),s("div",{style:w({padding:l.mode=="pop"?"10px":"0"}),class:"verifybox-bottom"},[o.componentType?(T(),xe(we(o.componentType),{key:0,ref:"instance",arith:l.arith,barSize:l.barSize,blockSize:l.blockSize,captchaType:l.captchaType,explain:l.explain,figure:l.figure,imgSize:l.imgSize,mode:l.mode,type:o.verifyType,vSpace:l.vSpace},null,8,["arith","barSize","blockSize","captchaType","explain","figure","imgSize","mode","type","vSpace"])):q("",!0)],4)],6)],2)),[[ae,o.showBox]])}]]);export{Be as _};
