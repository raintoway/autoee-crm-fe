import{d as B,r as u,e as D,aw as F,o as s,c as H,f as a,w as c,x as f,y as g,u as l,q as I,dB as K,F as E,z as M,h as W,H as A,I as G,i as J,K as O,L as Q,U as V,M as X}from"./index-DPENBzsb.js";import{_ as Y}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{a as $,d as ee}from"./index-NfHILKK3.js";import{_ as ae}from"./ReceivablePlanForm.vue_vue_type_script_setup_true_lang-GTVL39Jl.js";import{b as C}from"./formatTime-C7TQtsxQ.js";const te=B({name:"CrmReceivablePlanList",__name:"ReceivablePlanList",props:{customerId:{},contractId:{}},emits:["createReceivable"],setup(N,{emit:S}){const t=N,w=M(),{t:P}=W(),b=u(!0),_=u(0),y=u([]),r=D({pageNo:1,pageSize:10,customerId:void 0,contractId:void 0}),d=async()=>{b.value=!0;try{t.customerId&&!t.contractId?r.customerId=t.customerId:t.customerId&&t.contractId&&(r.customerId=t.customerId,r.contractId=t.contractId);const n=await $(r);y.value=n.list,_.value=n.total}finally{b.value=!1}},h=u(),k=(n,e)=>{h.value.open(n,e,t.customerId,t.contractId)},R=S;return F(()=>[t.customerId,t.contractId],n=>{n[0]&&(r.pageNo=1,r.customerId=void 0,r.contractId=void 0,d())},{immediate:!0,deep:!0}),(n,e)=>{const z=A,p=G,U=J,o=O,L=Q,T=Z,j=Y,v=V("hasPermi"),q=X;return s(),H(E,null,[a(U,{justify:"end"},{default:c(()=>[a(p,{onClick:e[0]||(e[0]=i=>k("create",void 0))},{default:c(()=>[a(z,{class:"mr-5px",icon:"icon-park:income"}),e[3]||(e[3]=f(" \u521B\u5EFA\u56DE\u6B3E\u8BA1\u5212 "))]),_:1})]),_:1}),a(j,{class:"mt-10px"},{default:c(()=>[g((s(),I(L,{data:l(y),"show-overflow-tooltip":!0,stripe:!0},{default:c(()=>[a(o,{align:"center",label:"\u5BA2\u6237\u540D\u79F0",prop:"customerName",width:"150px"}),a(o,{align:"center",label:"\u5408\u540C\u7F16\u53F7",prop:"contractNo",width:"200px"}),a(o,{align:"center",label:"\u671F\u6570",prop:"period"}),a(o,{align:"center",label:"\u8BA1\u5212\u56DE\u6B3E(\u5143)",prop:"price",width:"120",formatter:l(K)},null,8,["formatter"]),a(o,{formatter:l(C),align:"center",label:"\u8BA1\u5212\u56DE\u6B3E\u65E5\u671F",prop:"returnTime",width:"180px"},null,8,["formatter"]),a(o,{align:"center",label:"\u63D0\u524D\u51E0\u5929\u63D0\u9192",prop:"remindDays",width:"150"}),a(o,{formatter:l(C),align:"center",label:"\u63D0\u9192\u65E5\u671F",prop:"remindTime",width:"180px"},null,8,["formatter"]),a(o,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserName",width:"120"}),a(o,{align:"center",label:"\u5907\u6CE8",prop:"remark"}),a(o,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"200px"},{default:c(i=>[g((s(),I(p,{link:"",type:"primary",onClick:x=>{return m=i.row,void R("createReceivable",m);var m},disabled:i.row.receivableId},{default:c(()=>e[4]||(e[4]=[f(" \u521B\u5EFA\u56DE\u6B3E ")])),_:2},1032,["onClick","disabled"])),[[v,["crm:receivable:create"]]]),g((s(),I(p,{link:"",type:"primary",onClick:x=>k("update",i.row.id)},{default:c(()=>e[5]||(e[5]=[f(" \u7F16\u8F91 ")])),_:2},1032,["onClick"])),[[v,["crm:receivable-plan:update"]]]),g((s(),I(p,{link:"",type:"danger",onClick:x=>(async m=>{try{await w.delConfirm(),await ee(m),w.success(P("common.delSuccess")),await d()}catch{}})(i.row.id)},{default:c(()=>e[6]||(e[6]=[f(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[v,["crm:receivable-plan:delete"]]])]),_:1})]),_:1},8,["data"])),[[q,l(b)]]),a(T,{limit:l(r).pageSize,"onUpdate:limit":e[1]||(e[1]=i=>l(r).pageSize=i),page:l(r).pageNo,"onUpdate:page":e[2]||(e[2]=i=>l(r).pageNo=i),total:l(_),onPagination:d},null,8,["limit","page","total"])]),_:1}),a(ae,{ref_key:"formRef",ref:h,onSuccess:d},null,512)],64)}}});export{te as _};
