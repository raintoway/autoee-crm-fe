import{d as H,r as y,e as K,n as W,aw as Y,o as r,c as _,f as a,w as i,x as f,y as A,u as e,q as u,D as G,F as z,p as R,t as U,a3 as S,z as J,h as Q,a as V,H as X,I as Z,i as aa,K as ea,ad as ta,L as la,M as ia}from"./index-DPENBzsb.js";import{_ as sa}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as oa}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{_ as na}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{d as h}from"./formatTime-C7TQtsxQ.js";import{_ as ra,F}from"./FollowUpRecordForm.vue_vue_type_script_setup_true_lang-DooL9HAc.js";import{B as M}from"./index-Cb-L5Bqt.js";const pa=H({name:"FollowUpRecord",__name:"index",props:{bizType:{},bizId:{}},setup(O){const c=O,w=J(),{t:D}=Q(),b=y(!0),C=y([]),k=y(0),p=K({pageNo:1,pageSize:10,bizType:0,bizId:0}),d=async()=>{b.value=!0;try{const t=await F.getFollowUpRecordPage(p);C.value=t.list,k.value=t.total}finally{b.value=!1}},T=y(),N=()=>{var t;(t=T.value)==null||t.open(c.bizType,c.bizId)},{push:v}=V();return W(async()=>{Object.assign(p,{bizType:c.bizType,bizId:c.bizId}),await d()}),Y(()=>c.bizId,t=>{t&&(Object.assign(p,{bizType:c.bizType,bizId:t}),d())}),(t,s)=>{const P=X,x=Z,j=aa,o=ea,E=na,I=ta,L=la,B=oa,$=sa,q=ia;return r(),_(z,null,[a(j,{class:"mb-10px",justify:"end"},{default:i(()=>[a(x,{onClick:N},{default:i(()=>[a(P,{class:"mr-5px",icon:"ep:edit"}),s[2]||(s[2]=f(" \u5199\u8DDF\u8FDB "))]),_:1})]),_:1}),a($,null,{default:i(()=>[A((r(),u(L,{data:e(C),"show-overflow-tooltip":!0,stripe:!0},{default:i(()=>[a(o,{formatter:e(h),align:"center",label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",width:"180px"},null,8,["formatter"]),a(o,{align:"center",label:"\u8DDF\u8FDB\u4EBA",prop:"creatorName"}),a(o,{align:"center",label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:i(l=>[a(E,{type:e(G).CRM_FOLLOW_UP_TYPE,value:l.row.type},null,8,["type","value"])]),_:1}),a(o,{align:"center",label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"}),a(o,{formatter:e(h),align:"center",label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime",width:"180px"},null,8,["formatter"]),t.bizType===e(M).CRM_CUSTOMER?(r(),u(o,{key:0,align:"center",label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:i(l=>[(r(!0),_(z,null,R(l.row.contacts,n=>(r(),u(I,{key:`key-${n.id}`,underline:!1,type:"primary",onClick:g=>{return m=n.id,void v({name:"CrmContactDetail",params:{id:m}});var m},class:"ml-5px"},{default:i(()=>[f(U(n.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0),t.bizType===e(M).CRM_CUSTOMER?(r(),u(o,{key:1,align:"center",label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:i(l=>[(r(!0),_(z,null,R(l.row.businesses,n=>(r(),u(I,{key:`key-${n.id}`,underline:!1,type:"primary",onClick:g=>{return m=n.id,void v({name:"CrmBusinessDetail",params:{id:m}});var m},class:"ml-5px"},{default:i(()=>[f(U(n.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})):S("",!0),a(o,{align:"center",label:"\u64CD\u4F5C"},{default:i(l=>[a(x,{link:"",type:"danger",onClick:n=>(async g=>{try{await w.delConfirm(),await F.deleteFollowUpRecord(g),w.success(D("common.delSuccess")),await d()}catch{}})(l.row.id)},{default:i(()=>s[3]||(s[3]=[f(" \u5220\u9664 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,e(b)]]),a(B,{limit:e(p).pageSize,"onUpdate:limit":s[0]||(s[0]=l=>e(p).pageSize=l),page:e(p).pageNo,"onUpdate:page":s[1]||(s[1]=l=>e(p).pageNo=l),total:e(k),onPagination:d},null,8,["limit","page","total"])]),_:1}),a(ra,{ref_key:"formRef",ref:T,onSuccess:d},null,512)],64)}}});export{pa as _};
