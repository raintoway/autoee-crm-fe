import{d as K,r as p,a as Q,z as Y,al as Z,o as v,q as D,w as n,g as _,f as o,t as ee,u as t,k as N,y as ae,c as U,a3 as P,x as V,am as oe,ao as te,E as ie,i as le,ap as re,l as se,m as ne,H as me,I as pe,M as ce,_ as ue}from"./index-DPENBzsb.js";import{_ as de}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{d as fe,b as ve}from"./formCreate-BQ5MeUYD.js";import{a as F}from"./constants-C8tGWvl2.js";import{n as ye,C as _e,F as h}from"./consts-Dqfik1EE.js";import be from"./ProcessInstanceBpmnViewer-DhragUyT.js";import{_ as xe}from"./ProcessInstanceSimpleViewer.vue_vue_type_script_setup_true_lang-7iwin6s7.js";import{_ as De}from"./ProcessInstanceTimeline.vue_vue_type_script_setup_true_lang-DqnNG6nc.js";import{u as Pe}from"./tagsView-uxrzGHKp.js";import{g as he,e as we}from"./index-DetSWMsK.js";import{a as Ee}from"./index-B9xqy6_R.js";import"./bpmn-embedded-BBruoZr8.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./XTextButton-CaCskr4h.js";import"./XButton-lfojvuGT.js";import"./index-Co9HWb9O.js";import"./utils-CjFsbWby.js";import"./index-D2cLVQ1T.js";import"./index-BCN8BzfC.js";import"./index-BOzeB1Pk.js";import"./el-tree-select-DxCa0FGQ.js";import"./tree-Cts6wVCK.js";import"./index-tb7T-AVj.js";import"./index-BUzABQZW.js";import"./index-Btz8nVwe.js";import"./index-BAEJzc7Z.js";import"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import"./index-C2tU_CDa.js";import"./index-O66V04DS.js";import"./el-drawer-DSddsvoD.js";import"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import"./color-DXkOL5Tu.js";import"./index-IbQXwv2T.js";import"./formatTime-C7TQtsxQ.js";import"./simple-process-designer-RJplQ98g.js";import"./el-space-B67e9bQY.js";import"./download-oWiM5xVU.js";import"./index-NekN2je6.js";import"./el-timeline-item-DOhCPhED.js";import"./el-image-DqGFoayu.js";import"./el-avatar-BjIHlmF4.js";const Se={class:"processInstance-wrap-main"},ge={class:"text-#878c93 h-15px"},Ce={class:"form-scroll-area"},Ie={class:"form-scroll-area"},ke={class:"b-t-solid border-t-1px border-[var(--el-border-color)]"},Re={key:0,class:"h-50px bottom-10 text-14px flex items-center color-#32373c dark:color-#fff font-bold btn-container"},Te=ue(K({name:"ProcessDefinitionDetail",__name:"ProcessDefinitionDetail",props:{selectProcessDefinition:{}},emits:["cancel"],setup(M,{expose:j,emit:O}){const w=M,B=O,b=p(!1),{push:E,currentRoute:L}=Q(),x=Y(),{delView:q}=Pe(),c=p({rule:[],option:{},value:{}}),m=p(),u=p([]),d=p({}),S=p(null),g=p(),y=p("form"),C=p([]),z=async a=>{var e,r;try{const s=await he({processDefinitionId:a.id,activityId:ye.START_USER_NODE_ID});if(!s)return void x.error("\u67E5\u8BE2\u4E0D\u5230\u5BA1\u6279\u8BE6\u60C5\u4FE1\u606F\uFF01");if(u.value=(e=s.activityNodes)==null?void 0:e.filter(l=>_e.START_USER_SELECT===l.candidateStrategy),((r=u.value)==null?void 0:r.length)>0)for(const l of u.value)d.value[l.id]=[];C.value=s.activityNodes;const i=s.formFieldsPermission;i&&Object.keys(i).forEach(l=>{H(l,i[l])})}finally{}},H=(a,e)=>{var r,s,i;e===h.READ&&((r=m.value)==null||r.disabled(!0,a)),e===h.WRITE&&((s=m.value)==null||s.disabled(!1,a)),e===h.NONE&&((i=m.value)==null||i.hidden(!0,a))},I=async()=>{var a;if(m.value&&w.selectProcessDefinition){if(await m.value.validate(),((a=u.value)==null?void 0:a.length)>0){for(const e of u.value)if(Array.isArray(d.value[e.id])&&d.value[e.id].length===0)return x.warning(`\u8BF7\u9009\u62E9${e.name}\u7684\u5019\u9009\u4EBA`)}b.value=!0;try{await we({processDefinitionId:w.selectProcessDefinition.id,variables:c.value.value,startUserSelectAssignees:d.value}),x.success("\u53D1\u8D77\u6D41\u7A0B\u6210\u529F"),q(t(L)),await E({name:"BpmProcessInstanceMy"})}finally{b.value=!1}}},W=()=>{B("cancel")},X=(a,e)=>{d.value[a]=e==null?void 0:e.map(r=>r.id)};return j({initProcessInfo:async(a,e)=>{var r;if(u.value=[],d.value={},a.formType==10){const s=fe(a.formFields).map(l=>l.field);for(const l in e)s.includes(l)||delete e[l];ve(c,a.formConf,a.formFields,e),await oe(),(r=m.value)==null||r.btn.show(!1),await z(a);const i=await Ee(a.id);i&&(S.value=i.bpmnXml,g.value=i.simpleModel)}else a.formCustomCreatePath&&await E({path:a.formCustomCreatePath})}}),(a,e)=>{const r=te,s=Z("form-create"),i=ie,l=le,k=re,R=se,$=ne,T=me,A=pe,G=de,J=ce;return v(),D(G,{bodyStyle:{padding:"10px 20px 0"}},{default:n(()=>[_("div",Se,[o(k,null,{default:n(()=>[_("div",ge,"\u6D41\u7A0B\uFF1A"+ee(a.selectProcessDefinition.name),1),o(r,{class:"!my-8px"}),o($,{modelValue:t(y),"onUpdate:modelValue":e[2]||(e[2]=f=>N(y)?y.value=f:null)},{default:n(()=>[o(R,{label:"\u8868\u5355\u586B\u5199",name:"form"},{default:n(()=>[ae((v(),U("div",Ce,[o(k,null,{default:n(()=>[o(l,null,{default:n(()=>[o(i,{span:17},{default:n(()=>[o(s,{rule:t(c).rule,api:t(m),"onUpdate:api":e[0]||(e[0]=f=>N(m)?m.value=f:null),modelValue:t(c).value,"onUpdate:modelValue":e[1]||(e[1]=f=>t(c).value=f),option:t(c).option,onSubmit:I},null,8,["rule","api","modelValue","option"])]),_:1}),o(i,{span:6,offset:1},{default:n(()=>[o(De,{ref:"timelineRef","activity-nodes":t(C),"show-status-icon":!1,onSelectUserConfirm:X},null,8,["activity-nodes"])]),_:1})]),_:1})]),_:1})])),[[J,t(b)]])]),_:1}),o(R,{label:"\u6D41\u7A0B\u56FE",name:"diagram"},{default:n(()=>[_("div",Ie,[t(F).BPMN===a.selectProcessDefinition.modelType?(v(),D(be,{key:0,"bpmn-xml":t(S)},null,8,["bpmn-xml"])):P("",!0),t(F).SIMPLE===a.selectProcessDefinition.modelType?(v(),D(xe,{key:1,"simple-json":t(g)},null,8,["simple-json"])):P("",!0)])]),_:1})]),_:1},8,["modelValue"]),_("div",ke,[t(y)==="form"?(v(),U("div",Re,[o(A,{plain:"",type:"success",onClick:I},{default:n(()=>[o(T,{icon:"ep:select"}),e[3]||(e[3]=V("\xA0 \u53D1\u8D77 "))]),_:1}),o(A,{plain:"",type:"danger",onClick:W},{default:n(()=>[o(T,{icon:"ep:close"}),e[4]||(e[4]=V("\xA0 \u53D6\u6D88 "))]),_:1})])):P("",!0)])]),_:1})])]),_:1})}}}),[["__scopeId","data-v-319b1c69"]]);export{Te as default};
