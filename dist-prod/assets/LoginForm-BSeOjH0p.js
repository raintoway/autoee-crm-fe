import{d as G,r as p,a0 as J,a1 as W,e as B,aw as H,n as Q,y as X,a2 as Y,u as e,o as F,q as v,w as n,f as o,N as Z,x as V,t as N,a3 as $,h as aa,z as ea,a as oa,a4 as ta,cP as la,af as k,a8 as na,a9 as sa,aa as ra,ab as ia,a6 as pa,C as da,E as ma,T as ua,ac as ca,ad as fa,i as ga,J as ha,ae as wa,_ as ya}from"./index-DPENBzsb.js";import{_ as _a}from"./Verify-7XoXlVEL.js";import{_ as xa}from"./XButton-lfojvuGT.js";import{u as ba,_ as Fa,L as E,a as va}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-Cw78Dx3I.js";import{u as c}from"./useIcon-CkTi-SrH.js";import{r as f}from"./formRules-DGEyEWoW.js";const Va=ya(G({name:"LoginForm",__name:"LoginForm",setup(Na){const{t:d}=aa();ea(),c({icon:"ep:house"});const S=c({icon:"ep:avatar"}),L=c({icon:"ep:lock"}),g=p(),{validForm:M}=va(g),{setLoginState:P,getLoginState:z}=ba(),{currentRoute:R,push:C}=oa(),T=J(),m=p(""),u=p(!1),h=p(),I=p("blockPuzzle"),O=W(()=>e(z)===E.LOGIN),U={tenantName:[f],username:[f],password:[f]},t=B({isShowPassword:!1,captchaEnable:"false",tenantEnable:"true",loginForm:{tenantName:"CRM\u5E73\u53F0",username:"admin",password:"admin123",captchaVerification:"",rememberMe:!0}}),w=async()=>{t.captchaEnable==="false"?await _({}):h.value.show()},y=p(),_=async l=>{u.value=!0;try{if(await(async()=>{if(t.tenantEnable==="true"){const s=await wa(t.loginForm.tenantName);k(s)}})(),!await M())return;const a={...t.loginForm};a.captchaVerification=l.captchaVerification;const r=await na(a);if(!r)return;y.value=sa.service({lock:!0,text:"\u6B63\u5728\u52A0\u8F7D\u7CFB\u7EDF\u4E2D...",background:"rgba(0, 0, 0, 0.7)"}),a.rememberMe?ra(a):ia(),pa(r),m.value||(m.value="/"),m.value.indexOf("sso")!==-1?window.location.href=window.location.href.replace("/login?redirect=",""):await C({path:m.value||T.addRouters[0].path})}finally{u.value=!1,y.value.close()}};return H(()=>R.value,l=>{var a;m.value=(a=l==null?void 0:l.query)==null?void 0:a.redirect},{immediate:!0}),Q(()=>{(()=>{const l=ta();l&&(t.loginForm={...t.loginForm,username:l.username?l.username:t.loginForm.username,password:l.password?l.password:t.loginForm.password,rememberMe:l.rememberMe,tenantName:l.tenantName?l.tenantName:t.loginForm.tenantName})})(),(async()=>{const l=location.host,a=await la(l);a&&(t.loginForm.tenantName=a.name,k(a.id))})()}),(l,a)=>{const r=da,s=ma,x=ua,q=ca,K=fa,b=ga,j=xa,A=_a,D=ha;return X((F(),v(D,{ref_key:"formLogin",ref:g,model:e(t).loginForm,rules:U,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:n(()=>[o(b,{style:{"margin-right":"-10px","margin-left":"-10px"}},{default:n(()=>[o(s,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(r,null,{default:n(()=>[o(Fa,{style:{width:"100%"}})]),_:1})]),_:1}),o(s,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(r,{prop:"username"},{default:n(()=>[o(x,{modelValue:e(t).loginForm.username,"onUpdate:modelValue":a[0]||(a[0]=i=>e(t).loginForm.username=i),placeholder:e(d)("login.usernamePlaceholder"),"prefix-icon":e(S)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),o(s,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(r,{prop:"password"},{default:n(()=>[o(x,{modelValue:e(t).loginForm.password,"onUpdate:modelValue":a[1]||(a[1]=i=>e(t).loginForm.password=i),placeholder:e(d)("login.passwordPlaceholder"),"prefix-icon":e(L),"show-password":"",type:"password",onKeyup:a[2]||(a[2]=Z(i=>w(),["enter"]))},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),o(s,{span:24,style:{"padding-right":"10px","padding-left":"10px","margin-top":"-20px","margin-bottom":"-20px"}},{default:n(()=>[o(r,null,{default:n(()=>[o(b,{justify:"space-between",style:{width:"100%"}},{default:n(()=>[o(s,{span:6},{default:n(()=>[o(q,{modelValue:e(t).loginForm.rememberMe,"onUpdate:modelValue":a[3]||(a[3]=i=>e(t).loginForm.rememberMe=i)},{default:n(()=>[V(N(e(d)("login.remember")),1)]),_:1},8,["modelValue"])]),_:1}),o(s,{offset:6,span:12},{default:n(()=>[o(K,{style:{float:"right"},type:"primary",onClick:a[4]||(a[4]=i=>e(P)(e(E).RESET_PASSWORD))},{default:n(()=>[V(N(e(d)("login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(s,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:n(()=>[o(r,null,{default:n(()=>[o(j,{loading:e(u),title:e(d)("login.login"),class:"w-[100%]",type:"primary",onClick:a[5]||(a[5]=i=>w())},null,8,["loading","title"])]),_:1})]),_:1}),e(t).captchaEnable==="true"?(F(),v(A,{key:0,ref_key:"verify",ref:h,captchaType:e(I),imgSize:{width:"400px",height:"200px"},mode:"pop",onSuccess:_},null,8,["captchaType"])):$("",!0)]),_:1})]),_:1},8,["model"])),[[Y,e(O)]])}}}),[["__scopeId","data-v-0057ef96"]]);export{Va as default};
