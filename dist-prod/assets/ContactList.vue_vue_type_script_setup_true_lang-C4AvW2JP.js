import{d as q,r as c,e as G,aw as H,o as d,c as K,f as a,w as r,x as m,u as o,y as w,q as p,a3 as f,t as J,D as Q,F as V,z as W,a as X,H as $,I as Y,i as Z,K as ee,ad as ae,L as se,U as te,M as oe}from"./index-DPENBzsb.js";import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{_ as ne}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{d as le,g as ce,e as de,f as ue}from"./index-zBhacYdK.js";import{_ as pe}from"./ContactForm.vue_vue_type_script_setup_true_lang-CDIYsxb8.js";import{B as h}from"./index-Cb-L5Bqt.js";import{_ as me}from"./ContactListModal.vue_vue_type_script_setup_true_lang-BDJxp_NS.js";const fe=q({name:"CrmContactList",__name:"ContactList",props:{bizType:{},bizId:{},customerId:{},businessId:{}},setup(x){const i=x,I=c(!0),k=c(0),z=c([]),s=G({pageNo:1,pageSize:10,customerId:void 0,businessId:void 0}),b=W(),_=async()=>{I.value=!0;try{s.customerId=void 0;let t={list:[],total:0};switch(i.bizType){case h.CRM_CUSTOMER:s.customerId=i.bizId,t=await ce(s);break;case h.CRM_BUSINESS:s.businessId=i.bizId,t=await le(s);break;default:return}z.value=t.list,k.value=t.total}finally{I.value=!1}},y=()=>{s.pageNo=1,_()},C=c(),M=()=>{C.value.open("create",void 0,i.customerId,i.businessId)},{push:T}=X(),S=c(),U=()=>{S.value.open()},B=async t=>{const e={businessId:i.bizId,contactIds:t};g.value.getSelectionRows().forEach(u=>{e.contactIds.push(u.id)}),await de(e),b.success("\u5173\u8054\u8054\u7CFB\u4EBA\u6210\u529F"),y()},g=c(),E=async()=>{const t={businessId:i.bizId,contactIds:g.value.getSelectionRows().map(e=>e.id)};if(t.contactIds.length===0)return b.error("\u672A\u9009\u62E9\u8054\u7CFB\u4EBA");await ue(t),b.success("\u53D6\u5173\u8054\u7CFB\u4EBA\u6210\u529F"),y()};return H(()=>[i.bizId,i.bizType],()=>{y()},{immediate:!0,deep:!0}),(t,e)=>{const u=$,v=Y,L=Z,l=ee,A=ae,O=ne,j=se,D=re,F=ie,N=te("hasPermi"),P=oe;return d(),K(V,null,[a(L,{justify:"end"},{default:r(()=>[a(v,{onClick:M},{default:r(()=>[a(u,{class:"mr-5px",icon:"system-uicons:contacts"}),e[2]||(e[2]=m(" \u521B\u5EFA\u8054\u7CFB\u4EBA "))]),_:1}),o(s).businessId?w((d(),p(v,{key:0,onClick:U},{default:r(()=>[a(u,{class:"mr-5px",icon:"ep:circle-plus"}),e[3]||(e[3]=m(" \u5173\u8054 "))]),_:1})),[[N,["crm:contact:create-business"]]]):f("",!0),o(s).businessId?w((d(),p(v,{key:1,onClick:E},{default:r(()=>[a(u,{class:"mr-5px",icon:"ep:remove"}),e[4]||(e[4]=m(" \u89E3\u9664\u5173\u8054 "))]),_:1})),[[N,["crm:contact:delete-business"]]]):f("",!0)]),_:1}),a(F,{class:"mt-10px"},{default:r(()=>[w((d(),p(j,{ref_key:"contactRef",ref:g,data:o(z),"show-overflow-tooltip":!0,stripe:!0},{default:r(()=>[o(s).businessId?(d(),p(l,{key:0,type:"selection",width:"55"})):f("",!0),a(l,{align:"center",fixed:"left",label:"\u59D3\u540D",prop:"name"},{default:r(n=>[a(A,{underline:!1,type:"primary",onClick:Ie=>{return R=n.row.id,void T({name:"CrmContactDetail",params:{id:R}});var R}},{default:r(()=>[m(J(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(l,{align:"center",label:"\u624B\u673A\u53F7",prop:"mobile"}),a(l,{align:"center",label:"\u804C\u4F4D",prop:"post"}),a(l,{align:"center",label:"\u76F4\u5C5E\u4E0A\u7EA7",prop:"parentName"}),a(l,{align:"center",label:"\u662F\u5426\u5173\u952E\u51B3\u7B56\u4EBA","min-width":"100",prop:"master"},{default:r(n=>[a(O,{type:o(Q).INFRA_BOOLEAN_STRING,value:n.row.master},null,8,["type","value"])]),_:1})]),_:1},8,["data"])),[[P,o(I)]]),a(D,{limit:o(s).pageSize,"onUpdate:limit":e[0]||(e[0]=n=>o(s).pageSize=n),page:o(s).pageNo,"onUpdate:page":e[1]||(e[1]=n=>o(s).pageNo=n),total:o(k),onPagination:_},null,8,["limit","page","total"])]),_:1}),a(pe,{ref_key:"formRef",ref:C,onSuccess:_},null,512),t.customerId?(d(),p(me,{key:0,ref_key:"contactModalRef",ref:S,"customer-id":t.customerId,onSuccess:B},null,8,["customer-id"])):f("",!0)],64)}}});export{fe as _};
