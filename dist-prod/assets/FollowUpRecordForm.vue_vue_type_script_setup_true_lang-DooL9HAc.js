import{a$ as V,d as K,r as i,e as N,o as d,c as R,f as l,w as o,u as s,x as y,y as Q,q as f,F as k,p as X,O as Z,D as ee,a3 as U,k as ae,h as le,z as se,A as oe,B as te,C as ue,E as de,G as re,T as ce,b_ as ne,ar as ie,H as pe,I as me,i as fe,J as be,M as _e}from"./index-DPENBzsb.js";import{_ as ve}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{B as z}from"./index-Cb-L5Bqt.js";import{_ as ye}from"./FollowUpRecordBusinessForm.vue_vue_type_script_setup_true_lang-B4zmNLSs.js";import{_ as Ue}from"./FollowUpRecordContactForm.vue_vue_type_script_setup_true_lang-Cw7cyvrf.js";import{_ as we}from"./BusinessListModal.vue_vue_type_script_setup_true_lang-B4bxVlIN.js";import{_ as Ve}from"./ContactListModal.vue_vue_type_script_setup_true_lang-BDJxp_NS.js";const F={getFollowUpRecordPage:async p=>await V.get({url:"/crm/follow-up-record/page",params:p}),createFollowUpRecord:async p=>await V.post({url:"/crm/follow-up-record/create",data:p}),deleteFollowUpRecord:async p=>await V.delete({url:"/crm/follow-up-record/delete?id="+p})},Te=K({name:"FollowUpRecordForm",__name:"FollowUpRecordForm",emits:["success"],setup(p,{expose:I,emit:h}){const{t:C}=le(),S=se(),m=i(!1);i("");const _=i(!1),a=i({bizType:void 0,bizId:void 0,businesses:[],contacts:[]}),E=N({type:[{required:!0,message:"\u8DDF\u8FDB\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],content:[{required:!0,message:"\u8DDF\u8FDB\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nextTime:[{required:!0,message:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),w=i();I({open:async(u,e)=>{m.value=!0,B(),a.value.bizType=u,a.value.bizId=e}});const M=h,O=async()=>{await w.value.validate(),_.value=!0;try{const u={...a.value,contactIds:a.value.contacts.map(e=>e.id),businessIds:a.value.businesses.map(e=>e.id)};await F.createFollowUpRecord(u),S.success(C("common.createSuccess")),m.value=!1,M("success")}finally{_.value=!1}},T=i(),q=()=>{var u;(u=T.value)==null||u.open()},P=(u,e)=>{e.forEach(r=>{a.value.contacts.some(b=>b.id===r.id)||a.value.contacts.push(r)})},g=i(),L=()=>{var u;(u=g.value)==null||u.open()},A=(u,e)=>{e.forEach(r=>{a.value.businesses.some(b=>b.id===r.id)||a.value.businesses.push(r)})},B=()=>{var u;(u=w.value)==null||u.resetFields(),a.value={bizId:void 0,bizType:void 0,businesses:[],contacts:[]}};return(u,e)=>{const r=oe,b=te,c=ue,n=de,D=re,Y=ce,G=ne,H=ie,x=pe,v=me,J=fe,W=be,$=ve,j=_e;return d(),R(k,null,[l($,{modelValue:s(m),"onUpdate:modelValue":e[6]||(e[6]=t=>ae(m)?m.value=t:null),title:"\u6DFB\u52A0\u8DDF\u8FDB\u8BB0\u5F55",width:"50%"},{footer:o(()=>[l(v,{disabled:s(_),type:"primary",onClick:O},{default:o(()=>e[9]||(e[9]=[y("\u786E \u5B9A")])),_:1},8,["disabled"]),l(v,{onClick:e[5]||(e[5]=t=>m.value=!1)},{default:o(()=>e[10]||(e[10]=[y("\u53D6 \u6D88")])),_:1})]),default:o(()=>[Q((d(),f(W,{ref_key:"formRef",ref:w,model:s(a),rules:s(E),"label-width":"120px"},{default:o(()=>[l(J,null,{default:o(()=>[l(n,{span:12},{default:o(()=>[l(c,{label:"\u8DDF\u8FDB\u7C7B\u578B",prop:"type"},{default:o(()=>[l(b,{modelValue:s(a).type,"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).type=t),placeholder:"\u8BF7\u9009\u62E9\u8DDF\u8FDB\u7C7B\u578B"},{default:o(()=>[(d(!0),R(k,null,X(s(Z)(s(ee).CRM_FOLLOW_UP_TYPE),t=>(d(),f(r,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:o(()=>[l(c,{label:"\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",prop:"nextTime"},{default:o(()=>[l(D,{modelValue:s(a).nextTime,"onUpdate:modelValue":e[1]||(e[1]=t=>s(a).nextTime=t),placeholder:"\u9009\u62E9\u4E0B\u6B21\u8054\u7CFB\u65F6\u95F4",type:"date","value-format":"x"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:24},{default:o(()=>[l(c,{label:"\u8DDF\u8FDB\u5185\u5BB9",prop:"content"},{default:o(()=>[l(Y,{modelValue:s(a).content,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).content=t),rows:3,type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:o(()=>[l(c,{label:"\u56FE\u7247",prop:"picUrls"},{default:o(()=>[l(G,{modelValue:s(a).picUrls,"onUpdate:modelValue":e[3]||(e[3]=t=>s(a).picUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:12},{default:o(()=>[l(c,{label:"\u9644\u4EF6",prop:"fileUrls"},{default:o(()=>[l(H,{modelValue:s(a).fileUrls,"onUpdate:modelValue":e[4]||(e[4]=t=>s(a).fileUrls=t),class:"min-w-80px"},null,8,["modelValue"])]),_:1})]),_:1}),s(a).bizType==s(z).CRM_CUSTOMER?(d(),f(n,{key:0,span:24},{default:o(()=>[l(c,{label:"\u5173\u8054\u8054\u7CFB\u4EBA",prop:"contactIds"},{default:o(()=>[l(v,{onClick:q},{default:o(()=>[l(x,{class:"mr-5px",icon:"ep:plus"}),e[7]||(e[7]=y(" \u6DFB\u52A0\u8054\u7CFB\u4EBA "))]),_:1}),l(Ue,{contacts:s(a).contacts},null,8,["contacts"])]),_:1})]),_:1})):U("",!0),s(a).bizType==s(z).CRM_CUSTOMER?(d(),f(n,{key:1,span:24},{default:o(()=>[l(c,{label:"\u5173\u8054\u5546\u673A",prop:"businessIds"},{default:o(()=>[l(v,{onClick:L},{default:o(()=>[l(x,{class:"mr-5px",icon:"ep:plus"}),e[8]||(e[8]=y(" \u6DFB\u52A0\u5546\u673A "))]),_:1}),l(ye,{businesses:s(a).businesses},null,8,["businesses"])]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1},8,["model","rules"])),[[j,s(_)]])]),_:1},8,["modelValue"]),s(a).bizId?(d(),f(Ve,{key:0,ref_key:"contactTableSelectRef",ref:T,"customer-id":s(a).bizId,onSuccess:P},null,8,["customer-id"])):U("",!0),s(a).bizId?(d(),f(we,{key:1,ref_key:"businessTableSelectRef",ref:g,"customer-id":s(a).bizId,onSuccess:A},null,8,["customer-id"])):U("",!0)],64)}}});export{F,Te as _};
