import{aB as ee,aw as j,am as E,c9 as D,bG as J,B,b8 as V,a1 as x,d as R,A as P,bk as te,bu as Q,bz as le,ca as _,bE as ae,bC as se,cb as oe,cc as de,ba as ce,cd as ne,bg as re,r as W,e as q,n as ue,bj as G,aD as ie,aL as he}from"./index-DPENBzsb.js";const pe=R({extends:P,setup(a,r){const u=P.setup(a,r);delete u.selectOptionClick;const v=te().proxy;return E(()=>{u.select.states.cachedOptions.get(v.value)||u.select.onOptionCreate(v)}),j(()=>r.attrs.visible,n=>{u.states.visible=n},{immediate:!0}),u},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function I(a){return a||a===0}function T(a){return Q(a)&&a.length}function O(a){return Q(a)?a:I(a)?[a]:[]}function H(a,r,u,v,n){for(let i=0;i<a.length;i++){const f=a[i];if(r(f,i,a,n))return v?v(f,i,a,n):f;{const A=u(f);if(T(A)){const M=H(A,r,u,v,f);if(M)return M}}}}function z(a,r,u,v){for(let n=0;n<a.length;n++){const i=a[n];r(i,n,a,v);const f=u(i);T(f)&&z(f,r,u,i)}}var ve=R({props:{data:{type:Array,default:()=>[]}},setup(a){const r=ce(ne);return j(()=>a.data,()=>{var u;a.data.forEach(n=>{r.states.cachedOptions.has(n.value)||r.states.cachedOptions.set(n.value,n)});const v=((u=r.selectRef)==null?void 0:u.querySelectorAll("input"))||[];re&&!Array.from(v).includes(document.activeElement)&&r.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const fe=R({name:"ElTreeSelect",inheritAttrs:!1,props:{...B.props,..._.props,cacheData:{type:Array,default:()=>[]}},setup(a,r){const{slots:u,expose:v}=r,n=W(),i=W(),f=x(()=>a.nodeKey||a.valueKey||"value"),A=((e,{attrs:C,emit:S},{select:g,tree:b,key:h})=>{const w=ee("tree-select");return j(()=>e.data,()=>{e.filterable&&E(()=>{var p,s;(s=b.value)==null||s.filter((p=g.value)==null?void 0:p.states.inputValue)})},{flush:"post"}),{...D(J(e),Object.keys(B.props)),...C,"onUpdate:modelValue":p=>S(V,p),valueKey:h,popperClass:x(()=>{const p=[w.e("popper")];return e.popperClass&&p.push(e.popperClass),p.join(" ")}),filterMethod:(p="")=>{var s;e.filterMethod?e.filterMethod(p):e.remoteMethod?e.remoteMethod(p):(s=b.value)==null||s.filter(p)}}})(a,r,{select:n,tree:i,key:f}),{cacheOptions:M,...X}=((e,{attrs:C,slots:S,emit:g},{select:b,tree:h,key:w})=>{j(()=>e.modelValue,()=>{e.showCheckbox&&E(()=>{const t=h.value;t&&!le(t.getCheckedKeys(),O(e.modelValue))&&t.setCheckedKeys(O(e.modelValue))})},{immediate:!0,deep:!0});const p=x(()=>({value:w.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),s=(t,l)=>{var o;const c=p.value[t];return se(c)?c(l,(o=h.value)==null?void 0:o.getNode(s("value",l))):l[c]},$=O(e.modelValue).map(t=>H(e.data||[],l=>s("value",l)===t,l=>s("children",l),(l,o,c,k)=>k&&s("value",k))).filter(t=>I(t)),Y=x(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return z(e.data.concat(e.cacheData),l=>{const o=s("value",l);t.push({value:o,currentLabel:s("label",l),isDisabled:s("disabled",l)})},l=>s("children",l)),t}),F=()=>{var t;return(t=h.value)==null?void 0:t.getCheckedKeys().filter(l=>{var o;const c=(o=h.value)==null?void 0:o.getNode(l);return!oe(c)&&de(c.childNodes)})};return{...D(J(e),Object.keys(_.props)),...C,nodeKey:w,expandOnClickNode:x(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:x(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat($):$),renderContent:(t,{node:l,data:o,store:c})=>t(pe,{value:s("value",o),label:s("label",o),disabled:s("disabled",o),visible:l.visible},e.renderContent?()=>e.renderContent(t,{node:l,data:o,store:c}):S.default?()=>S.default({node:l,data:o,store:c}):void 0),filterNodeMethod:(t,l,o)=>e.filterNodeMethod?e.filterNodeMethod(t,l,o):!t||new RegExp(ae(t),"i").test(s("label",l)||""),onNodeClick:(t,l,o)=>{var c,k,m,N;if((c=C.onNodeClick)==null||c.call(C,t,l,o),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!l.isLeaf)e.expandOnClickNode&&o.proxy.handleExpandIconClick();else if(!s("disabled",t)){const K=(k=b.value)==null?void 0:k.states.options.get(s("value",t));(m=b.value)==null||m.handleOptionSelect(K)}(N=b.value)==null||N.focus()}},onCheck:(t,l)=>{var o;if(!e.showCheckbox)return;const c=s("value",t),k={};z([h.value.store.root],d=>k[d.key]=d,d=>d.childNodes);const m=l.checkedKeys,N=e.multiple?O(e.modelValue).filter(d=>!(d in k)&&!m.includes(d)):[],K=N.concat(m);if(e.checkStrictly)g(V,e.multiple?K:K.includes(c)?c:void 0);else if(e.multiple){const d=F();g(V,N.concat(d))}else{const d=H([t],y=>!T(s("children",y))&&!s("disabled",y),y=>s("children",y)),L=d?s("value",d):void 0,Z=I(e.modelValue)&&!!H([t],y=>s("value",y)===e.modelValue,y=>s("children",y));g(V,L===e.modelValue||Z?void 0:L)}E(()=>{var d;const L=O(e.modelValue);h.value.setCheckedKeys(L),(d=C.onCheck)==null||d.call(C,t,{checkedKeys:h.value.getCheckedKeys(),checkedNodes:h.value.getCheckedNodes(),halfCheckedKeys:h.value.getHalfCheckedKeys(),halfCheckedNodes:h.value.getHalfCheckedNodes()})}),(o=b.value)==null||o.focus()},onNodeExpand:(t,l,o)=>{var c;(c=C.onNodeExpand)==null||c.call(C,t,l,o),E(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&l.checked){const k={},m=h.value.getCheckedKeys();z([h.value.store.root],d=>k[d.key]=d,d=>d.childNodes);const N=O(e.modelValue).filter(d=>!(d in k)&&!m.includes(d)),K=F();g(V,N.concat(K))}})},cacheOptions:Y}})(a,r,{select:n,tree:i,key:f}),U=q({});return v(U),ue(()=>{Object.assign(U,{...D(i.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...D(n.value,["focus","blur","selectedLabel"])})}),()=>G(B,q({...A,ref:e=>n.value=e}),{...u,default:()=>[G(ve,{data:M.value}),G(_,q({...X,ref:e=>i.value=e}))]})}}),ke=he(ie(fe,[["__file","tree-select.vue"]]));export{ke as E};
