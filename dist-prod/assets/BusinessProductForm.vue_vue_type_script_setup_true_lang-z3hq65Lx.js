import{d as J,r as b,e as K,aw as x,n as L,o as c,c as P,y as O,u as r,q as v,w as l,f as e,F as U,p as Q,D as z,as as y,x as C,a3 as G,dC as H,K as S,A as W,B as X,C as Y,T as Z,bQ as ee,I as ae,L as le,J as de,i as oe,M as te}from"./index-DPENBzsb.js";import{_ as re}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{g as ue}from"./index-B6l7NQIx.js";const ie=J({__name:"BusinessProductForm",props:{products:{},disabled:{type:Boolean}},setup($,{expose:I}){const k=$,q=b(!1),s=b([]),f=K({productId:[{required:!0,message:"\u4EA7\u54C1\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],businessPrice:[{required:!0,message:"\u5408\u540C\u4EF7\u683C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],count:[{required:!0,message:"\u4EA7\u54C1\u6570\u91CF\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),g=b([]),_=b([]);x(()=>k.products,async i=>{s.value=i},{immediate:!0}),x(()=>s.value,i=>{i&&i.length!==0&&i.forEach(t=>{t.businessPrice!=null&&t.count!=null?t.totalPrice=H(t.businessPrice,t.count):t.totalPrice=void 0})},{deep:!0});const N=()=>{s.value.push({id:void 0,productId:void 0,productUnit:void 0,productNo:void 0,productPrice:void 0,businessPrice:void 0,count:1})};return I({validate:()=>g.value.validate()}),L(async()=>{_.value=await ue()}),(i,t)=>{const u=S,T=W,B=X,n=Y,V=Z,R=re,h=ee,w=ae,j=le,D=de,F=oe,M=te;return c(),P(U,null,[O((c(),v(D,{ref_key:"formRef",ref:g,model:r(s),rules:r(f),"label-width":"0px","inline-message":!0,disabled:i.disabled},{default:l(()=>[e(j,{data:r(s),class:"-mt-10px"},{default:l(()=>[e(u,{label:"\u5E8F\u53F7",type:"index",align:"center",width:"60"}),e(u,{label:"\u4EA7\u54C1\u540D\u79F0","min-width":"180"},{default:l(({row:a,$index:o})=>[e(n,{prop:`${o}.productId`,rules:r(f).productId,class:"mb-0px!"},{default:l(()=>[e(B,{modelValue:a.productId,"onUpdate:modelValue":d=>a.productId=d,clearable:"",filterable:"",onChange:d=>((A,m)=>{const p=_.value.find(E=>E.id===A);p&&(m.productUnit=p.unit,m.productNo=p.no,m.productPrice=p.price,m.businessPrice=p.price)})(d,a),placeholder:"\u8BF7\u9009\u62E9\u4EA7\u54C1"},{default:l(()=>[(c(!0),P(U,null,Q(r(_),d=>(c(),v(T,{key:d.id,label:d.name,value:d.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"])]),_:1}),e(u,{label:"\u6761\u7801","min-width":"150"},{default:l(({row:a})=>[e(n,{class:"mb-0px!"},{default:l(()=>[e(V,{disabled:"",modelValue:a.productNo,"onUpdate:modelValue":o=>a.productNo=o},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1}),e(u,{label:"\u5355\u4F4D","min-width":"80"},{default:l(({row:a})=>[e(R,{type:r(z).CRM_PRODUCT_UNIT,value:a.productUnit},null,8,["type","value"])]),_:1}),e(u,{label:"\u4EF7\u683C\uFF08\u5143\uFF09","min-width":"120"},{default:l(({row:a})=>[e(n,{class:"mb-0px!"},{default:l(()=>[e(V,{disabled:"",modelValue:a.productPrice,"onUpdate:modelValue":o=>a.productPrice=o,formatter:r(y)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1024)]),_:1}),e(u,{label:"\u552E\u4EF7\uFF08\u5143\uFF09",fixed:"right","min-width":"140"},{default:l(({row:a,$index:o})=>[e(n,{prop:`${o}.businessPrice`,class:"mb-0px!"},{default:l(()=>[e(h,{modelValue:a.businessPrice,"onUpdate:modelValue":d=>a.businessPrice=d,"controls-position":"right",min:.001,precision:2,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(u,{label:"\u6570\u91CF",prop:"count",fixed:"right","min-width":"120"},{default:l(({row:a,$index:o})=>[e(n,{prop:`${o}.count`,rules:r(f).count,class:"mb-0px!"},{default:l(()=>[e(h,{modelValue:a.count,"onUpdate:modelValue":d=>a.count=d,"controls-position":"right",min:.001,precision:3,class:"!w-100%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1}),e(u,{label:"\u5408\u8BA1",prop:"totalPrice",fixed:"right","min-width":"140"},{default:l(({row:a,$index:o})=>[e(n,{prop:`${o}.totalPrice`,class:"mb-0px!"},{default:l(()=>[e(V,{disabled:"",modelValue:a.totalPrice,"onUpdate:modelValue":d=>a.totalPrice=d,formatter:r(y)},null,8,["modelValue","onUpdate:modelValue","formatter"])]),_:2},1032,["prop"])]),_:1}),e(u,{align:"center",fixed:"right",label:"\u64CD\u4F5C",width:"60"},{default:l(({$index:a})=>[e(w,{onClick:o=>{return d=a,void s.value.splice(d,1);var d},link:""},{default:l(()=>t[0]||(t[0]=[C("\u2014")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules","disabled"])),[[M,r(q)]]),i.disabled?G("",!0):(c(),v(F,{key:0,justify:"center",class:"mt-3"},{default:l(()=>[e(w,{onClick:N,round:""},{default:l(()=>t[1]||(t[1]=[C("+ \u6DFB\u52A0\u4EA7\u54C1")])),_:1})]),_:1}))],64)}}});export{ie as _};
