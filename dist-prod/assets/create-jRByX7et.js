import{d as P,r as d,e as j,n as z,y as D,u as e,o,q as v,w as t,f as r,c as y,p as b,O as G,D as I,F as _,x as q,a3 as J,z as Y,a as X,A as $,B as H,C as K,G as N,T as Q,J as W,j as Z,E as ee,I as ae,M as le}from"./index-DPENBzsb.js";import{c as te}from"./index-OXeooWBs.js";import{u as re}from"./tagsView-uxrzGHKp.js";import{a as se}from"./index-B9xqy6_R.js";import{g as ue}from"./index-Co9HWb9O.js";const de=P({name:"BpmOALeaveCreate",__name:"create",setup(oe){const V=Y(),{delView:x}=re(),{push:O,currentRoute:B}=X(),c=d(!1),s=d({type:void 0,reason:void 0,startTime:void 0,endTime:void 0}),C=j({type:[{required:!0,message:"\u8BF7\u5047\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],reason:[{required:!0,message:"\u8BF7\u5047\u539F\u56E0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],startTime:[{required:!0,message:"\u8BF7\u5047\u5F00\u59CB\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}],endTime:[{required:!0,message:"\u8BF7\u5047\u7ED3\u675F\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"change"}]}),g=d(),i=d([]),p=d({}),h=d(),T=d({}),k=d([]),E=async()=>{var m,a;if(g&&await g.value.validate()){((m=i.value)==null?void 0:m.length)>0&&await h.value.validate(),c.value=!0;try{const u={...s.value};((a=i.value)==null?void 0:a.length)>0&&(u.startUserSelectAssignees=p.value),await te(u),V.success("\u53D1\u8D77\u6210\u529F"),x(e(B)),await O({name:"BpmOALeave"})}finally{c.value=!1}}};return z(async()=>{var a;const m=await se(void 0,"oa_leave");if(m){if(i.value=m.startUserSelectTasks,((a=i.value)==null?void 0:a.length)>0){for(const u of i.value)p.value[u.id]=[],T.value[u.id]=[{required:!0,message:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA",trigger:"blur"}];k.value=await ue()}}else V.error("OA \u8BF7\u5047\u7684\u6D41\u7A0B\u6A21\u578B\u672A\u914D\u7F6E\uFF0C\u8BF7\u68C0\u67E5\uFF01")}),(m,a)=>{const u=$,w=H,n=K,U=N,L=Q,A=W,R=Z,S=ee,F=ae,M=le;return D((o(),v(A,{ref_key:"formRef",ref:g,model:e(s),rules:e(C),"label-width":"80px"},{default:t(()=>[r(n,{label:"\u8BF7\u5047\u7C7B\u578B",prop:"type"},{default:t(()=>[r(w,{modelValue:e(s).type,"onUpdate:modelValue":a[0]||(a[0]=l=>e(s).type=l),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u8BF7\u5047\u7C7B\u578B"},{default:t(()=>[(o(!0),y(_,null,b(e(G)(e(I).BPM_OA_LEAVE_TYPE),l=>(o(),v(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"\u5F00\u59CB\u65F6\u95F4",prop:"startTime"},{default:t(()=>[r(U,{modelValue:e(s).startTime,"onUpdate:modelValue":a[1]||(a[1]=l=>e(s).startTime=l),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5F00\u59CB\u65F6\u95F4",type:"datetime","value-format":"x"},null,8,["modelValue"])]),_:1}),r(n,{label:"\u7ED3\u675F\u65F6\u95F4",prop:"endTime"},{default:t(()=>[r(U,{modelValue:e(s).endTime,"onUpdate:modelValue":a[2]||(a[2]=l=>e(s).endTime=l),clearable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4",type:"datetime","value-format":"x"},null,8,["modelValue"])]),_:1}),r(n,{label:"\u539F\u56E0",prop:"reason"},{default:t(()=>[r(L,{modelValue:e(s).reason,"onUpdate:modelValue":a[3]||(a[3]=l=>e(s).reason=l),placeholder:"\u8BF7\u8F93\u8BF7\u5047\u539F\u56E0",type:"textarea"},null,8,["modelValue"])]),_:1}),e(i).length>0?(o(),v(S,{key:0},{default:t(()=>[r(R,{class:"mb-10px"},{header:t(()=>a[4]||(a[4]=[q("\u6307\u5B9A\u5BA1\u6279\u4EBA")])),default:t(()=>[r(A,{model:e(p),rules:e(T),ref_key:"startUserSelectAssigneesFormRef",ref:h},{default:t(()=>[(o(!0),y(_,null,b(e(i),l=>(o(),v(n,{key:l.id,label:`\u4EFB\u52A1\u3010${l.name}\u3011`,prop:l.id},{default:t(()=>[r(w,{modelValue:e(p)[l.id],"onUpdate:modelValue":f=>e(p)[l.id]=f,multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5BA1\u6279\u4EBA"},{default:t(()=>[(o(!0),y(_,null,b(e(k),f=>(o(),v(u,{key:f.id,label:f.nickname,value:f.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]))),128))]),_:1},8,["model","rules"])]),_:1})]),_:1})):J("",!0),r(n,null,{default:t(()=>[r(F,{disabled:e(c),type:"primary",onClick:E},{default:t(()=>a[5]||(a[5]=[q("\u786E \u5B9A")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"])),[[M,e(c)]])}}});export{de as default};
