import{d as ne,z as de,h as ue,r as f,e as pe,n as me,U as ce,o as i,c as H,f as e,w as l,u as t,N as O,F as Y,p as fe,O as ye,D as _e,q as d,x as u,y as w,g as we,a3 as R,E as he,T as be,C as ge,A as ve,B as ke,G as xe,H as Ce,I as Ve,J as Ne,K as Se,bS as Ue,cG as Ee,cH as Re,cI as Te,L as Ae,i as De,M as Fe}from"./index-DPENBzsb.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{_ as Ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as Le}from"./index-CbaPuDB3.js";import{c as x}from"./permission-CaCuVwEz.js";import{d as Me}from"./formatTime-C7TQtsxQ.js";import{d as Pe}from"./download-oWiM5xVU.js";import{C}from"./constants-C8tGWvl2.js";import{b as ze,d as He,e as Oe,f as Ye,r as qe}from"./index-Co9HWb9O.js";import{_ as Ke}from"./UserForm.vue_vue_type_script_setup_true_lang-DusITJYZ.js";import{_ as je}from"./UserImportForm.vue_vue_type_script_setup_true_lang-BoTk3cRi.js";import{_ as Ge}from"./UserAssignRoleForm.vue_vue_type_script_setup_true_lang-BQKgMgJh.js";import{_ as Je}from"./DeptTree.vue_vue_type_script_setup_true_lang-CAUZwN0P.js";import"./index-C2tU_CDa.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./el-tree-select-DxCa0FGQ.js";import"./tree-Cts6wVCK.js";import"./index-Btz8nVwe.js";import"./index-BUzABQZW.js";import"./index-COAxjvEa.js";import"./index-tb7T-AVj.js";const We={class:"flex items-center justify-center"},Qe=ne({name:"SystemUser",__name:"index",setup(Xe){const _=de(),{t:T}=ue(),V=f(!0),A=f(0),D=f([]),r=pe({pageNo:1,pageSize:10,username:void 0,mobile:void 0,status:void 0,deptId:void 0,createTime:[]}),F=f(),p=async()=>{V.value=!0;try{const o=await ze(r);D.value=o.list,A.value=o.total}finally{V.value=!1}},k=()=>{r.pageNo=1,p()},q=()=>{var o;(o=F.value)==null||o.resetFields(),k()},K=async o=>{r.deptId=o.id,await p()},B=f(),I=(o,a)=>{B.value.open(o,a)},L=f(),j=()=>{L.value.open()},N=f(!1),G=async()=>{try{await _.exportConfirm(),N.value=!0;const o=await Oe(r);Pe.excel(o,"\u7528\u6237\u6570\u636E.xls")}catch{}finally{N.value=!1}},J=async o=>{try{await _.delConfirm(),await Ye(o),_.success(T("common.delSuccess")),await p()}catch{}},W=async o=>{try{const a=(await _.prompt('\u8BF7\u8F93\u5165"'+o.username+'"\u7684\u65B0\u5BC6\u7801',T("common.reminder"))).value;await qe(o.id,a),_.success("\u4FEE\u6539\u6210\u529F\uFF0C\u65B0\u5BC6\u7801\u662F\uFF1A"+a)}catch{}},M=f(),Q=o=>{M.value.open(o)};return me(()=>{p()}),(o,a)=>{const S=Le,U=Ie,P=he,z=be,h=ge,X=ve,Z=ke,$=xe,n=Ce,y=Ve,ee=Ne,m=Se,ae=Ue,E=Ee,le=Re,te=Te,se=Ae,oe=Be,re=De,b=ce("hasPermi"),ie=Fe;return i(),H(Y,null,[e(S,{title:"\u7528\u6237\u4F53\u7CFB",url:"https://doc.iocoder.cn/user-center/"}),e(S,{title:"\u4E09\u65B9\u767B\u9646",url:"https://doc.iocoder.cn/social-user/"}),e(S,{title:"Excel \u5BFC\u5165\u5BFC\u51FA",url:"https://doc.iocoder.cn/excel-import-and-export/"}),e(re,{gutter:20},{default:l(()=>[e(P,{span:4,xs:24},{default:l(()=>[e(U,{class:"h-1/1"},{default:l(()=>[e(Je,{onNodeClick:K})]),_:1})]),_:1}),e(P,{span:20,xs:24},{default:l(()=>[e(U,null,{default:l(()=>[e(ee,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:F,inline:!0,"label-width":"68px"},{default:l(()=>[e(h,{label:"\u7528\u6237\u540D\u79F0",prop:"username"},{default:l(()=>[e(z,{modelValue:t(r).username,"onUpdate:modelValue":a[0]||(a[0]=s=>t(r).username=s),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",clearable:"",onKeyup:O(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(h,{label:"\u624B\u673A\u53F7\u7801",prop:"mobile"},{default:l(()=>[e(z,{modelValue:t(r).mobile,"onUpdate:modelValue":a[1]||(a[1]=s=>t(r).mobile=s),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\u7801",clearable:"",onKeyup:O(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(h,{label:"\u72B6\u6001",prop:"status"},{default:l(()=>[e(Z,{modelValue:t(r).status,"onUpdate:modelValue":a[2]||(a[2]=s=>t(r).status=s),placeholder:"\u7528\u6237\u72B6\u6001",clearable:"",class:"!w-240px"},{default:l(()=>[(i(!0),H(Y,null,fe(t(ye)(t(_e).COMMON_STATUS),s=>(i(),d(X,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"},{default:l(()=>[e($,{modelValue:t(r).createTime,"onUpdate:modelValue":a[3]||(a[3]=s=>t(r).createTime=s),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetimerange","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(h,null,{default:l(()=>[e(y,{onClick:k},{default:l(()=>[e(n,{icon:"ep:search"}),a[7]||(a[7]=u("\u641C\u7D22"))]),_:1}),e(y,{onClick:q},{default:l(()=>[e(n,{icon:"ep:refresh"}),a[8]||(a[8]=u("\u91CD\u7F6E"))]),_:1}),w((i(),d(y,{type:"primary",plain:"",onClick:a[4]||(a[4]=s=>I("create"))},{default:l(()=>[e(n,{icon:"ep:plus"}),a[9]||(a[9]=u(" \u65B0\u589E "))]),_:1})),[[b,["system:user:create"]]]),w((i(),d(y,{type:"warning",plain:"",onClick:j},{default:l(()=>[e(n,{icon:"ep:upload"}),a[10]||(a[10]=u(" \u5BFC\u5165 "))]),_:1})),[[b,["system:user:import"]]]),w((i(),d(y,{type:"success",plain:"",onClick:G,loading:t(N)},{default:l(()=>[e(n,{icon:"ep:download"}),a[11]||(a[11]=u("\u5BFC\u51FA "))]),_:1},8,["loading"])),[[b,["system:user:export"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(U,null,{default:l(()=>[w((i(),d(se,{data:t(D)},{default:l(()=>[e(m,{label:"\u7528\u6237\u7F16\u53F7",align:"center",key:"id",prop:"id"}),e(m,{label:"\u7528\u6237\u540D\u79F0",align:"center",prop:"username","show-overflow-tooltip":!0}),e(m,{label:"\u7528\u6237\u6635\u79F0",align:"center",prop:"nickname","show-overflow-tooltip":!0}),e(m,{label:"\u90E8\u95E8",align:"center",key:"deptName",prop:"deptName","show-overflow-tooltip":!0}),e(m,{label:"\u624B\u673A\u53F7\u7801",align:"center",prop:"mobile",width:"120"}),e(m,{label:"\u72B6\u6001",key:"status"},{default:l(s=>[e(ae,{modelValue:s.row.status,"onUpdate:modelValue":g=>s.row.status=g,"active-value":0,"inactive-value":1,onChange:g=>(async c=>{try{const v=c.status===C.ENABLE?"\u542F\u7528":"\u505C\u7528";await _.confirm('\u786E\u8BA4\u8981"'+v+'""'+c.username+'"\u7528\u6237\u5417?'),await He(c.id,c.status),await p()}catch{c.status=c.status===C.ENABLE?C.DISABLE:C.ENABLE}})(s.row),disabled:!t(x)(["system:user:update"])},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])]),_:1}),e(m,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime",formatter:t(Me),width:"180"},null,8,["formatter"]),e(m,{label:"\u64CD\u4F5C",align:"center",width:"160"},{default:l(s=>[we("div",We,[w((i(),d(y,{type:"primary",link:"",onClick:g=>I("update",s.row.id)},{default:l(()=>[e(n,{icon:"ep:edit"}),a[12]||(a[12]=u("\u4FEE\u6539 "))]),_:2},1032,["onClick"])),[[b,["system:user:update"]]]),w((i(),d(te,{onCommand:g=>((c,v)=>{switch(c){case"handleDelete":J(v.id);break;case"handleResetPwd":W(v);break;case"handleRole":Q(v)}})(g,s.row)},{dropdown:l(()=>[e(le,null,{default:l(()=>[t(x)(["system:user:delete"])?(i(),d(E,{key:0,command:"handleDelete"},{default:l(()=>[e(n,{icon:"ep:delete"}),a[14]||(a[14]=u("\u5220\u9664 "))]),_:1})):R("",!0),t(x)(["system:user:update-password"])?(i(),d(E,{key:1,command:"handleResetPwd"},{default:l(()=>[e(n,{icon:"ep:key"}),a[15]||(a[15]=u("\u91CD\u7F6E\u5BC6\u7801 "))]),_:1})):R("",!0),t(x)(["system:permission:assign-user-role"])?(i(),d(E,{key:2,command:"handleRole"},{default:l(()=>[e(n,{icon:"ep:circle-check"}),a[16]||(a[16]=u("\u5206\u914D\u89D2\u8272 "))]),_:1})):R("",!0)]),_:1})]),default:l(()=>[e(y,{type:"primary",link:""},{default:l(()=>[e(n,{icon:"ep:d-arrow-right"}),a[13]||(a[13]=u(" \u66F4\u591A"))]),_:1})]),_:2},1032,["onCommand"])),[[b,["system:user:delete","system:user:update-password","system:permission:assign-user-role"]]])])]),_:1})]),_:1},8,["data"])),[[ie,t(V)]]),e(oe,{total:t(A),page:t(r).pageNo,"onUpdate:page":a[5]||(a[5]=s=>t(r).pageNo=s),limit:t(r).pageSize,"onUpdate:limit":a[6]||(a[6]=s=>t(r).pageSize=s),onPagination:p},null,8,["total","page","limit"])]),_:1})]),_:1})]),_:1}),e(Ke,{ref_key:"formRef",ref:B,onSuccess:p},null,512),e(je,{ref_key:"importFormRef",ref:L,onSuccess:p},null,512),e(Ge,{ref_key:"assignRoleFormRef",ref:M,onSuccess:p},null,512)],64)}}});export{Qe as default};
