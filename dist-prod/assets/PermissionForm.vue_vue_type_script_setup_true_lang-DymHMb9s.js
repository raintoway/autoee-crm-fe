import{d as j,r as v,e as L,n as D,o,q as n,w as u,f as d,x as c,u as a,y as J,c as R,p as O,F as I,a3 as T,t as W,O as G,D as H,k as K,h as Q,z as X,A as Y,B as Z,C as $,ai as ee,aj as ae,ac as le,bO as se,J as ue,I as te,M as oe}from"./index-DPENBzsb.js";import{_ as de}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{g as re}from"./index-Co9HWb9O.js";import{P as ie,B as C,c as ve,u as me}from"./index-Cb-L5Bqt.js";const ne=j({name:"CrmPermissionForm",__name:"PermissionForm",emits:["success"],setup(ce,{expose:z,emit:B}){const{t:_}=Q(),M=X(),i=v(!1),V=v(""),y=v(!1),f=v(""),S=v([]),s=v({}),E=L({userId:[{required:!0,message:"\u4EBA\u5458\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],level:[{required:!0,message:"\u6743\u9650\u7EA7\u522B\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),b=v();z({open:async(t,e,r,m)=>{i.value=!0,V.value=_("action."+t)+"\u56E2\u961F\u6210\u5458",f.value=t,g(e,r),m&&(s.value.ids=m)},open0:async(t,e,r,m,p)=>{i.value=!0,V.value=_("action."+t)+"\u56E2\u961F\u6210\u5458",f.value=t,g(e,r),s.value.level=p,s.value.ids=[m]}});const N=B,U=async()=>{if(b&&await b.value.validate()){y.value=!0;try{const t=s.value;f.value==="create"?(await ve(a(t)),M.success(_("common.createSuccess"))):(await me(a(t)),M.success(_("common.updateSuccess"))),i.value=!1,N("success")}finally{y.value=!1}}},g=(t,e)=>{var r;(r=b.value)==null||r.resetFields(),s.value={},s.value={...s.value,bizType:t,bizId:e}};return D(async()=>{S.value=await re()}),(t,e)=>{const r=Y,m=Z,p=$,F=ee,h=ae,k=le,q=se,x=ue,w=te,P=de,A=oe;return o(),n(P,{modelValue:a(i),"onUpdate:modelValue":e[4]||(e[4]=l=>K(i)?i.value=l:null),title:a(V),width:"30%"},{footer:u(()=>[d(w,{disabled:a(y),type:"primary",onClick:U},{default:u(()=>e[8]||(e[8]=[c("\u786E \u5B9A")])),_:1},8,["disabled"]),d(w,{onClick:e[3]||(e[3]=l=>i.value=!1)},{default:u(()=>e[9]||(e[9]=[c("\u53D6 \u6D88")])),_:1})]),default:u(()=>[J((o(),n(x,{ref_key:"formRef",ref:b,model:a(s),rules:a(E),"label-width":"100px"},{default:u(()=>[a(f)==="create"?(o(),n(p,{key:0,label:"\u9009\u62E9\u4EBA\u5458",prop:"userId"},{default:u(()=>[d(m,{modelValue:a(s).userId,"onUpdate:modelValue":e[0]||(e[0]=l=>a(s).userId=l)},{default:u(()=>[(o(!0),R(I,null,O(a(S),l=>(o(),n(r,{key:l.id,label:l.nickname,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),d(p,{label:"\u6743\u9650\u7EA7\u522B",prop:"level"},{default:u(()=>[d(h,{modelValue:a(s).level,"onUpdate:modelValue":e[1]||(e[1]=l=>a(s).level=l)},{default:u(()=>[(o(!0),R(I,null,O(a(G)(a(H).CRM_PERMISSION_LEVEL),l=>(o(),R(I,{key:l.value},[l.value!=a(ie).OWNER?(o(),n(F,{key:0,value:l.value},{default:u(()=>[c(W(l.label),1)]),_:2},1032,["value"])):T("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1}),a(f)==="create"&&a(s).bizType===a(C).CRM_CUSTOMER?(o(),n(p,{key:1,label:"\u540C\u65F6\u6DFB\u52A0\u81F3"},{default:u(()=>[d(q,{modelValue:a(s).toBizTypes,"onUpdate:modelValue":e[2]||(e[2]=l=>a(s).toBizTypes=l)},{default:u(()=>[d(k,{value:a(C).CRM_CONTACT},{default:u(()=>e[5]||(e[5]=[c("\u8054\u7CFB\u4EBA")])),_:1},8,["value"]),d(k,{value:a(C).CRM_BUSINESS},{default:u(()=>e[6]||(e[6]=[c("\u5546\u673A")])),_:1},8,["value"]),d(k,{value:a(C).CRM_CONTRACT},{default:u(()=>e[7]||(e[7]=[c("\u5408\u540C")])),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1})):T("",!0)]),_:1},8,["model","rules"])),[[A,a(y)]])]),_:1},8,["modelValue","title"])}}});export{ne as _};
