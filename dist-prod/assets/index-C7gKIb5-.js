import{d as ra,h as na,z as sa,a as ia,r as g,e as pa,n as da,U as ca,o as s,c as K,f as e,w as l,u as t,N as L,F as B,p as ua,O as ma,D,q as i,x as p,y as m,t as fa,a3 as R,T as ya,C as ba,A as _a,B as ga,H as ha,I as wa,J as ka,K as va,cG as xa,cH as ja,cI as Ca,L as Na,M as Sa}from"./index-DPENBzsb.js";import{_ as Oa}from"./index.vue_vue_type_script_setup_true_lang-CvB_IkZW.js";import{_ as Ra}from"./DictTag.vue_vue_type_script_lang-pTU0zhE7.js";import{_ as Ta}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{_ as Va}from"./index-CbaPuDB3.js";import{c as T}from"./permission-CaCuVwEz.js";import{_ as Ua}from"./JobForm.vue_vue_type_script_setup_true_lang-xesJOVc6.js";import{_ as qa}from"./JobDetail.vue_vue_type_script_setup_true_lang-6ndVQhmE.js";import{d as Pa}from"./download-oWiM5xVU.js";import{b as Aa,e as Ja,d as za,f as Fa,r as Ia}from"./index-AWrXKSoz.js";import{d as w}from"./constants-C8tGWvl2.js";import"./index-C2tU_CDa.js";import"./color-DXkOL5Tu.js";import"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import"./el-descriptions-item-BD45d2S6.js";import"./el-timeline-item-DOhCPhED.js";import"./formatTime-C7TQtsxQ.js";const Ka=ra({name:"InfraJob",__name:"index",setup(La){const{t:j}=na(),f=sa(),{push:H}=ia(),C=g(!0),V=g(0),U=g([]),n=pa({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),q=g(),N=g(!1),y=async()=>{C.value=!0;try{const r=await Aa(n);U.value=r.list,V.value=r.total}finally{C.value=!1}},k=()=>{n.pageNo=1,y()},E=()=>{q.value.resetFields(),k()},M=async()=>{try{await f.exportConfirm(),N.value=!0;const r=await Ja(n);Pa.excel(r,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},P=g(),A=(r,a)=>{P.value.open(r,a)},G=async r=>{try{await f.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+r.name+"?",j("common.reminder")),await Ia(r.id),f.success("\u6267\u884C\u6210\u529F"),await y()}catch{}},J=g(),W=r=>{J.value.open(r)},z=r=>{H(r&&r>0?"/job/job-log?id="+r:"/job/job-log")};return da(()=>{y()}),(r,a)=>{const S=Va,F=ya,v=ba,X=_a,Y=ga,h=ha,d=wa,Q=ka,I=Ta,b=va,Z=Ra,O=xa,$=ja,aa=Ca,ea=Na,la=Oa,_=ca("hasPermi"),oa=Sa;return s(),K(B,null,[e(S,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://doc.iocoder.cn/job/"}),e(S,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://doc.iocoder.cn/async-task/"}),e(S,{title:"\u6D88\u606F\u961F\u5217",url:"https://doc.iocoder.cn/message-queue/"}),e(I,null,{default:l(()=>[e(Q,{class:"-mb-15px",model:t(n),ref_key:"queryFormRef",ref:q,inline:!0,"label-width":"100px"},{default:l(()=>[e(v,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:l(()=>[e(F,{modelValue:t(n).name,"onUpdate:modelValue":a[0]||(a[0]=o=>t(n).name=o),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:L(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(v,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:l(()=>[e(Y,{modelValue:t(n).status,"onUpdate:modelValue":a[1]||(a[1]=o=>t(n).status=o),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:l(()=>[(s(!0),K(B,null,ua(t(ma)(t(D).INFRA_JOB_STATUS),o=>(s(),i(X,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:l(()=>[e(F,{modelValue:t(n).handlerName,"onUpdate:modelValue":a[2]||(a[2]=o=>t(n).handlerName=o),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:L(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),e(v,null,{default:l(()=>[e(d,{onClick:k},{default:l(()=>[e(h,{icon:"ep:search",class:"mr-5px"}),a[7]||(a[7]=p(" \u641C\u7D22"))]),_:1}),e(d,{onClick:E},{default:l(()=>[e(h,{icon:"ep:refresh",class:"mr-5px"}),a[8]||(a[8]=p(" \u91CD\u7F6E"))]),_:1}),m((s(),i(d,{type:"primary",plain:"",onClick:a[3]||(a[3]=o=>A("create"))},{default:l(()=>[e(h,{icon:"ep:plus",class:"mr-5px"}),a[9]||(a[9]=p(" \u65B0\u589E "))]),_:1})),[[_,["infra:job:create"]]]),m((s(),i(d,{type:"success",plain:"",onClick:M,loading:t(N)},{default:l(()=>[e(h,{icon:"ep:download",class:"mr-5px"}),a[10]||(a[10]=p(" \u5BFC\u51FA "))]),_:1},8,["loading"])),[[_,["infra:job:export"]]]),m((s(),i(d,{type:"info",plain:"",onClick:a[4]||(a[4]=o=>z())},{default:l(()=>[e(h,{icon:"ep:zoom-in",class:"mr-5px"}),a[11]||(a[11]=p(" \u6267\u884C\u65E5\u5FD7 "))]),_:1})),[[_,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),e(I,null,{default:l(()=>[m((s(),i(ea,{data:t(U)},{default:l(()=>[e(b,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),e(b,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),e(b,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:l(o=>[e(Z,{type:t(D).INFRA_JOB_STATUS,value:o.row.status},null,8,["type","value"])]),_:1}),e(b,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),e(b,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),e(b,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),e(b,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:l(o=>[m((s(),i(d,{type:"primary",link:"",onClick:x=>A("update",o.row.id)},{default:l(()=>a[12]||(a[12]=[p(" \u4FEE\u6539 ")])),_:2},1032,["onClick"])),[[_,["infra:job:update"]]]),m((s(),i(d,{type:"primary",link:"",onClick:x=>(async c=>{try{const u=c.status===w.STOP?"\u5F00\u542F":"\u5173\u95ED";await f.confirm("\u786E\u8BA4\u8981"+u+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+c.id+'"\u7684\u6570\u636E\u9879?',j("common.reminder"));const ta=c.status===w.STOP?w.NORMAL:w.STOP;await za(c.id,ta),f.success(u+"\u6210\u529F"),await y()}catch{}})(o.row)},{default:l(()=>[p(fa(o.row.status===t(w).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[_,["infra:job:update"]]]),m((s(),i(d,{type:"danger",link:"",onClick:x=>(async c=>{try{await f.delConfirm(),await Fa(c),f.success(j("common.delSuccess")),await y()}catch{}})(o.row.id)},{default:l(()=>a[13]||(a[13]=[p(" \u5220\u9664 ")])),_:2},1032,["onClick"])),[[_,["infra:job:delete"]]]),m((s(),i(aa,{onCommand:x=>((c,u)=>{switch(c){case"handleRun":G(u);break;case"openDetail":W(u.id);break;case"handleJobLog":z(u==null?void 0:u.id)}})(x,o.row)},{dropdown:l(()=>[e($,null,{default:l(()=>[t(T)(["infra:job:trigger"])?(s(),i(O,{key:0,command:"handleRun"},{default:l(()=>a[15]||(a[15]=[p(" \u6267\u884C\u4E00\u6B21 ")])),_:1})):R("",!0),t(T)(["infra:job:query"])?(s(),i(O,{key:1,command:"openDetail"},{default:l(()=>a[16]||(a[16]=[p(" \u4EFB\u52A1\u8BE6\u7EC6 ")])),_:1})):R("",!0),t(T)(["infra:job:query"])?(s(),i(O,{key:2,command:"handleJobLog"},{default:l(()=>a[17]||(a[17]=[p(" \u8C03\u5EA6\u65E5\u5FD7 ")])),_:1})):R("",!0)]),_:1})]),default:l(()=>[e(d,{type:"primary",link:""},{default:l(()=>[e(h,{icon:"ep:d-arrow-right"}),a[14]||(a[14]=p(" \u66F4\u591A"))]),_:1})]),_:2},1032,["onCommand"])),[[_,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[oa,t(C)]]),e(la,{total:t(V),page:t(n).pageNo,"onUpdate:page":a[5]||(a[5]=o=>t(n).pageNo=o),limit:t(n).pageSize,"onUpdate:limit":a[6]||(a[6]=o=>t(n).pageSize=o),onPagination:y},null,8,["total","page","limit"])]),_:1}),e(Ua,{ref_key:"formRef",ref:P,onSuccess:y},null,512),e(qa,{ref_key:"detailRef",ref:J},null,512)],64)}}});export{Ka as default};
