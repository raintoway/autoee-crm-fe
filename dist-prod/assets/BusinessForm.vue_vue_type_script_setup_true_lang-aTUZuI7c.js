import{d as O,r as i,e as X,aw as Y,o as m,q as v,w as t,f as e,x as F,u as d,y as Z,c as y,p as U,F as g,k as R,as as S,h as $,z as ee,dC as le,b as ae,T as de,C as te,E as ue,A as oe,B as re,i as se,G as ie,l as ce,m as me,bQ as ne,J as pe,I as fe,M as ve}from"./index-DPENBzsb.js";import{_ as _e}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{_ as be}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CnIlr_-B.js";import{g as Ve,c as Pe,u as we}from"./index-D0zCJsCp.js";import{g as Ie}from"./index-Cj_ALIC1.js";import{a as ye}from"./index-OU-fIsLR.js";import{g as Ue}from"./index-Co9HWb9O.js";import{_ as ge}from"./BusinessProductForm.vue_vue_type_script_setup_true_lang-z3hq65Lx.js";const ke=O({__name:"BusinessForm",emits:["success"],setup(Te,{expose:z,emit:A}){const{t:b}=$(),k=ee(),n=i(!1),T=i(""),p=i(!1),f=i(""),u=i({id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1}),B=X({name:[{required:!0,message:"\u5546\u673A\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],customerId:[{required:!0,message:"\u5BA2\u6237\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ownerUserId:[{required:!0,message:"\u8D1F\u8D23\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],statusTypeId:[{required:!0,message:"\u5546\u673A\u72B6\u6001\u7EC4\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),_=i(),h=i([]),x=i([]),q=i([]),V=i("product"),C=i();Y(()=>u.value,o=>{if(!o)return;const l=o.products.reduce((r,s)=>r+s.totalPrice,0),c=l-(o.discountPercent!=null?le(l,o.discountPercent/100):0);u.value.totalProductPrice=l,u.value.totalPrice=c},{deep:!0}),z({open:async(o,l,c,r)=>{if(n.value=!0,T.value=b("action."+o),f.value=o,M(),l){p.value=!0;try{u.value=await Ve(l)}finally{p.value=!1}}else c&&(u.value.customerId=c,u.value.customerDefault=!0),r&&(u.value.contactId=r);q.value=await ye(),x.value=await Ie(),h.value=await Ue(),f.value==="create"&&(u.value.ownerUserId=ae().getUser.id)}});const E=A,G=async()=>{if(_&&await _.value.validate()){await C.value.validate(),p.value=!0;try{const o=u.value;f.value==="create"?(await Pe(o),k.success(b("common.createSuccess"))):(await we(o),k.success(b("common.updateSuccess"))),n.value=!1,E("success")}finally{p.value=!1}}},M=()=>{var o;u.value={id:void 0,name:void 0,customerId:void 0,ownerUserId:void 0,statusTypeId:void 0,dealTime:void 0,discountPercent:0,totalProductPrice:void 0,totalPrice:void 0,remark:void 0,products:[],contactId:void 0,customerDefault:!1},(o=_.value)==null||o.resetFields()};return(o,l)=>{const c=de,r=te,s=ue,P=oe,w=re,I=se,J=ie,Q=ce,W=me,j=be,H=ne,K=pe,D=fe,L=_e,N=ve;return m(),v(L,{title:d(T),modelValue:d(n),"onUpdate:modelValue":l[11]||(l[11]=a=>R(n)?n.value=a:null),width:"1280"},{footer:t(()=>[e(D,{onClick:G,type:"primary",disabled:d(p)},{default:t(()=>l[12]||(l[12]=[F("\u786E \u5B9A")])),_:1},8,["disabled"]),e(D,{onClick:l[10]||(l[10]=a=>n.value=!1)},{default:t(()=>l[13]||(l[13]=[F("\u53D6 \u6D88")])),_:1})]),default:t(()=>[Z((m(),v(K,{ref_key:"formRef",ref:_,model:d(u),rules:d(B),"label-width":"120px"},{default:t(()=>[e(I,null,{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"\u5546\u673A\u540D\u79F0",prop:"name"},{default:t(()=>[e(c,{modelValue:d(u).name,"onUpdate:modelValue":l[0]||(l[0]=a=>d(u).name=a),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u8D1F\u8D23\u4EBA",prop:"ownerUserId"},{default:t(()=>[e(w,{modelValue:d(u).ownerUserId,"onUpdate:modelValue":l[1]||(l[1]=a=>d(u).ownerUserId=a),disabled:d(f)!=="create",class:"w-1/1"},{default:t(()=>[(m(!0),y(g,null,U(d(h),a=>(m(),v(P,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u5BA2\u6237\u540D\u79F0",prop:"customerId"},{default:t(()=>[e(w,{disabled:d(u).customerDefault,modelValue:d(u).customerId,"onUpdate:modelValue":l[2]||(l[2]=a=>d(u).customerId=a),placeholder:"\u8BF7\u9009\u62E9\u5BA2\u6237",class:"w-1/1"},{default:t(()=>[(m(!0),y(g,null,U(d(q),a=>(m(),v(P,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"\u5546\u673A\u72B6\u6001\u7EC4",prop:"statusTypeId"},{default:t(()=>[e(w,{modelValue:d(u).statusTypeId,"onUpdate:modelValue":l[3]||(l[3]=a=>d(u).statusTypeId=a),placeholder:"\u8BF7\u9009\u62E9\u5546\u673A\u72B6\u6001\u7EC4",clearable:"",class:"w-1/1",disabled:d(f)!=="create"},{default:t(()=>[(m(!0),y(g,null,U(d(x),a=>(m(),v(P,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",prop:"dealTime"},{default:t(()=>[e(J,{modelValue:d(u).dealTime,"onUpdate:modelValue":l[4]||(l[4]=a=>d(u).dealTime=a),type:"date","value-format":"x",placeholder:"\u9009\u62E9\u9884\u8BA1\u6210\u4EA4\u65E5\u671F",class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u5907\u6CE8",prop:"remark"},{default:t(()=>[e(c,{type:"textarea",modelValue:d(u).remark,"onUpdate:modelValue":l[5]||(l[5]=a=>d(u).remark=a),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(W,{modelValue:d(V),"onUpdate:modelValue":l[6]||(l[6]=a=>R(V)?V.value=a:null),class:"-mt-15px -mb-10px"},{default:t(()=>[e(Q,{label:"\u4EA7\u54C1\u6E05\u5355",name:"product"},{default:t(()=>[e(ge,{ref_key:"productFormRef",ref:C,products:d(u).products,disabled:o.disabled},null,8,["products","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(I,null,{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"\u4EA7\u54C1\u603B\u91D1\u989D",prop:"totalProductPrice"},{default:t(()=>[e(c,{disabled:"",modelValue:d(u).totalProductPrice,"onUpdate:modelValue":l[7]||(l[7]=a=>d(u).totalProductPrice=a),formatter:d(S)},null,8,["modelValue","formatter"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u6574\u5355\u6298\u6263\uFF08%\uFF09",prop:"discountPercent"},{default:t(()=>[e(H,{modelValue:d(u).discountPercent,"onUpdate:modelValue":l[8]||(l[8]=a=>d(u).discountPercent=a),placeholder:"\u8BF7\u8F93\u5165\u6574\u5355\u6298\u6263","controls-position":"right",min:0,precision:2,class:"!w-1/1"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"\u6298\u6263\u540E\u91D1\u989D",prop:"price"},{default:t(()=>[e(c,{disabled:"",modelValue:d(u).totalPrice,"onUpdate:modelValue":l[9]||(l[9]=a=>d(u).totalPrice=a),placeholder:"\u8BF7\u8F93\u5165\u5546\u673A\u91D1\u989D",formatter:d(S)},null,8,["modelValue","formatter"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[N,d(p)]])]),_:1},8,["title","modelValue"])}}});export{ke as _};
