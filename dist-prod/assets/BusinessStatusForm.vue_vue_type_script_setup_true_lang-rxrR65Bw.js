import{d as A,h as E,z as G,r as n,e as H,o,q as r,w as l,f as t,u as s,x as i,y as O,t as g,a3 as q,k as P,T as W,C as X,ca as Y,d1 as Z,K as ee,bQ as ae,I as le,L as te,J as se,M as de}from"./index-DPENBzsb.js";import{_ as ue}from"./Dialog.vue_vue_type_style_index_0_lang-ncKgepny.js";import{_ as oe}from"./Tooltip.vue_vue_type_script_setup_true_lang-DdTZzcyA.js";import{D as re,b as ne,c as ie,u as ce}from"./index-Cj_ALIC1.js";import{d as pe,h as me}from"./tree-Cts6wVCK.js";import{g as fe}from"./index-BUzABQZW.js";const ve=A({__name:"BusinessStatusForm",emits:["success"],setup(ye,{expose:F,emit:K}){const{t:_}=E(),V=G(),c=n(!1),C=n(""),p=n(!1),x=n(""),d=n({id:void 0,name:"",deptIds:[],statuses:[]}),z=H({name:[{required:!0,message:"\u72B6\u6001\u7EC4\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),h=n(),S=n([]),f=n(),I=n(!0);F({open:async(u,e)=>{if(c.value=!0,C.value=_("action."+u),x.value=u,T(),e){p.value=!0;try{d.value=await ne(e),f.value.setCheckedKeys(d.value.deptIds),d.value.statuses.length==0&&w()}finally{p.value=!1}}else w();S.value=me(await fe())}});const D=K,R=async()=>{await h.value.validate(),p.value=!0;try{const u=d.value;u.deptIds=f.value.getCheckedKeys(!1),x.value==="create"?(await ie(u),V.success(_("common.createSuccess"))):(await ce(u),V.success(_("common.updateSuccess"))),c.value=!1,D("success")}finally{p.value=!1}},T=()=>{var u,e;I.value=!0,d.value={id:void 0,name:"",deptIds:[],statuses:[]},(u=f.value)==null||u.setCheckedNodes([]),(e=h.value)==null||e.resetFields()},w=()=>{d.value.statuses.push({name:"",percent:void 0})};return(u,e)=>{const U=W,b=X,B=oe,J=Y,v=Z,y=ee,L=ae,k=le,M=te,N=se,Q=ue,j=de;return o(),r(Q,{title:s(C),modelValue:s(c),"onUpdate:modelValue":e[2]||(e[2]=a=>P(c)?c.value=a:null)},{footer:l(()=>[t(k,{onClick:R,type:"primary",disabled:s(p)},{default:l(()=>e[6]||(e[6]=[i("\u786E \u5B9A")])),_:1},8,["disabled"]),t(k,{onClick:e[1]||(e[1]=a=>c.value=!1)},{default:l(()=>e[7]||(e[7]=[i("\u53D6 \u6D88")])),_:1})]),default:l(()=>[O((o(),r(N,{ref_key:"formRef",ref:h,model:s(d),rules:s(z),"label-width":"100px"},{default:l(()=>[t(b,{label:"\u72B6\u6001\u7EC4\u540D",prop:"name"},{default:l(()=>[t(U,{modelValue:s(d).name,"onUpdate:modelValue":e[0]||(e[0]=a=>s(d).name=a),placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u7EC4\u540D"},null,8,["modelValue"])]),_:1}),t(b,{label:"\u5E94\u7528\u90E8\u95E8",prop:"deptIds"},{label:l(()=>[t(B,{message:"\u4E0D\u9009\u62E9\u90E8\u95E8\u65F6\uFF0C\u9ED8\u8BA4\u5168\u516C\u53F8\u751F\u6548",title:"\u5E94\u7528\u90E8\u95E8"})]),default:l(()=>[t(J,{ref_key:"treeRef",ref:f,data:s(S),props:s(pe),"check-strictly":!s(I),"node-key":"id",placeholder:"\u8BF7\u9009\u62E9\u5F52\u5C5E\u90E8\u95E8","show-checkbox":""},null,8,["data","props","check-strictly"])]),_:1}),t(b,{label:"\u9636\u6BB5\u8BBE\u7F6E",prop:"statuses"},{default:l(()=>[t(M,{border:"",style:{width:"100%"},data:s(d).statuses.concat(re)},{default:l(()=>[t(y,{align:"center",label:"\u9636\u6BB5",width:"70"},{default:l(a=>[a.row.defaultStatus?(o(),r(v,{key:1},{default:l(()=>e[3]||(e[3]=[i("\u7ED3\u675F")])),_:1})):(o(),r(v,{key:0},{default:l(()=>[i("\u9636\u6BB5 "+g(a.$index+1),1)]),_:2},1024))]),_:1}),t(y,{align:"center",label:"\u9636\u6BB5\u540D\u79F0",width:"160",prop:"name"},{default:l(({row:a})=>[a.endStatus?(o(),r(v,{key:1},{default:l(()=>[i(g(a.name),1)]),_:2},1024)):(o(),r(U,{key:0,modelValue:a.name,"onUpdate:modelValue":m=>a.name=m,placeholder:"\u8BF7\u8F93\u5165\u72B6\u6001\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),t(y,{width:"140",align:"center",label:"\u8D62\u5355\u7387\uFF08%\uFF09",prop:"percent"},{default:l(({row:a})=>[a.endStatus?(o(),r(v,{key:1},{default:l(()=>[i(g(a.percent),1)]),_:2},1024)):(o(),r(L,{key:0,modelValue:a.percent,"onUpdate:modelValue":m=>a.percent=m,placeholder:"\u8BF7\u8F93\u5165\u8D62\u5355\u7387","controls-position":"right",min:0,max:100,precision:2,class:"!w-1/1"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),t(y,{label:"\u64CD\u4F5C",width:"110",align:"center"},{default:l(a=>[a.row.endStatus?q("",!0):(o(),r(k,{key:0,link:"",type:"primary",onClick:m=>w(a.$index)},{default:l(()=>e[4]||(e[4]=[i(" \u6DFB\u52A0 ")])),_:2},1032,["onClick"])),a.row.endStatus?q("",!0):(o(),r(k,{key:1,link:"",type:"danger",onClick:m=>{return $=a.$index,void d.value.statuses.splice($,1);var $},disabled:s(d).statuses.length<=1},{default:l(()=>e[5]||(e[5]=[i(" \u5220\u9664 ")])),_:2},1032,["onClick","disabled"]))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])),[[j,s(p)]])]),_:1},8,["title","modelValue"])}}});export{ve as _};
